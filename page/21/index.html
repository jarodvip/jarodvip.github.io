<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222" media="(prefers-color-scheme: light)"><meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"jarod.vip","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.26.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js" defer></script><meta name="description" content="记录生活中的点点滴滴"><meta property="og:type" content="website"><meta property="og:title" content="Jarod&#39;s Blog"><meta property="og:url" content="https://jarod.vip/page/21/index.html"><meta property="og:site_name" content="Jarod&#39;s Blog"><meta property="og:description" content="记录生活中的点点滴滴"><meta property="og:locale" content="zh_CN"><meta property="article:author" content="Jarod"><meta property="article:tag" content="VPS,hexo,linux,debian,windows,macos,生活,工作"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://jarod.vip/page/21/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/21/index.html","title":""}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Jarod's Blog</title><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script><script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><link rel="alternate" href="/atom.xml" title="Jarod's Blog" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><h1 class="site-title">Jarod's Blog</h1><i class="logo-line"></i></a></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-overview-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><p class="site-author-name" itemprop="name">Jarod</p><div class="site-description" itemprop="description">记录生活中的点点滴滴</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">299</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><span class="site-state-item-count">7</span> <span class="site-state-item-name">分类</span></div><div class="site-state-item site-state-tags"><span class="site-state-item-count">345</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/jarodvip" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jarodvip" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a></span></div></div></div></div></aside></div><div class="main-inner index posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://jarod.vip/2018/10/19/%E4%BD%BF%E7%94%A8overture%E6%90%AD%E5%BB%BA%E6%94%AF%E6%8C%81edns%E7%9A%84%E7%A7%81%E4%BA%BAdns/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Jarod"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jarod's Blog"><meta itemprop="description" content="记录生活中的点点滴滴"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content=" | Jarod's Blog"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2018/10/19/%E4%BD%BF%E7%94%A8overture%E6%90%AD%E5%BB%BA%E6%94%AF%E6%8C%81edns%E7%9A%84%E7%A7%81%E4%BA%BAdns/" class="post-title-link" itemprop="url">使用Overture搭建支持EDNS的私人DNS</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-10-19 01:45:34" itemprop="dateCreated datePublished" datetime="2018-10-19T01:45:34+08:00">2018-10-19</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-12-28 15:54:18" itemprop="dateModified" datetime="2025-12-28T15:54:18+08:00">2025-12-28</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Linux教程</span></a> </span></span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>1.6k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>1 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><h4 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h4><p>先匹配域名，再匹配解析出的ip来决定走primary DNS还是alternative DNS来解析，域名列表(domain_sample)命中，走alternative DNS, 否则走primary DNS，如果解析出的ip不在ip段(ip_network_sample)里，则再去走alternative DNS解析，这样可通过自己组合来完成逻辑上的解析流程。  </p><h4 id="安装配置（Centos7-4）"><a href="#安装配置（Centos7-4）" class="headerlink" title="安装配置（Centos7.4）"></a>安装配置（Centos7.4）</h4><h5 id="创建文件夹并进入"><a href="#创建文件夹并进入" class="headerlink" title="创建文件夹并进入"></a>创建文件夹并进入</h5><blockquote><p>cd &#x2F; &amp;&amp; mkdir overture &amp;&amp; cd overture</p></blockquote><h5 id="下载Overture"><a href="#下载Overture" class="headerlink" title="下载Overture"></a>下载Overture</h5><blockquote><p>wget <a target="_blank" rel="noopener" href="https://github.com/shawn1m/overture/releases/download/1.3.6rc2/overture-linux-amd64.zip">https://github.com/shawn1m/overture/releases/download/1.3.6rc2/overture-linux-amd64.zip</a></p></blockquote><h5 id="解压文件"><a href="#解压文件" class="headerlink" title="解压文件"></a>解压文件</h5><blockquote><p>unzip overture-linux-amd64.zip</p></blockquote><h5 id="备份初始文件"><a href="#备份初始文件" class="headerlink" title="备份初始文件"></a>备份初始文件</h5><blockquote><p>cp ip_network_sample ip_network_sample.bak</p></blockquote><h5 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h5><blockquote><p>echo “0.0.0.0&#x2F;0” &gt; ip_network_sample vim config.json</p></blockquote><h5 id="配置文件介绍"><a href="#配置文件介绍" class="headerlink" title="配置文件介绍"></a>配置文件介绍</h5><blockquote><p>BindAddress：监听的ip地址和端口号，默认同时监听TCP和UDP端口 PrimaryDNS：主DNS Name：DNS标志 Address：DNS的IP和端口号 Protocol：使用的协议 SOCKS5Address：转发DNS请求到Socket5代理 Timeout：代理到后端的超时时间 EDNSClientSubnet：智能DNS解析，建议设置为auto，根据客户端的IP地址做判断而不是客户端指定的DNS的IP地址 MinimumTTL：Overture缓存解析记录的时长 CacheSize：Overture缓存大小</p></blockquote><h5 id="域名配置"><a href="#域名配置" class="headerlink" title="域名配置"></a>域名配置</h5><blockquote><p>“DomainFile”: “.&#x2F;domain_sample” #这个文件里可放需走alternative DNS的域名, 如google.com, 支持后缀命中 “DomainBase64Decode”: false #这个要false关闭域名列表的64解码，才能用明文来表达域名</p></blockquote><h5 id="IP列表配置"><a href="#IP列表配置" class="headerlink" title="IP列表配置"></a>IP列表配置</h5><blockquote><p>“IPNetworkFile”: “.&#x2F;ip_network_sample” #直接用0.0.0.0&#x2F;0, 如有特别的逻辑可改</p></blockquote><h5 id="启动Overture"><a href="#启动Overture" class="headerlink" title="启动Overture"></a>启动Overture</h5><blockquote><p>.&#x2F;overture-linux-amd64 -c：指定配置文件路径；默认当前启动路径的下的config.json文件 -l：指定日志路径和日志文件；默认当前启动路径下的overture.log -p：指定进程数；默认当前CPU的核心数 -v：Debug日志模式</p></blockquote><p> </p><h3 id="真麻烦为什么不能自启动？？？这简直糟糕透了！！！"><a href="#真麻烦为什么不能自启动？？？这简直糟糕透了！！！" class="headerlink" title="真麻烦为什么不能自启动？？？这简直糟糕透了！！！"></a>真麻烦为什么不能自启动？？？这简直糟糕透了！！！</h3><p> </p><h5 id="设置Overture自启动"><a href="#设置Overture自启动" class="headerlink" title="设置Overture自启动"></a>设置Overture自启动</h5><blockquote><p>chmod +x &#x2F;etc&#x2F;rc.d&#x2F;rc.local vi &#x2F;etc&#x2F;rc.local 并写入 sh &#x2F;dns.sh vi &#x2F;dns.sh cd &#x2F;overture nohup &#x2F;overture&#x2F;overture-linux-amd64 -c &#x2F;overture&#x2F;config.json -l &#x2F;overture&#x2F;overture.log &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1 &amp; chmod 777 &#x2F;dns.sh</p></blockquote><h5 id="大功告成"><a href="#大功告成" class="headerlink" title="大功告成~~~"></a>大功告成~~~</h5><p>但是，但是！！！重点在这里！！！ 自己搭建Overture耗时耗钱，不想折腾可以直接使用Hi!XNS，已经稳定运行3年，非常可靠乐观！当然不是单纯的Overture那么简单，通过二次开发达到更高水准！非常纯净哦~~ 传送门：<a target="_blank" rel="noopener" href="https://hixns.com/">https://hixns.com/</a></p></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://jarod.vip/2018/10/19/ssl%E4%BC%98%E5%8C%96/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Jarod"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jarod's Blog"><meta itemprop="description" content="记录生活中的点点滴滴"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content=" | Jarod's Blog"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2018/10/19/ssl%E4%BC%98%E5%8C%96/" class="post-title-link" itemprop="url">SSL优化</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-10-19 01:44:22" itemprop="dateCreated datePublished" datetime="2018-10-19T01:44:22+08:00">2018-10-19</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-12-28 15:54:18" itemprop="dateModified" datetime="2025-12-28T15:54:18+08:00">2025-12-28</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Linux教程</span></a> </span></span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>2k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>2 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><h5 id="一、关闭TLSv1-0提高安全性"><a href="#一、关闭TLSv1-0提高安全性" class="headerlink" title="一、关闭TLSv1.0提高安全性"></a>一、关闭TLSv1.0提高安全性</h5><p>大多数是比较老旧系统上自带浏览器不支持，如果是主流用户使用的Chrome、Firefox和国产浏览器基本都兼容。</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3;</span><br></pre></td></tr></table></figure></blockquote><h5 id="二、开启HTTP-Strict-Transport-Security-HSTS"><a href="#二、开启HTTP-Strict-Transport-Security-HSTS" class="headerlink" title="二、开启HTTP Strict Transport Security (HSTS)"></a>二、开启HTTP Strict Transport Security (HSTS)</h5><p>指示浏览器只使用 HTTPS 连接到目标服务器。这可以防止一些潜在的中间人攻击，包括 SSL 剥离，会话 cookie 窃取（如果没有被 适当保护）。如果遇到任何与证书相关的错误，它还可以阻止浏览器连接到网站。当浏览器访问一个设置相应 HTTP header 的 HTTPS 网站时，HSTS 将被激活。 HSTS 有一个固定期限，由 max-age 字段值控制。这个值可以是静态的，也可以是相对于将来某个特定日期的，你可以设置成 SSL 证书的过期时间。 在浏览器中，HSTS 首选项可以通过提交到 Chromium’s HSTS preload list 来硬编码，这是所有实现 HSTS 使用的浏览器。 注意，HSTS 确实有陷阱。它提供了 include subdomains 选项，这在实践中可能是太宽泛了。此外，客户端错误可能会造成严重的后果——客户端错误的时钟导致它认为服务器的 SSL 证书无效或过期，或者缺少根 CA 证书——将不再导致浏览器中的证书错误。浏览器将完全拒绝访问页面，并且可能会显示让安全专家之外的完全无法理解的错误。</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Strict-Transport-Security: max-age=31536000</span><br></pre></td></tr></table></figure></blockquote><h6 id="二·1、同时还允许预加载"><a href="#二·1、同时还允许预加载" class="headerlink" title="二·1、同时还允许预加载"></a>二·1、同时还允许预加载</h6><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Strict-Transport-Security: max-age=31536000; includeSubDomains; preload</span><br></pre></td></tr></table></figure></blockquote><h5 id="三、部署-CSP"><a href="#三、部署-CSP" class="headerlink" title="三、部署 CSP"></a>三、部署 CSP</h5><p>内容安全策略（CSP）是网站可以用来限制浏览器操作的安全机制。尽管最初旨在解决跨站点脚本（XSS），CSP 不断发展，并支持对增强TLS安全性有用的功能。特别地，它可以用于限制混合内容，当涉及到第三方网站，HSTS没有帮助。</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: default-src https: &#x27;unsafe-inline&#x27; &#x27;unsafe-eval&#x27;; </span><br><span class="line">connect-src https: wss:</span><br></pre></td></tr></table></figure><p> </p></blockquote><h5 id="四、Web-Framework-Information"><a href="#四、Web-Framework-Information" class="headerlink" title="四、Web Framework Information"></a>四、Web Framework Information</h5><p>许多 web 框架设置 HTTP 头，识别框架或版本号。除了满足用户的好奇心，而且主要作为技术堆栈的广告，这几乎没有什么作用。这些头是不标准的，对浏览器渲染站点的方式没有影响。 从服务器响应中删除这些标头: X-Powered-By, X-Runtime, X-Version 和 X-AspNet-Version。 标记所有 cookie 安全和 HttpOnly。</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: Key=Value; path=/; secure; HttpOnly, Key2=Value2; secure; HttpOnly</span><br></pre></td></tr></table></figure></blockquote><h5 id="五、加密优化"><a href="#五、加密优化" class="headerlink" title="五、加密优化"></a>五、加密优化</h5><p>如果您的服务器需要支持IE6这种古董级别的浏览器，那么就按照百度的做法，如果说对兼容性没有太大的需求，只要主流的浏览器能够访问那么就不要支持3DES系列的加密套件，如果说想要在保证安全性的同时，也要有最好的兼容性，那么就请按照淘宝的配置方式进行配置。</p><h6 id="五·1、类似百度"><a href="#五·1、类似百度" class="headerlink" title="五·1、类似百度"></a>五·1、类似百度</h6><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH; </span><br><span class="line">ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2;</span><br></pre></td></tr></table></figure></blockquote><h6 id="五·2、类似淘宝"><a href="#五·2、类似淘宝" class="headerlink" title="五·2、类似淘宝"></a>五·2、类似淘宝</h6><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssl_ciphers EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5; </span><br><span class="line">ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br></pre></td></tr></table></figure></blockquote><h6 id="五·3、正常"><a href="#五·3、正常" class="headerlink" title="五·3、正常"></a>五·3、正常</h6><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssl_ciphers EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256::!MD5; </span><br><span class="line">ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br></pre></td></tr></table></figure></blockquote><h6 id="五·3、更安全"><a href="#五·3、更安全" class="headerlink" title="五·3、更安全"></a>五·3、更安全</h6><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssl_ciphers EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256::!MD5; </span><br><span class="line">ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3;</span><br></pre></td></tr></table></figure></blockquote><p>注：转载并合理整理及修改，原著作网站：<a target="_blank" rel="noopener" href="https://blog.myssl.com/">https://blog.myssl.com/</a></p></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://jarod.vip/2018/10/18/%E6%90%AD%E5%BB%BA%E9%AB%98%E5%A4%A7%E4%B8%8A%E7%9A%84zimbra%E5%8A%9E%E5%85%AC%E4%B8%8E%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E7%B3%BB%E7%BB%9F/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Jarod"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jarod's Blog"><meta itemprop="description" content="记录生活中的点点滴滴"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content=" | Jarod's Blog"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2018/10/18/%E6%90%AD%E5%BB%BA%E9%AB%98%E5%A4%A7%E4%B8%8A%E7%9A%84zimbra%E5%8A%9E%E5%85%AC%E4%B8%8E%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E7%B3%BB%E7%BB%9F/" class="post-title-link" itemprop="url">搭建高大上的Zimbra办公与邮件服务系统</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-10-18 11:59:08" itemprop="dateCreated datePublished" datetime="2018-10-18T11:59:08+08:00">2018-10-18</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-12-28 15:54:18" itemprop="dateModified" datetime="2025-12-28T15:54:18+08:00">2025-12-28</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Linux教程</span></a> </span></span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>14k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>13 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><p>Table of Contents</p><ul><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#Ubuntu_1604" title="一、Ubuntu 16.04搭建方法">一、Ubuntu 16.04搭建方法</a><ul><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#1" title="1.系统软硬件要求">1.系统软硬件要求</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#2DNS" title="2.配置DNS">2.配置DNS</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#3" title="3.系统环境的设置">3.系统环境的设置</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#4" title="4.下载并安装软件包">4.下载并安装软件包</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#5" title="5.选择安装组件">5.选择安装组件</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#6_Zimbra" title="6, 配置Zimbra">6, 配置Zimbra</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#7SSL" title="7.配置SSL">7.配置SSL</a></li></ul></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#CentOS_7" title="二、CentOS 7的搭建方法">二、CentOS 7的搭建方法</a><ul><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#i" title="安装要求">安装要求</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#i-2" title="开始">开始</a><ul><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#i-3" title="域名解析">域名解析</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#DNS" title="反向DNS解析">反向DNS解析</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#sendmailpostfix25" title="关闭sendmail或postfix服务，避免25端口被占用">关闭sendmail或postfix服务，避免25端口被占用</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#selinux" title="关闭selinux">关闭selinux</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#i-4" title="防火墙">防火墙</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#HOSTNAME" title="配置主机名HOSTNAME">配置主机名HOSTNAME</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#HOSTS" title="配置HOSTS">配置HOSTS</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#NTP" title="NTP">NTP</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#_wiki" title="安装依赖包 wiki">安装依赖包 wiki</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#i-5" title="安装及使用">安装及使用</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#SPF" title="SPF">SPF</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#DKIM" title="DKIM">DKIM</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#DMARC" title="DMARC">DMARC</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#i-6" title="域名解析记录">域名解析记录</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#DKIM-2" title="验证DKIM">验证DKIM</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#i-7" title="重新签发证书">重新签发证书</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#i-8" title="可以学习的内容">可以学习的内容</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#i-9" title="小工具">小工具</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#i-10" title="参考文章">参考文章</a></li></ul></li></ul></li></ul><h1 id="一、Ubuntu-16-04搭建方法"><a href="#一、Ubuntu-16-04搭建方法" class="headerlink" title="一、Ubuntu 16.04搭建方法"></a>一、Ubuntu 16.04搭建方法</h1><p>Zimbra是著名的开源系统，它一体化地提供了邮件收发、文件共享、协同办公、即时聊天等一系列解决方案，是开源软件中的精品。它拥有美观大气的使用界面，以及非常实用的功能。作为邮件服务器系统，Zimbra更是凭借卓越的稳定性和功能当之无愧地成为开源邮件服务器系统的首选，适合各类型&#x2F;人数的用户群，尤其适合团队使用。之前我们写过一个简单的Zimbra邮件服务器安装的教程，然而那篇文章写于五年前，对于现在的版本已经不再适用。正好由于前天，Online.net服务器大幅提价，我们不得不迁移之前的服务器，于是需要在新的系统上重新搭建一次Zimbra. 因此，我们这里凭借这个机会再介绍一下如何安装与配置独立的Zimbra开源办公与邮件服务系统，希望对大家有所帮助。多台服务器协同部署的步骤这里不做太多介绍。</p><h2 id="1-系统软硬件要求"><a href="#1-系统软硬件要求" class="headerlink" title="1.系统软硬件要求"></a>1.系统软硬件要求</h2><p>Zimbra的体量较大，因此对于系统环境的要求较高。首先，系统必须为64位。目前，Zimbra支持的操作系统包括：CentOS 6, CentOS 7, Ubuntu 14.04 LTS, Ubuntu 16.04 LTS, Red Hat Linux 6&#x2F;7, 以及Oracle Linux 6&#x2F;7. 关于硬件需求，首先，内存需要8 GB或者以上，建议16 GB. 系统的硬盘占用约为8 GB左右，视自己的需要而定。CPU和其他硬件没有特别需求，但是Zimbra官方说明中有提到，<strong>强烈不建议在RAID 5 (包括50)的服务器上搭建Zimbra</strong>. 如果您有类似的服务器，建议更改RAID模式，避免RAID 5或者50. 鉴于Zimbra的体量，我们不建议在VPS上安装Zimbra, 而最好是在一台独立服务器上安装。本文的操作环境为Ubuntu 16.04 LTS 64bit.</p><h2 id="2-配置DNS"><a href="#2-配置DNS" class="headerlink" title="2.配置DNS"></a>2.配置DNS</h2><p>我们简要说明一下一个最简单的zimbra邮件服务器的DNS配置需求。 如果以qing.su域名为例，我们将域名本身qing.su以A记录解析到任意IP, 然后将邮件服务器的hostname, 比如mx.qing.su以A记录解析到我们将要搭建的邮件服务器的IP上。 然后，我们分别将qing.su与mx.qing.su以MX记录解析到mx.qing.su, 优先级可以为任意值。 如果需要用web访问邮箱，可以将mail.qing.su解析到邮件服务器的IP上。 其他记录的设置，比如TXT, SRV等，可以后期根据自己的需要来自行配制。</p><h2 id="3-系统环境的设置"><a href="#3-系统环境的设置" class="headerlink" title="3.系统环境的设置"></a>3.系统环境的设置</h2><p>毫无疑问，对于任何邮件服务器来说，最重要的前提步骤是正确设置服务器的hostname. 如何正确设置服务器的hostname我们已经强调过多次。我们以mx.example.com为例，当在SSH中执行hostname命令时，应当看到的回显为短主机名，即mx; 而在SSH中执行hostname -f命令时，应当看到的回显为长主机名(FQDN), 即mx.example.com. 若hostname没有正确设置好，请不要继续。 然后，我们用root账户登录SSH, 即可开始安装。(不要sudo, 请直接su到root, 否则会出错)</p><h2 id="4-下载并安装软件包"><a href="#4-下载并安装软件包" class="headerlink" title="4.下载并安装软件包"></a>4.下载并安装软件包</h2><p>Zimbra各系统软件包的下载地址如下：<a target="_blank" rel="noopener" href="https://www.zimbra.com/downloads/zimbra-collaboration-open-source/">https://www.zimbra.com/downloads/zimbra-collaboration-open-source/</a> 请按照自己的需求下载。我们这里以Ubuntu 16.04为例。执行： <code>apt-get update &amp;&amp; apt-get upgrade cd /tmp wget https://files.zimbra.com/downloads/8.8.9_GA/zcs-8.8.9_GA_2055.UBUNTU16_64.20180703080917.tgz tar xvzf *.tgz rm -f zcs*.tgz cd zcs* ./install.sh</code></p><h2 id="5-选择安装组件"><a href="#5-选择安装组件" class="headerlink" title="5.选择安装组件"></a>5.选择安装组件</h2><p>正确执行上述步骤后，首先会提示是否同意用户协议，选择Y即可。 <code>Do you agree with the terms of the https://qing.su software license agreement? [N] Y</code> 然后会提示选择需要安装的组件，如果您不是特别了解的话可以直接选择默认选项。 <code>Use Zimbra&#39;s package repository [Y] Install zimbra-ldap [Y] Install zimbra-logger [Y] Install zimbra-mta [Y] Install zimbra-dnscache [Y] Install zimbra-snmp [Y] Install zimbra-store [Y] Install zimbra-apache [Y] Install https://qing.su[Y] Install zimbra-spell [Y] Install zimbra-memcached [Y] Install zimbra-proxy [Y] Install zimbra-drive [Y] Install zimbra-imapd (BETA - for evaluation only) [N] Install zimbra-chat [Y]</code> 最后，系统会提示是否确认更改，我们需要选择Y。 <code>The system will be modified.  Continue? [N] Y</code> 至此，系统将会下载必要的安装包并自动安装。</p><h2 id="6-配置Zimbra"><a href="#6-配置Zimbra" class="headerlink" title="6, 配置Zimbra"></a>6, 配置Zimbra</h2><p>安装完毕后，系统会弹出命令行菜单，如下面这样： <code>Main menu 1) Common Configuration: 2) zimbra-ldap: Enabled 3) zimbra-logger: Enabled 4) zimbra-mta: Enabled 5) zimbra-dnscache: Enabled 6) zimbra-snmp: Enabled 7) zimbra-store: Enabled +Create Admin User: yes +Admin user to create: admin@mx.example.com ******* +Admin Password UNSET +Anti-virus quarantine user: virus-quarantine.6zk4_0qy@mx.example.com +Enable automated spam training: yes +Spam training user: spam.zc3z28w0@mx.example.com +Non-spam(Ham) training user: ham.bkojeqoiq@mx.example.com +SMTP host: mx.example.com +Web server HTTP port: 8080 +Web server HTTPS port: 8443 +Web server mode: https +IMAP server port: 7143 +IMAP server SSL port: 7993 +POP server port: 7110 +POP server SSL port: 7995 +Use spell check server: yes +Spell server URL: http://mx.example.com:7780/aspell.php +Enable version update checks: TRUE +Enable version update notifications: TRUE +Version update notification email: admin@mx.example.com +Version update source email: admin@mx.example.com +Install mailstore (service webapp): yes +Install UI (zimbra,zimbraAdmin webapps): yes 8) zimbra-spell: Enabled 9) zimbra-proxy: Enabled 10) Default Class of Service Configuration: s) Save config to file x) Expand menu q) Quit Address unconfigured (**) items (? - help) 7</code> 这里我们选择7,  进入Store configuration, 并在下一步选择4, 设置管理员密码。 <code>Store configuration 1) Status:                                  Enabled 2) Create Admin User:                       yes 3) Admin user to create:                    admin@mx.example.com ** 4) Admin Password                           UNSET 5) Anti-virus quarantine user:              virus-quarantine.6zk4_0qy@mx.example.com 6) Enable automated spam training:          yes 7) Spam training user:                      spam.zc3z28w0@mx.example.com 8) Non-spam(Ham) training user:             ham.bkojeqoiq@mx.example.com 9) SMTP host:                               mx.example.com 10) Web server HTTP port:                    8080 11) Web server HTTPS port:                   8443 12) Web server mode:                         https 13) IMAP server port:                        7143 14) IMAP server SSL port:                    7993 15) POP server port:                         7110 16) POP server SSL port:                     7995 17) Use spell check server:                  yes 18) Spell server URL:                        http://mx.example.com:7780/aspell.php 19) Enable version update checks:            TRUE 20) Enable version update notifications:     TRUE 21) Version update notification email:       admin@mx.example.com 22) Version update source email:             admin@mx.example.com 23) Install mailstore (service webapp):      yes 24) Install UI (zimbra,zimbraAdmin webapps): yes Select, or &#39;r&#39; for previous menu [r]</code> 如果有其他选项您希望更改的，也可以一并更改（但是不建议更改端口地址）。更改完毕后，输入r返回上级菜单，然后输入a让更改生效并将配置写入至文件。 <code>*** CONFIGURATION COMPLETE - press &#39;a&#39; to apply Select from menu, or press &#39;a&#39; to apply config (? - help) a Save configuration data to a file? [Yes] Save config in file: [/opt/zimbra/config.11819] Saving config in /opt/zimbra/config.11819...done. The system will be modified - continue? [No] Yes</code> 要忘记最后要输入Yes来保存更改。几秒钟之后，系统就配置完毕。至此，Zimbra安装完毕，我们可以登录后台添加域名、添加用户等进行一系列的管理了。</p><h2 id="7-配置SSL"><a href="#7-配置SSL" class="headerlink" title="7.配置SSL"></a>7.配置SSL</h2><p>安装完毕Zimbra以后，我们就可以通过<a href="https://mx.example.com:7071登录后台，进行管理。此时，SSL证书还没有配置好，我们需要配置SSL">https://mx.example.com:7071登录后台，进行管理。此时，SSL证书还没有配置好，我们需要配置SSL</a>, 否则浏览器会一直报错。点击界面下方Get Started –&gt; Install Certificates, 选择Next然后选择Generate the CSR for the commercial certificate authorizer, 然后在弹出来的界面中生成CSR. 我们需要将主域名mx.example.com填在Common Name中，然后在Subjective Alternative Name中添加需要一并生成证书的其他域名，比如example.com, <a target="_blank" rel="noopener" href="http://www.example.com/">www.example.com</a>, mail.example.com等。点击Next即可生成证书CSR. 有了CSR之后，我们即可申请证书了。Zimbra配置证书的过程比较tricky, 经常会报错，特别是如果在网页后台安装证书时报错的原因很不清晰，导致无法分析错误发生的原因。因此，我们一般选择在SSH中使用命令行的方式安装证书。下面我们以Let’s Encrypt为例安装证书，其他的商业证书的安装较为简单，这里就不再重复。 我们用SSH登录服务器，然后su切换至root. 首先，我们将刚才的CSR保存至&#x2F;tmp&#x2F;mx.example.com.csr文件。然后，安装certbot, 签发Let’s Encrypt证书。 <code>apt-get install software-properties-common add-apt-repository ppa:certbot/certbot apt-get update apt-get install certbot</code> 这里有一个小技巧，通常我们签发Let’s Encrypt证书的时候是让它自己生成私钥和CSR的，但是在需要的时候，certbot可以根据已有的CSR来签发证书，只需使用–csr参数即可。因此，我们基于刚刚生成的CSR来签发证书。 <code>certbot certonly --standalone --csr /tmp/mx.example.com.csr</code> 签发的证书和链文件位于&#x2F;tmp目录内。需要注意的是，Certbot生成的中间链会在Zimbra中校验失败，我们需要下载额外的Root CA和中间链证书。 <code>wget https://letsencrypt.org/certs/isrgrootx1.pem.txt -O ca.crt wget https://letsencrypt.org/certs/letsencryptauthorityx3.pem.txt -O ca_intermediary.crt</code> 然后再整理、合并一下证书： <code>mv 0000_cert.pem commercial.crt cat /tmp/ca_intermediary.crt /tmp/ca.crt &gt; /tmp/ca_chain.crt</code> 现在就可以开始签发安装证书了。安装证书需要使用zimbra用户，这是在安装Zimbra的时候新建的内置用户。 <code>su zimbra</code> 安装之前，我们先验证一下证书。执行 <code>/opt/zimbra/bin/zmcertmgr verifycrt comm /opt/zimbra/ssl/zimbra/commercial/commercial.key /tmp/commercial.crt /tmp/ca_chain.crt</code> 如果看到类似于下面的回显，说明合格了。如果报错，大概率是因为Root CA和中间链哪里没有弄对，请仔细检查后再试。 <code>** Verifying &#39;/tmp/commercial.crt&#39; against &#39;/opt/zimbra/ssl/zimbra/commercial/commercial.key&#39; **Tutorial written by https://qing.su** Certificate &#39;/tmp/commercial.crt&#39; and private key &#39;/opt/zimbra/ssl/zimbra/commercial/commercial.key&#39; match. ** Verifying &#39;/tmp/commercial.crt&#39; against &#39;/tmp/ca_chain.crt&#39; Valid certificate chain: /tmp/commercial.crt: OK</code> 证书验证完毕后，执行下面的命令安装并检验： <code>/opt/zimbra/bin/zmcertmgr deploycrt comm /tmp/commercial.crt /tmp/ca_chain.crt /opt/zimbra/bin/zmcertmgr viewdeployedcrt</code> 最后，我们要重启zimbra服务器，让证书生效。 <code>exit service zimbra restart</code> 再次登录<a target="_blank" rel="noopener" href="https://mx.example.com:7071/">https://mx.example.com:7071</a>, 已经可以看到证书生效了。 至此，Zimbra服务器安装完毕并成功配置了SSL证书。在添加好相应的域名之后，即可使用相关用户名和密码登录<a target="_blank" rel="noopener" href="https://mail.example.com来登录邮箱,界面非常美观大气.可以看到,在邮箱右下角还有聊天窗口,可以和同一个工作组内的伙伴实时通讯并传输文件./">https://mail.example.com来登录邮箱，界面非常美观大气。可以看到，在邮箱右下角还有聊天窗口，可以和同一个工作组内的伙伴实时通讯并传输文件。</a></p><h1 id="二、CentOS-7的搭建方法"><a href="#二、CentOS-7的搭建方法" class="headerlink" title="二、CentOS 7的搭建方法"></a>二、CentOS 7的搭建方法</h1><h2 id="安装要求"><a href="#安装要求" class="headerlink" title="安装要求"></a>安装要求</h2><p>1、64位服务器并能设置反向DNS解析（zimbra新版不支持32位操作系统） 2、磁盘空间≥5GB（zimbra默认安装位置&#x2F;opt 请确保磁盘空间足够 可以挂载到新磁盘） 3、内存≥4GB（编译对内存要求较高，内存小的用户可以设置swap来缓解内存压力） 4、域名一枚</p><h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><h3 id="域名解析"><a href="#域名解析" class="headerlink" title="域名解析"></a>域名解析</h3><p>zimbra在线安装时要检查MX 安装之前配置好dns MX解析并确认已生效 未生效安装过程会终止 假如&gt;&gt; 邮件服务器IP：138.68.227.28 邮件服务器采用的域名：mail.example.com 对外发送和接收邮件的域名：example.com</p><p>mail.example.com. IN A 138.68.227.28</p><p>example.com. IN MX 10 mail.example.com.</p><h3 id="反向DNS解析"><a href="#反向DNS解析" class="headerlink" title="反向DNS解析"></a>反向DNS解析</h3><p>反向解析由主机商提供（有些面板可以设置，不行提交工单） 主要用于发件，确认邮件来源的有效性。 命令查看反向解析是否生效：<code>nslookup -qt=ptr 138.68.227.28</code> 返回指向mail.example.com则成功</p><h3 id="关闭sendmail或postfix服务，避免25端口被占用"><a href="#关闭sendmail或postfix服务，避免25端口被占用" class="headerlink" title="关闭sendmail或postfix服务，避免25端口被占用"></a>关闭sendmail或postfix服务，避免25端口被占用</h3><p># centos 6</p><p>&#x2F;etc&#x2F;init.d&#x2F;sendmail stop &amp;&amp; chkconfig sendmail off</p><p>&#x2F;etc&#x2F;init.d&#x2F;postfix stop &amp;&amp; chkconfig postfix off</p><p># centos 7</p><p>systemctl stop postfix &amp;&amp; yum erase postfix</p><p>systemctl stop sendmail &amp;&amp; systemctl disable sendmail</p><h3 id="关闭selinux"><a href="#关闭selinux" class="headerlink" title="关闭selinux"></a><a target="_blank" rel="noopener" href="https://www.zephyr.vip/204">关闭selinux</a></h3><h3 id="防火墙"><a href="#防火墙" class="headerlink" title="防火墙"></a><strong>防火墙</strong></h3><p>根据自已需求选择要不要关闭，也可以选用设置防火墙规则 <strong>关闭防火墙功能</strong></p><p># centos 6</p><p>service iptables stop &amp;&amp; chkconfig iptables off</p><p># centos 7</p><p>systemctl stop firewalld.service &amp;&amp; systemctl disable firewalld.service</p><p><strong>添加防火墙规则 开放端口</strong></p><p>–A INPUT –m state —state NEW –m tcp –p tcp —dport 80 –j ACCEPT</p><p>–A INPUT –m state —state NEW –m tcp –p tcp —dport 443 –j ACCEPT</p><p>–A INPUT –m state —state NEW –m tcp –p tcp —dport 7071 –j ACCEPT</p><p>–A INPUT –m state —state NEW –m tcp –p tcp —dport 8087 –j ACCEPT</p><p>–A INPUT –m state —state NEW –m tcp –p tcp —dport 8080 –j ACCEPT</p><p>–A INPUT –m state —state NEW –m tcp –p tcp —dport 8443 –j ACCEPT</p><p>–A INPUT –m state —state NEW –m tcp –p tcp —dport 25 –j ACCEPT</p><p>–A INPUT –m state —state NEW –m tcp –p tcp —dport 110 –j ACCEPT</p><p>–A INPUT –m state —state NEW –m tcp –p tcp —dport 143 –j ACCEPT</p><p>–A INPUT –m state —state NEW –m tcp –p tcp —dport 993 –j ACCEPT</p><p>–A INPUT –m state —state NEW –m tcp –p tcp —dport 995 –j ACCEPT</p><p># iptables -F</p><p># iptables -P INPUT DROP</p><p># iptables -P OUTPUT ACCEPT</p><p># iptables -A INPUT -i lo -j ACCEPT</p><p># iptables -A INPUT -s IP-Address-of-your-server&#x2F;32 -j ACCEPT</p><p># iptables -A INPUT -m state –state ESTABLISHED,RELATED -j ACCEPT</p><p># iptables -A INPUT -p tcp –dport 22 -j ACCEPT</p><p># iptables -A INPUT -p icmp -j ACCEPT</p><p>## Zimbra rules for external access ##</p><p># iptables -A INPUT -p tcp –dport 25  -j ACCEPT</p><p># iptables -A INPUT -p tcp –dport 80  -j ACCEPT</p><p># iptables -A INPUT -p tcp –dport 110  -j ACCEPT</p><p># iptables -A INPUT -p tcp –dport 143 -j ACCEPT</p><p># iptables -A INPUT -p tcp –dport 443  -j ACCEPT</p><p># iptables -A INPUT -p tcp –dport 465  -j ACCEPT</p><p># iptables -A INPUT -p tcp –dport 587  -j ACCEPT</p><p># iptables -A INPUT -p tcp –dport 993  -j ACCEPT</p><p># iptables -A INPUT -p tcp –dport 995  -j ACCEPT</p><p># iptables -A INPUT -p tcp –dport 3443  -j ACCEPT</p><p># iptables -A INPUT -p tcp –dport 9071  -j ACCEPT</p><p># iptables -A INPUT -p tcp –dport 7071  -j ACCEPT</p><h3 id="配置主机名HOSTNAME"><a href="#配置主机名HOSTNAME" class="headerlink" title="配置主机名HOSTNAME"></a>配置主机名HOSTNAME</h3><p><strong>修改配置文件</strong> <code>vi /etc/sysconfig/network</code> 内容 <code>HOSTNAME=mail.example.com</code> 或 <strong>命令设置</strong></p><p>hostnamectl set–hostname mail.example.com</p><p>hostnamectl status</p><p>hostname</p><h3 id="配置HOSTS"><a href="#配置HOSTS" class="headerlink" title="配置HOSTS"></a>配置HOSTS</h3><p>安装时会检查hosts文件内容要否符合要求：<ip><fqhn> <hn>核查hosts文件中的FQHN是否与与hostname一致，不一致安装中止</hn></fqhn></ip></p><p>不设置<ip><fqhn><hn>返回的错误信息：</hn></fqhn></ip></p><p>ERROR: Installation can not proceeed. Please fix your &#x2F;etc&#x2F;hosts file</p><p>to contain:</p><p>&lt;ip&gt; &lt;FQHN&gt; &lt;HN&gt;</p><p>Where &lt;IP&gt; is the ip address of the host,</p><p>&lt;FQHN&gt; is the FULLY QUALIFIED host name, and</p><p>&lt;HN&gt; is the (optional) hostname–only portion</p><p>错误信息2 出错原因也说的很详细了 注释掉有12.0.0.1的行 DO服务器注释掉<code>#centos-512mb-ams2-01 centos-512mb-ams2-01的行</code></p><p>ERROR: Installation can not proceeed. Please fix your &#x2F;etc&#x2F;hosts file</p><p>to contain:</p><p>127.0.0.1 localhost.localdomain localhost</p><p>Zimbra install grants mysql permissions only to localhost and</p><p>localhost.localdomain users. But Fedora&#x2F;RH installs leave lines such</p><p>as these in &#x2F;etc&#x2F;hosts:</p><p>127.0.0.1 myhost.mydomain.com myhost localhost.localdomain localhost</p><p>This causes MySQL to reject users coming from 127.0.0.1 as users from</p><p>myhost.mydomain.com. You can read more details at:</p><p><a target="_blank" rel="noopener" href="http://bugs.mysql.com/bug.php?id=11822">http://bugs.mysql.com/bug.php?id=11822</a></p><p><em>服务器IP</em> <em>完整域名</em> 主机名称（hostname命令显示的）</p><p>vi &#x2F;etc&#x2F;hosts</p><p>138.68.243.239 mail.example.com mail.example.com</p><h3 id="NTP"><a href="#NTP" class="headerlink" title="NTP"></a>NTP</h3><blockquote><p>Network Time Protocol（NTP）是用来使计算机时间同步化的一种协议，它可以使计算机对其服务器或时钟源（如石英钟，GPS等等)做同步化，它可以提供高精准度的时间校正（LAN上与标准间差小于1毫秒，WAN上几十毫秒），且可介由加密确认的方式来防止恶毒的协议攻击。</p></blockquote><p>yum install ntp</p><p>systemctl start ntpd</p><p>systemctl enable ntpd</p><h3 id="安装依赖包-wiki"><a href="#安装依赖包-wiki" class="headerlink" title="安装依赖包 wiki"></a>安装依赖包 <a target="_blank" rel="noopener" href="https://wiki.zimbra.com/wiki/Zimbra_dependencies_per_Operating_System">wiki</a></h3><p>从Zimbra Collaboration 8.7开始，Zimbra依赖于自己的存储库打包系统，这意味着Zimbra安装脚本会自动处理操作系统的依赖关系。</p><h3 id="安装及使用"><a href="#安装及使用" class="headerlink" title="安装及使用"></a>安装及使用</h3><p>wget <a target="_blank" rel="noopener" href="https://files.zimbra.com/downloads/8.7.5/_GA/zcs-8.7.5/_GA/_1764.RHEL7/_64.20170314032533.tgz">https://files.zimbra.com/downloads/8.7.5\_GA/zcs-8.7.5\_GA\_1764.RHEL7\_64.20170314032533.tgz</a></p><p>tar zxvf zcs–8.7.5_GA_1764.RHEL7_64.20170314032533.tgz</p><p>cd zcs–8.7.5_GA_1764.RHEL7_64.20170314032533</p><p># .&#x2F;install.sh</p><p>.&#x2F;install.sh —platform–override</p><p>安装出错可行一次：<code>/opt/zimbra/libexec/zmsetup.pl</code> 日志分析，不行就卸载重装了<code>./install.sh -u</code> 安装过程就不一一列出来了，能y的设置y，跳到菜单的时候选7、选4设置管理员密码，r返回，a 查看占用空间：<code>du -sh /opt/zimbra/</code> 切换到zimbra用户：<code>su - zimbra</code> 查看运行状态：<code>zmcontrol status</code> 重启服务：<code>zmcontrol restart</code> web管理界面：<a target="_blank" rel="noopener" href="https://mail.example.com:7071/">https://mail.example.com:7071/</a> web用户界面：<a target="_blank" rel="noopener" href="https://mail.example.com:7073/">https://mail.example.com:7073/</a> <strong>添加新域名</strong> example.com <strong>简单的收发邮件</strong>：example.com 设置@的MX记录到mail.example.com SPF,DKIM,DMARC <a target="_blank" rel="noopener" href="https://wiki.zimbra.com/wiki/Best_Practices_on_Email_Protection:_SPF,_DKIM_and_DMARC">wiki</a> <a target="_blank" rel="noopener" href="http://www.mail163.cn/anti-spam/">spam</a></p><h3 id="SPF"><a href="#SPF" class="headerlink" title="SPF"></a>SPF</h3><p>什么是SPF？ (Sender Policy Framework) 的缩写，一种以IP地址认证电子邮件发件人身份的技术，是非常高效的垃圾邮件解决方案。 接收邮件方会首先检查域名的SPF记录，来确定发件人的IP地址是否被包含在SPF记录里面，如果在，就认为是一封正确的邮件，否则会认为是一封伪造的邮件进行退回。 example.com 设置@的SPF和txt记录：v&#x3D;spf1 mx ~all（允许当前域名的mx记录对应的IP地址）</p><h3 id="DKIM"><a href="#DKIM" class="headerlink" title="DKIM"></a>DKIM</h3><p>Bug：</p><p>ZCS 8.7.x 已知问题 BUG zmdkimkeyutil 生成非有效的2048位DKIM 解决：&#x2F;opt&#x2F;zimbra&#x2F;libexec&#x2F;zmdkimkeyutil 修改所有2048关键字为1024 》升级DKIM签名：<code>/opt/zimbra/libexec/zmdkimkeyutil -u -d example.com</code> 》更改DNS设置 <strong>命令生成2048位DKIM</strong>：&#x2F;opt&#x2F;zimbra&#x2F;libexec&#x2F;zmdkimkeyutil -a -b 2048 -d example.com</p><p>DKIM是利用加密签名和验证的原理，发件人在发送邮件时候，将与域名相关的加密签名插入邮件，收件人收到邮件后就可以对签名进行验证，判断发件人地址的真实性。</p><ul><li>添加DKIM &#x2F;opt&#x2F;zimbra&#x2F;libexec&#x2F;zmdkimkeyutil -a -d example.com</li><li>升级DKIM &#x2F;opt&#x2F;zimbra&#x2F;libexec&#x2F;zmdkimkeyutil -u -d example.com</li><li>删除DKIM &#x2F;opt&#x2F;zimbra&#x2F;libexec&#x2F;zmdkimkeyutil -r -d example.com</li><li>查看DKIM &#x2F;opt&#x2F;zimbra&#x2F;libexec&#x2F;zmdkimkeyutil -q -d example.com</li></ul><p>生成1024位的DKIM 内容为</p><p>DKIM Data added to LDAP for domain example.com with selector E298BEBE–2D5A–11E7–9E70–F55E985B5BE7</p><p>Public signature to enter into DNS:</p><p>E298BEBE–2D5A–11E7–9E70–F55E985B5B17._domainkey IN TXT ( “v&#x3D;DKIM1; k&#x3D;rsa; “</p><p>“p&#x3D;MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC5Lkk2XnUgA9LoHWYgDb1URxyTnab0WuHA9CKUFtLWrjV6S87bcpzoVa3</p><h3 id="DMARC"><a href="#DMARC" class="headerlink" title="DMARC"></a>DMARC</h3><p>[DMARC]协议的主要目的是识别并拦截钓鱼邮件 DNS记录 名称：_dmarc  值：v&#x3D;DMARC1; p&#x3D;none</p><h3 id="域名解析记录"><a href="#域名解析记录" class="headerlink" title="域名解析记录"></a>域名解析记录</h3><p>类型：txt DNS名称：E298BEBE-2D5A-11E7-9E70-F55E985B5B17._domainkey 值：”v&#x3D;DKIM1; k&#x3D;rsa;p&#x3D;MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC5Lkk2XnUgA9LoHWYgDb1URxyTnab0WuHA9CKUFtLWrjV6S87bcpzoVa3fGVc&#x2F;jChVfu5E4ZTif&#x2F;jNkBPeow7wnwajEpFo8G&#x2F;yR0e8aNwDghW8DYf9B21QPAtB9NqoNjoUSD1tDsTXor2tSqf8wormbVhN3Y9aWkAxMEUP594zUwIDAQAB”</p><h3 id="验证DKIM"><a href="#验证DKIM" class="headerlink" title="验证DKIM"></a>验证DKIM</h3><p><strong>验证公钥是否与私钥匹配</strong> 测试通过没有任何信息返回，否则返回record not found &#x2F;opt&#x2F;zimbra&#x2F;common&#x2F;sbin&#x2F;opendkim-testkey -d example.com -s E298BEBE-2D5A-11E7-9E70-F55E985B5B17 -x &#x2F;opt&#x2F;zimbra&#x2F;conf&#x2F;opendkim.conf</p><h3 id="重新签发证书"><a href="#重新签发证书" class="headerlink" title="重新签发证书"></a>重新签发证书</h3><p>zimbra的证书有效期为365天，为了避免下次的麻烦，可以重新签发一个证书，有效期20年。</p><p>&#x2F;opt&#x2F;zimbra&#x2F;bin&#x2F;zmcertmgr createca –new</p><p>&#x2F;opt&#x2F;zimbra&#x2F;bin&#x2F;zmcertmgr deployca</p><p>&#x2F;opt&#x2F;zimbra&#x2F;bin&#x2F;zmcertmgr createcrt –new –days 7300</p><p>&#x2F;opt&#x2F;zimbra&#x2F;bin&#x2F;zmcertmgr deploycrt self</p><p>&#x2F;opt&#x2F;zimbra&#x2F;bin&#x2F;zmcertmgr viewdeployedcrt</p><h3 id="可以学习的内容"><a href="#可以学习的内容" class="headerlink" title="可以学习的内容"></a>可以学习的内容</h3><p>dnsmasq named</p><h3 id="小工具"><a href="#小工具" class="headerlink" title="小工具"></a>小工具</h3><p><a target="_blank" rel="noopener" href="https://intodns.com/one.one">https://intodns.com/one.one</a> DNS检查 <a target="_blank" rel="noopener" href="http://www.mail-tester.com/">http://www.mail-tester.com/</a> 邮件评分 <a target="_blank" rel="noopener" href="https://dmarcian.com/dmarc-inspector/mgtgxp.pw">https://dmarcian.com/dmarc-inspector/mgtgxp.pw</a> dmarc测试</p><h3 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h3><p><a target="_blank" rel="noopener" href="https://www.renfei.org/blog/introduction-to-spf.html">https://www.renfei.org/blog/introduction-to-spf.html</a> <a target="_blank" rel="noopener" href="http://170182.blog.51cto.com/160182/1272569">http://170182.blog.51cto.com/160182/1272569</a> <a target="_blank" rel="noopener" href="https://www.mawenbao.com/research/email-spf-and-exim4-dkim-dmarc-config.html">https://www.mawenbao.com/research/email-spf-and-exim4-dkim-dmarc-config.html</a> <a target="_blank" rel="noopener" href="http://imzhen.com/note/2015/08/09/20150809/">http://imzhen.com/note/2015/08/09/20150809/</a></p><blockquote><p><a target="_blank" rel="noopener" href="http://blog.topspeedsnail.com/archives/5546">CentOS 7 安装配置Zimbra邮件服务器</a></p></blockquote><p><a target="_blank" rel="noopener" href="https://www.chenxie.net/archives/1476.html">https://www.chenxie.net/archives/1476.html</a> <a target="_blank" rel="noopener" href="http://www.bkjia.com/Linux/1112319.html">http://www.bkjia.com/Linux/1112319.html</a> <a target="_blank" rel="noopener" href="https://bbotte.com/server-config/zimbra-configuration-mail-service-full-record/">https://bbotte.com/server-config/zimbra-configuration-mail-service-full-record/</a></p><blockquote><p><a target="_blank" rel="noopener" href="http://www.huike007.cn/?p=463">Zimbra8 安装说明</a></p></blockquote><p><a target="_blank" rel="noopener" href="http://blog.csdn.net/zzban/article/details/8640510">http://blog.csdn.net/zzban/article/details/8640510</a> <a target="_blank" rel="noopener" href="https://www.kenceng-solusindo.net/read/intalasi-zimbra-mail-server-ubuntu-16-04/">https://www.kenceng-solusindo.net/read/intalasi-zimbra-mail-server-ubuntu-16-04/</a> <a target="_blank" rel="noopener" href="http://record.blog.51cto.com/3300006/1206745">http://record.blog.51cto.com/3300006/1206745</a> <a target="_blank" rel="noopener" href="https://www.chenxie.net/archives/1476.html">https://www.chenxie.net/archives/1476.html</a> <a target="_blank" rel="noopener" href="http://www.linuxyw.com/linux/qitafuwu/20130605/540.html">http://www.linuxyw.com/linux/qitafuwu/20130605/540.html</a> <a target="_blank" rel="noopener" href="http://m.blog.chinaunix.net/uid-31075838-id-5698408.html">http://m.blog.chinaunix.net/uid-31075838-id-5698408.html</a></p></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://jarod.vip/2018/10/18/hetzner%E4%BD%BF%E7%94%A8proxmox%E6%88%96%E8%80%85solusvm%E5%BC%80nat-kvm%E7%8B%AC%E7%AB%8Bipv6%E6%A1%A5%E6%8E%A5%E7%BD%91%E5%8D%A1%E8%AE%BE%E7%BD%AE/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Jarod"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jarod's Blog"><meta itemprop="description" content="记录生活中的点点滴滴"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content=" | Jarod's Blog"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2018/10/18/hetzner%E4%BD%BF%E7%94%A8proxmox%E6%88%96%E8%80%85solusvm%E5%BC%80nat-kvm%E7%8B%AC%E7%AB%8Bipv6%E6%A1%A5%E6%8E%A5%E7%BD%91%E5%8D%A1%E8%AE%BE%E7%BD%AE/" class="post-title-link" itemprop="url">hetzner使用proxmox或者solusvm开Nat kvm独立ipv6桥接网卡设置</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-10-18 09:46:22" itemprop="dateCreated datePublished" datetime="2018-10-18T09:46:22+08:00">2018-10-18</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-12-28 15:54:18" itemprop="dateModified" datetime="2025-12-28T15:54:18+08:00">2025-12-28</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Linux教程</span></a> </span></span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>956</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>1 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><p>结果谷歌一系列的查找资料，最后还是到了hetzner的wiki找到了解决办法。</p><h3 id="1-proxmox桥接网卡配置："><a href="#1-proxmox桥接网卡配置：" class="headerlink" title="1.proxmox桥接网卡配置："></a>1.proxmox桥接网卡配置：</h3><p># &#x2F;etc&#x2F;network&#x2F;interfaces<br>### Hetzner Online GmbH - installimage<br># Loopback device:<br>auto lo<br>iface lo inet loopback</p><h1><a href="#" class="headerlink"></a></h1><p># device: eth0<br>auto eth0<br>iface eth0 inet static<br>address<main ip><br>netmask 255.255.255.255<br>pointopoint<gateway><br>gateway<gateway></gateway></gateway></main></p><h1 id="-1"><a href="#-1" class="headerlink"></a></h1><p>iface eth0 inet6 static<br>address</p><address from the ipv6 subnet>#eg: 2001:db8::2<br>netmask 128<br>gateway fe80::1<br>up sysctl -p<br># for single IPs<br>auto vmbr0<br>iface vmbr0 inet static<br>address 10.0.1.1<br>netmask 255.255.255.0<br>bridge_ports none<br>bridge_stp off<br>bridge_fd 0<p></p><h1 id="-2"><a href="#-2" class="headerlink"></a></h1><p>iface vmbr0 inet6 static<br>address</p><address from the ipv6 subnet>#eg: 2001:db8::2<br>netmask 64<p></p><p>关于Nat链接网络请使用iptables实现。</p><h3 id="2-solusvm下网卡配置："><a href="#2-solusvm下网卡配置：" class="headerlink" title="2.solusvm下网卡配置："></a>2.solusvm下网卡配置：</h3><p>主网卡中默认配置请不要修改，仅需将IPV6ADDR的&#x2F;64换为&#x2F;128 例如：IPV6ADDR&#x3D; 2001:db8::2&#x2F;128 然后将桥接网卡更改为：</p><p>DEVICE=br0<br>ONBOOT=yes<br>TYPE=Bridge<br>BOOTPROTO=static<br>IPADDR=10.0.1.1<br>NETMASK=255.255.255.0<br>IPV6ADDR=2001:db8::2&#x2F;64</p><p>关于联网与端口映射请使用iptables</p><h3 id="3-关于虚拟机（kvm）的配置："><a href="#3-关于虚拟机（kvm）的配置：" class="headerlink" title="3.关于虚拟机（kvm）的配置："></a>3.关于虚拟机（kvm）的配置：</h3><p>这里拿2001:db8::此ipv6做示范 Debian or Ubuntu：</p><p>iface eth0 inet6 static<br>address 2001:db8::f001<br>netmask 64<br>gateway 2001:db8::2</p><p>Centos:</p><p>IPV6INIT=yes<br>IPV6ADDR=2001:db8::f001&#x2F;64<br>IPV6_DEFAULTGW=2001:db8::2</p></address></address></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://jarod.vip/2018/10/18/%E4%BD%BF%E7%94%A8ipip%E6%89%93%E9%80%9A%E9%9A%A7%E9%81%93/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Jarod"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jarod's Blog"><meta itemprop="description" content="记录生活中的点点滴滴"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content=" | Jarod's Blog"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2018/10/18/%E4%BD%BF%E7%94%A8ipip%E6%89%93%E9%80%9A%E9%9A%A7%E9%81%93/" class="post-title-link" itemprop="url">使用IPIP打通隧道</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-10-18 09:41:58" itemprop="dateCreated datePublished" datetime="2018-10-18T09:41:58+08:00">2018-10-18</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-12-28 15:54:18" itemprop="dateModified" datetime="2025-12-28T15:54:18+08:00">2025-12-28</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Linux教程</span></a> </span></span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>804</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>1 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><p>查看IPIP模块：</p><p>modinfo ipip</p><p>开始建立隧道： 注：这里设置A主机的公网IP为1.1.1.1，B主机的公网IP为2.2.2.2 A主机操作：</p><p>ip tunnel add ipip-tunnel mode ipip remote 2.2.2.2 local 1.1.1.1 ifconfig ipip-tunnel 10.0.1.1 netmask 255.255.255.0</p><p>B主机操作：</p><p>ip tunnel add ipip-tunnel mode ipip remote 1.1.1.1 local 2.2.2.2 ifconfig ipip-tunnel 10.0.1.2 netmask 255.255.255.0</p><p>然后这时候就可以在B主机上pingA主机设置的内网IP10.0.1.1看是否想通，如果同的话就代表成功打通。 此外介绍一种直接使用网卡配置文件（CentOS系统）的方法： A主机（&#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-ipip-tunnel）</p><p>DEVICE=ipip-tunnel<br>ONBOOT=yes<br>TYPE=IPIP<br>TTL=255<br>PEER_OUTER_IPADDR=2.2.2.2<br>PEER_INNER_IPADDR=10.0.1.2<br>MY_OUTER_IPADDR=1.1.1.1<br>MY_INNER_IPADDR=10.0.1.1</p><p>B主机（&#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-ipip-tunnel）</p><p>DEVICE=ipip-tunnel<br>ONBOOT=yes<br>TYPE=IPIP<br>TTL=255<br>PEER_OUTER_IPADDR=1.1.1.1<br>PEER_INNER_IPADDR=10.0.1.1<br>MY_OUTER_IPADDR=2.2.2.2<br>MY_INNER_IPADDR=10.0.1.2</p><p>然后启动网卡即可</p></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://jarod.vip/2018/10/10/%E8%B6%85%E7%BA%A7%E4%B8%80%E9%94%AE/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Jarod"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jarod's Blog"><meta itemprop="description" content="记录生活中的点点滴滴"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content=" | Jarod's Blog"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2018/10/10/%E8%B6%85%E7%BA%A7%E4%B8%80%E9%94%AE/" class="post-title-link" itemprop="url">超级一键</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-10-10 01:28:04" itemprop="dateCreated datePublished" datetime="2018-10-10T01:28:04+08:00">2018-10-10</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-12-28 15:54:18" itemprop="dateModified" datetime="2025-12-28T15:54:18+08:00">2025-12-28</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E5%85%B6%E4%BB%96/" itemprop="url" rel="index"><span itemprop="name">其他</span></a> </span></span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>137</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>1 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -N --no-check-certificate https://raw.githubusercontent.com/ToyoDAdoubi/doubi/master/ssr.sh &amp;&amp; chmod +x ssr.sh &amp;&amp; bash ssr.sh</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://jarod.vip/2018/10/07/oneman-idc%E4%BD%BF%E7%94%A8solusvm%E5%88%9B%E5%BB%BAkvm-vps/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Jarod"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jarod's Blog"><meta itemprop="description" content="记录生活中的点点滴滴"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content=" | Jarod's Blog"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2018/10/07/oneman-idc%E4%BD%BF%E7%94%A8solusvm%E5%88%9B%E5%BB%BAkvm-vps/" class="post-title-link" itemprop="url">[Oneman IDC]使用SolusVM创建KVM VPS</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-10-07 21:11:47" itemprop="dateCreated datePublished" datetime="2018-10-07T21:11:47+08:00">2018-10-07</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-12-28 15:54:18" itemprop="dateModified" datetime="2025-12-28T15:54:18+08:00">2025-12-28</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Linux教程</span></a> </span></span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>6k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>5 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><p>[<img src="https://img.zrj96.com/solusvm/soluvm-logo.jpg" alt="[Oneman IDC]使用SolusVM创建KVM VPS">](<a target="_blank" rel="noopener" href="https://img.zrj96.com/solusvm/soluvm-logo.jpg">https://img.zrj96.com/solusvm/soluvm-logo.jpg</a>)</p><p>在上一篇教程中：<a target="_blank" rel="noopener" href="https://www.zrj96.com/post-702.html">[Oneman IDC]Proxmox VE 5创建LXC小鸡</a> 我们利用Proxmox创建了LXC VPS，本次我们利用创建VPS里使用最广泛的SolusVM来创建KVM VPS。 本篇文章中主被控均为CentOS 7系统，其实对于SolusVM这种面板推荐使用CentOS 6问题少一些，不过博主个人对于网卡配置也是初学阶段，暂时是模仿状态，习惯CentOS 7，所以就使用CentOS 7来作为主系统。<strong>所以说如果你是CentOS6系统，在桥接网卡这一步千万别学我！！！</strong></p><p>Table of Contents</p><p> </p><ul><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-749.html#i" title="一、面板介绍">一、面板介绍</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-749.html#Slave" title="二、被控端配置（Slave）">二、被控端配置（Slave）</a><ul><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-749.html#1" title="1.进入救援系统设置">1.进入救援系统设置</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-749.html#2RAID" title="2.RAID设置">2.RAID设置</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-749.html#3" title="3.磁盘分区">3.磁盘分区</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-749.html#4" title="4.完成安装系统">4.完成安装系统</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-749.html#5IP" title="5.购买额外IP">5.购买额外IP</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-749.html#6" title="6.桥接网卡设置">6.桥接网卡设置</a><ul><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-749.html#1-2" title="（1）安装软件包">（1）安装软件包</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-749.html#3-2" title="（3）修改网卡文件配置">（3）修改网卡文件配置</a></li></ul></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-749.html#7" title="7.安装被控端">7.安装被控端</a></li></ul></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-749.html#Master" title="三、主控端安装（Master）">三、主控端安装（Master）</a><ul><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-749.html#1-3" title="（1）主控安装">（1）主控安装</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-749.html#2SSL" title="（2）SSL安全连接">（2）SSL安全连接</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-749.html#3-3" title="（3）汉化前台">（3）汉化前台</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-749.html#i-2" title="四、主控端配置和使用">四、主控端配置和使用</a><ul><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-749.html#1-4" title="（1）面板后台主页">（1）面板后台主页</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-749.html#2" title="（2）修改管理员密码">（2）修改管理员密码</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-749.html#3Node" title="（3）添加节点（Node）">（3）添加节点（Node）</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-749.html#4IP" title="（4）添加IP">（4）添加IP</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-749.html#5" title="（5）创建与同步系统模板">（5）创建与同步系统模板</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-749.html#6VPS" title="（6）创建VPS">（6）创建VPS</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-749.html#7-2" title="（7）用户使用">（7）用户使用</a></li></ul></li></ul></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-749.html#i-3" title="五、其他">五、其他</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-749.html#i-4" title="六、总结">六、总结</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-749.html#i-5" title="七、参考资料">七、参考资料</a></li></ul><h2 id="一、面板介绍"><a href="#一、面板介绍" class="headerlink" title="一、面板介绍"></a>一、面板介绍</h2><p>SoluVM目前是OnApp旗下的产品，不过2.0版已经难产多年，还在1.x缓慢更新…如果你使用过VPS，尤其是国外VPS的话大部分都是使用SolusVM面板来创建VPS，那么相应的教程和文档就会成熟完整一些。同时SolusVM对于财务系统例如WHMCS的对接非常简单方便，所以很多主机商都在使用。Proxmox也可以对接WHMCS，但是相关设置非常繁杂，一般也没什么主机商会使用这套系统。 SolusVM分为主控（Master）、被控（Slave）两套程序，如果你是KVM&#x2F;Xen虚拟化需要分别安装在两台机器中，无法直接在一台已经安装了Xen或者KVM的Slave上安装Master，但是你可以在Slave上开的VM中安装Master，当然如果你有别的的空的机器还是建议分开(OVZ可以使用Master with OpenVZ来实现安装在一台机器上)。主控的售价为10美元&#x2F;月，有30天免费试用，被控是2.5美元&#x2F;月&#x2F;终端。 官方网站：<a target="_blank" rel="noopener" href="https://solusvm.com/">https://solusvm.com/</a></p><h2 id="二、被控端配置（Slave）"><a href="#二、被控端配置（Slave）" class="headerlink" title="二、被控端配置（Slave）"></a>二、被控端配置（Slave）</h2><p>无论是主控还是被控需要纯净系统才能安装成功，不要存在例如cPanel、BT等面板。 被控端一般都是独立服务器，最好是有救援系统、可以自定义分区的服务器，当然部分主机商在重装的时候可以自定义配置或者提交工单告诉他们你要的分区配置。本次我们以德国Hetzner独立服务器为例来设置。</p><h3 id="1-进入救援系统设置"><a href="#1-进入救援系统设置" class="headerlink" title="1.进入救援系统设置"></a>1.进入救援系统设置</h3><p>Hetzner提供了一个非常方便的救援系统可以自定义安装系统和分区，进入控制面板，点击Rescue启动救援系统，再到Reset重启你的服务器，一般是第一个选项，按一次关机，等一会再按一次就开机了。连接SSH，端口为22，密码可以在开启救援系统的时候看到，root用户登录。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/hz.png"></p><p>进入后输入命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">installimage</span><br></pre></td></tr></table></figure><p>现在就可以选择你需要的系统了，本次是CentOS7。当然你也可以利用这个功能安装Proxmox。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/installos1.png"></p><p>Hostname设置</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/hostname.png"></p><h3 id="2-RAID设置"><a href="#2-RAID设置" class="headerlink" title="2.RAID设置"></a>2.RAID设置</h3><p>会显示一个蓝底页面来设置，最上面是RAID的设置，根据自己需要来。如图所示选择是否开启RAID，如果开启RAID要选择什么模式。因为服务器只有两块硬盘，所以最多只能RAID1。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/raid.png"></p><p>RAID0是性能最好的模式，两块硬盘都会被使用，但是非常不安全，一块硬盘挂掉就一起挂 RAID1最安全，但是性能下降，而且有一块硬盘作为备份无法使用，例如2X2T硬盘，你只有2TB可以使用。 No RAID即不开启RAID，性能略比RAID1好一些，同时也可以有效利用磁盘空间。三种RAID模式根据自己需要来使用，一般建议No RAID，如果你追求大空间和高性能可以RAID0，但是要自己注意备份。RAID1是最安全的保守模式，适合不追求空间大小和性能的使用，保证数据安全。</p><h3 id="3-磁盘分区"><a href="#3-磁盘分区" class="headerlink" title="3.磁盘分区"></a>3.磁盘分区</h3><p>重要的磁盘分区，SolusVM对于磁盘分区有一定要求。对于不同虚拟化有不同的要求，本次以KVM虚拟化为例。推荐设置Swap为4GB以上，&#x2F; 根目录为80GB以上，其余空间不分配，全部LVM交由SolusVM自动创建。 如图对磁盘分区，主要是需要注释掉注释使其生效，删除多余空间。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/lv-part.png"></p><p>对PART部分添加注释使其失效，以免影响分区。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/part.png"></p><p>全部完成后按F10保存设置，一路确定就可以等待自动安装了，如果出现错误会自动跳到出错的地方进行排查。</p><h3 id="4-完成安装系统"><a href="#4-完成安装系统" class="headerlink" title="4.完成安装系统"></a>4.完成安装系统</h3><p>全部完成后reboot重启服务器即可正常使用了，要注意的是Root密码为救援系统的密码。</p><h3 id="5-购买额外IP"><a href="#5-购买额外IP" class="headerlink" title="5.购买额外IP"></a>5.购买额外IP</h3><p>因为创建的是独立IPv4的KVM VPS，所以我们买几个IP。 Hetzner允许一台机器最多有6个单独IP，更多的IP需要你购买一整个段。单个IP的价格为0.84欧元&#x2F;个&#x2F;月。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/buyip.png"></p><p>如图所示购买IP，买一个段还是一个，理由是什么，一般如实填写就行，很快IP就会显示在控制面板中。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/buyip2-1024x473.png"></p><h3 id="6-桥接网卡设置"><a href="#6-桥接网卡设置" class="headerlink" title="6.桥接网卡设置"></a>6.桥接网卡设置</h3><p>创建KVM VPS多的一步就是桥接网卡，这一步非常重要也非常危险，一个步骤和参数错误就会导致网卡无法启动，丢掉网络无法连接，所以请仔细配置，提前备份主网卡文件。</p><h4 id="（1）安装软件包"><a href="#（1）安装软件包" class="headerlink" title="（1）安装软件包"></a>（1）安装软件包</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install bridge-utils -y</span><br></pre></td></tr></table></figure><p><strong>（2）备份网卡文件</strong>，CentOS7 中主网卡文件在&#x2F;etc&#x2F;sysconfig&#x2F;network–scripts&#x2F;中，文件名为enp2s0，CentOS6一般为ifcfg–eth0</p><h4 id="（3）修改网卡文件配置"><a href="#（3）修改网卡文件配置" class="headerlink" title="（3）修改网卡文件配置"></a>（3）修改网卡文件配置</h4><p>第一步修改主网卡文件，利用vi&#x2F;vim编辑器就行，三个网卡文件的内容参考后面的图。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysconfig/network-scripts/ifcfg-eth0</span><br></pre></td></tr></table></figure><p>第二步新建桥接网卡文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysconfig/network-scripts/ifcfg-br0</span><br></pre></td></tr></table></figure><p>再新建一个路由网卡文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysconfig/network-scripts/route-br0</span><br></pre></td></tr></table></figure><p>如图是我的配置，安装这个配置来就可以，当然这是在Hetzner服务器+CentOS系统下，不同系统不同服务器请根据实际情况设置。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/network.png"></p><p>之后重启网卡，如果文件没问题就会重启成功</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/network restart</span><br></pre></td></tr></table></figure><h3 id="7-安装被控端"><a href="#7-安装被控端" class="headerlink" title="7.安装被控端"></a>7.安装被控端</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://files.soluslabs.com/install.sh</span><br><span class="line">sh install.sh</span><br></pre></td></tr></table></figure><p> </p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/install-slave.png"></p><p>选择KVM即可，会全自动安装，安装完成后会提供一个ID+KEY，请务必留存，用于对接主控使用。 至此被控端设置已经完成。</p><h2 id="三、主控端安装（Master）"><a href="#三、主控端安装（Master）" class="headerlink" title="三、主控端安装（Master）"></a>三、主控端安装（Master）</h2><p>主控端服务器我们建议和被控离的近一点或者都在国外方便连接，以免主控在国内和被控连通性较差，命令反应慢。。。主控服务器没有具体要求，一般一个1GB的VPS就行了，当然OVZ都可以，省钱嘛，23333.</p><h3 id="（1）主控安装"><a href="#（1）主控安装" class="headerlink" title="（1）主控安装"></a>（1）主控安装</h3><p>本次是纯净的CentOS7 系统作为主控，运行安装命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://files.soluslabs.com/install.sh</span><br><span class="line">sh install.sh</span><br></pre></td></tr></table></figure><p>选择主控的安装，不要安装虚拟化。。。 全自动完成，成功后会给出控制面板后台和前台信息，用户名和密码默认为vpsadmin。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/network.png"></p><h3 id="（2）SSL安全连接"><a href="#（2）SSL安全连接" class="headerlink" title="（2）SSL安全连接"></a>（2）SSL安全连接</h3><p>SSL有两种方式，手动和自动。 1.手动安装SSL。 手动当然是自己的SSL证书，把&#x2F;usr&#x2F;local&#x2F;svmstack&#x2F;nginx&#x2F;ssl里的文件和密钥替换就行了，重启nginx</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service svmstack-nginx restart</span><br></pre></td></tr></table></figure><p>2.自动SSL就是利用Let’s Encrypt免费证书了，使用前确保你的域名已经成功解析到IP上。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install -y curl &amp;amp;&amp;amp;</span><br><span class="line">curl https://get.acme.sh  sh &amp;amp;&amp;amp; source ~/.bashrc</span><br><span class="line">acme.sh --issue -d solusvm.yourdomain.com -w /usr/local/solusvm/www/.verification</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --installcert -d solusvm.yourdomain.com \</span><br><span class="line">--keypath /usr/local/svmstack/nginx/ssl/ssl.key \</span><br><span class="line">--fullchainpath /usr/local/svmstack/nginx/ssl/ssl.crt \</span><br><span class="line">--reloadcmd &quot;service svmstack-nginx restart; \</span><br><span class="line">/usr/local/svmstack/sshwebsocket/quit; \</span><br><span class="line">/usr/local/svmstack/sshwebsocket/port_check; \</span><br><span class="line">cd /usr/local/svmstack/nginx/ssl &amp;amp;&amp;amp; cat ssl.key ssl.crt &amp;gt; ssl.pem&quot;</span><br></pre></td></tr></table></figure><h3 id="（3）汉化前台"><a href="#（3）汉化前台" class="headerlink" title="（3）汉化前台"></a>（3）汉化前台</h3><p>管理员后台只有英文，反正也不是很难。。前台中文可以优化一下用户体验。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/solusvm/language/client/</span><br><span class="line">wget &quot;https://documentation.solusvm.com/download/attachments/7667936/Simplified-Chinese.lang.txt?api=v2&quot; -O Chinese.lang.txt</span><br><span class="line">chown solusvm:solusvm Chinese.lang.txt</span><br></pre></td></tr></table></figure><h3 id="四、主控端配置和使用"><a href="#四、主控端配置和使用" class="headerlink" title="四、主控端配置和使用"></a>四、主控端配置和使用</h3><h4 id="（1）面板后台主页"><a href="#（1）面板后台主页" class="headerlink" title="（1）面板后台主页"></a>（1）面板后台主页</h4><p>一进来就是控制面板的主页，这就是你们的VPS在商家后台那里的样子啦</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/home-1024x506.png"></p><h4 id="（2）修改管理员密码"><a href="#（2）修改管理员密码" class="headerlink" title="（2）修改管理员密码"></a>（2）修改管理员密码</h4><p>安全是必须的，先修改管理员密码。Config-Admin就能添加管理员用户、修改管理员密码了。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/admin-passwd.png"></p><h4 id="（3）添加节点（Node）"><a href="#（3）添加节点（Node）" class="headerlink" title="（3）添加节点（Node）"></a>（3）添加节点（Node）</h4><p>Nodes——Add Node，设置名字、IP、端口，填写被控安装的ID和KEY，选择虚拟化，设置LV Group（被控端使用命令 vgs 即可查看），这样就添加好了节点。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/node-1024x692.png"></p><p>在添加完成后再编辑节点，可以设置创建VPS的数量，给该节点分配多少资源，否则都是0的话也无法成功创建。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/limit.png"></p><h4 id="（4）添加IP"><a href="#（4）添加IP" class="headerlink" title="（4）添加IP"></a>（4）添加IP</h4><p>IP Blocks——Add IP Block，创建一个IP组，起个名，网关、DNS，DNS默认用Google的就行，网关可以在Hetzner后台的主IP那里看到，一般尾数都是65。选择给哪个节点使用即可。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/ipblock-1024x694.png"></p><p>添加组后添加单个IP，如图所示。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/adip1-1024x243.png"></p><p>添加Mac地址，不要使用auto的Mac，如下图，在Hetzner的IP那里创建Mac地址，然后一个个添加即可。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/admac2-1.png"></p><h4 id="（5）创建与同步系统模板"><a href="#（5）创建与同步系统模板" class="headerlink" title="（5）创建与同步系统模板"></a>（5）创建与同步系统模板</h4><p>KVM的模板官方主流提供了4个最新版模板，对于OpenVZ需要使用OpenVZ官方的模板就行。 例如我们添加CentOS 7模板 官方的下载页面：<a target="_blank" rel="noopener" href="https://tdn.solusvm.com/">https://tdn.solusvm.com/</a> 这个页面介绍了你下载模板，怎么设置等。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/os-1024x728.png"></p><p>连接主控服务器的SSH，运行命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://templates.repo.onapp.com/solusvm/kvm/linux-centos-7-x86_64-minimal-latest.gz -O /home/solusvm/kvm/template/linux-centos-7-x86_64-minimal-latest.gz</span><br></pre></td></tr></table></figure><p>模板下载后会自己存放到&#x2F;home&#x2F;solusvm&#x2F;kvm&#x2F;template&#x2F;文件夹中 再到主控后台的Media——Add KVM Template添加模板即可，起一个名字，设置描述，选择正确的模板文件，安装TDN页面设置分区和root密码即可。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/addos.png"></p><p>添加完成后再编辑模板设置，可以对CPU模式、默认分配CPU和线程数等可以进行设置，推荐CPU设置为host-passthrough，这样可以显示真正的CPU参数，开启一些指令集来跑程序，如果使用默认的QEMU的话虽然方便迁移等操作，但是会关闭一部分指令集可能造成一些需求无法正常使用。 创建完全部模板后我们就需要把模板同步到被控服务器上去使用。 进入Media——Media Sync，选择你要同步的模板，再选择需要同步的节点，创建一个同步任务。创建成功后状态为Queue，等待一段时间变成Active状态后，代表你的模板已经成功同步到被控服务器上了。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/syncjob-1024x483.png"></p><h4 id="（6）创建VPS"><a href="#（6）创建VPS" class="headerlink" title="（6）创建VPS"></a>（6）创建VPS</h4><p>首先要创建一个用户，没有用户你创建给谁呢？Clients——Add Client即可。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/user1-1.png"></p><p>如果你创建的VPS都是一样的显然创建一个通用模板方便一些。Plans——Add KVM Plan，进行相关设置即可。如果你只是创建一个VPS，那么直接到Virtual Servers—— Add Virtual Servers即可。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/plan.png"></p><p>创建VPS，这里我们有一个Plan，所以直接选择Plan，分配给谁就好了。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/vps-1.png"></p><h4 id="（7）用户使用"><a href="#（7）用户使用" class="headerlink" title="（7）用户使用"></a>（7）用户使用</h4><p>管理员可以在List Virtual Servers里管理所有服务器，点击后面仪表盘的图标即可进行详细的管理，对于VPS的各种调试安装，还有限制网络速度等都可以实现。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/admincp1-1024x462.png"></p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/admincp2.png"></p><p>对于用户来说，直接登录前台地址，输入用户名密码即可。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/usercp1-1024x796.png"></p><h2 id="五、其他"><a href="#五、其他" class="headerlink" title="五、其他"></a>五、其他</h2><p>这样我们就完成了创建KVM VPS的基本操作了，对于邮件提醒、更详细的控制策略等都可以在后台设置，慢慢摸索就好啦。 对于对接财务系统的设置官方给出了稳定和插件可以使用，地址：<a target="_blank" rel="noopener" href="https://docs.solusvm.com/display/DOCS/Modules?src=contextnavpagetreemode">https://docs.solusvm.com/display/DOCS/Modules?src=contextnavpagetreemode</a></p><h2 id="六、总结"><a href="#六、总结" class="headerlink" title="六、总结"></a>六、总结</h2><p>SolusVM是一款非常成熟的商业化VPS面板，如果你想创建VPS卖或自己使用等都非常可靠和方便。如果你有不懂的地方或者发现了文章中的各种错误，欢迎通过评论的方式之处，也可以到下方的Telegram群组中讨论。</p><h2 id="七、参考资料"><a href="#七、参考资料" class="headerlink" title="七、参考资料"></a>七、参考资料</h2><p><strong>本文的编写参考了以下文档：</strong> 1.SolusVM官方文档：<a target="_blank" rel="noopener" href="https://docs.solusvm.com/">https://docs.solusvm.com/</a> 2.博客：Senraの小窝 <a target="_blank" rel="noopener" href="http://www.senra.me/install-solusvm-master-and-slave-in-centos6/">IDC零基础系列——CentOS6安装SolusVM(从系统分区到删库跑路)</a> 3.安装SSL文档：<a target="_blank" rel="noopener" href="https://github.com/Neilpang/acme.sh/wiki/Deploy-ssl-to-SolusVM">Deploy ssl to SolusVM</a> 4.特别感谢：<a target="_blank" rel="noopener" href="http://www.senra.me/">@Senra</a>和<a target="_blank" rel="noopener" href="https://eqblog.com/">@EQBlog</a>两位大佬！！！ <strong>→→→可能你需要创建NAT OpenVZ VPS？请参考此篇文章：Leonn的博客 <a target="_blank" rel="noopener" href="https://blog.liyuans.com/archives/tutorial-of-nat-vps-build-via-solusvm.html#_label1_3">小白教程：使用 SolusVM 开通 NAT VPS</a></strong></p></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://jarod.vip/2018/10/07/%E9%AD%94%E6%94%B9bbr%E4%B8%80%E9%94%AE%E8%84%9A%E6%9C%AC%E5%90%88%E9%9B%86/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Jarod"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jarod's Blog"><meta itemprop="description" content="记录生活中的点点滴滴"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content=" | Jarod's Blog"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2018/10/07/%E9%AD%94%E6%94%B9bbr%E4%B8%80%E9%94%AE%E8%84%9A%E6%9C%AC%E5%90%88%E9%9B%86/" class="post-title-link" itemprop="url">魔改BBR一键脚本合集</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-10-07 20:38:45" itemprop="dateCreated datePublished" datetime="2018-10-07T20:38:45+08:00">2018-10-07</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-12-28 15:54:18" itemprop="dateModified" datetime="2025-12-28T15:54:18+08:00">2025-12-28</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Linux教程</span></a> </span></span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>3.1k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>3 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><p><strong>第一部分：OPENVZ平台</strong> 一、OpenVZ 平台 Google BBR（魔改） 一键安装脚本 来源：<a target="_blank" rel="noopener" href="https://blog.kuoruan.com/116.html"><strong>扩软</strong></a> 安装：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/kuoruan/shell-scripts/master/ovz-bbr/ovz-bbr-installer.sh</span><br><span class="line">chmod +x ovz-bbr-installer.sh</span><br><span class="line">./ovz-bbr-installer.sh</span><br></pre></td></tr></table></figure><p>卸载：.&#x2F;ovz-bbr-installer.sh uninstall 修改端口配置：vi &#x2F;usr&#x2F;local&#x2F;haproxy-lkl&#x2F;etc&#x2F;port-rules 。在文件里添加需要加速的端口，每行一条，可以配置单个端口或者端口范围，以 # 开头的行将被忽略。 例如：8800 或者 8800-8810 配置完成之后，只需要重启 haproxy-lkl 即可。使用 systemctl 或者 service 命令来启动、停止和重启 HAporxy-lkl：</p><p>systemctl {startstoprestart} haproxy-lkl</p><p>或</p><p>service haproxy-lkl {startstoprestart}</p><p><strong>二、OpenVZ平台魔改BBR一键脚本之Rinetd方式</strong> 来源：<a target="_blank" rel="noopener" href="https://sometimesnaive.org/article/54">南琴浪</a>  <a target="_blank" rel="noopener" href="https://github.com/nanqinlang-tcp/tcp_nanqinlang/tree/master/Rinetd/bash">GITHUB项目地址</a> 优点：Rinetd就是另外一种lkl bbr，好处是不需要开启TUN&#x2F;TAP，对于后台没有或者找不到这个模块的，刚好可以用一下。 <strong>缺点：不支持IP段加速，每个要加速的端口都需要单独配置。</strong> 更新： 2018-03-24 新增 多网卡 适配 <strong>Debian or Ubuntu</strong> 单网卡（单 IP） 服务器：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/nanqinlang-tcp/tcp_nanqinlang/master/Rinetd/bash/tcp_nanqinlang-rinetd-debian+ubuntu.sh</span><br><span class="line">bash tcp_nanqinlang-rinetd-debian+ubuntu.sh</span><br></pre></td></tr></table></figure><p>多网卡（多 IP） 服务器，会为所有网卡（所有 IP）提供加速：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/nanqinlang-tcp/tcp_nanqinlang/master/Rinetd/bash/tcp_nanqinlang-rinetd-debian+ubuntu-multiNIC.sh</span><br><span class="line">bash tcp_nanqinlang-rinetd-debian+ubuntu-multiNIC.sh</span><br></pre></td></tr></table></figure><p>CentOS 7</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 单网卡</span><br><span class="line">wget https://raw.githubusercontent.com/nanqinlang-tcp/tcp_nanqinlang/master/Rinetd/bash/tcp_nanqinlang-rinetd-centos.sh</span><br><span class="line">bash tcp_nanqinlang-rinetd-centos.sh</span><br><span class="line"></span><br><span class="line"># 多网卡</span><br><span class="line">wget https://raw.githubusercontent.com/nanqinlang-tcp/tcp_nanqinlang/master/Rinetd/bash/tcp_nanqinlang-rinetd-centos-multiNIC.sh</span><br><span class="line">bash tcp_nanqinlang-rinetd-centos-multiNIC.sh</span><br></pre></td></tr></table></figure><p>运行脚本会出现下面几个选项： <strong>安装 rinetd-bbr</strong> 此脚本会在&#x2F;home&#x2F;tcp_nanqinlang进行安装，所以安装完成后不要动这个文件夹了（除非你想修改端口）。安装过程中，会提示输入端口号。多个端口号用空格隔开。**不支持端口段。**安装完成后，会开启 rinetd-bbr。以后重启机器也会随开机自启。使用前请注意自己的 iptables 相关设置。</p><h3 id="检查-rinetd-bbr-运行状态"><a href="#检查-rinetd-bbr-运行状态" class="headerlink" title="检查 rinetd-bbr 运行状态"></a><strong>检查 rinetd-bbr 运行状态</strong></h3><p>此命令用于检查 rinetd-bbr 运行与否，可通过返回的提示判断。</p><h3 id="卸载-rinetd-bbr"><a href="#卸载-rinetd-bbr" class="headerlink" title="卸载 rinetd-bbr"></a><strong>卸载 rinetd-bbr</strong></h3><p>运行此命令会删除 &#x2F;home&#x2F;tcp_nanqinlang 、移除 rc.local 对应开机自启项和清空 iptables raw 表。属于完整卸载，不会有残留。且卸载后无需重启。 <strong>三、OpenVZ 魔改 BBR - LKL 一键脚本</strong> 来源：<a target="_blank" rel="noopener" href="https://sometimesnaive.org/article/39">南琴浪</a> <a target="_blank" rel="noopener" href="https://github.com/tcp-nanqinlang">GITHUB项目地址</a> 优点：支持IP段加速 安装方法：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># Debian 8+</span><br><span class="line"># 64 bit</span><br><span class="line"># ldd &gt; = 2.14</span><br><span class="line"># tun/tap enabled</span><br><span class="line">wget https://github.com/tcp-nanqinlang/lkl-haproxy/releases/download/1.1.1/tcp_nanqinlang-haproxy-debian.sh</span><br><span class="line">bash tcp_nanqinlang-haproxy-debian.sh</span><br><span class="line"></span><br><span class="line"># CentOS 7</span><br><span class="line"># 64 bit</span><br><span class="line"># ldd &gt; = 2.14</span><br><span class="line"># tun/tap enabled</span><br><span class="line">wget https://github.com/tcp-nanqinlang/lkl-haproxy/releases/download/1.1.1/tcp_nanqinlang-haproxy-centos.sh</span><br><span class="line">bash tcp_nanqinlang-haproxy-centos.sh</span><br></pre></td></tr></table></figure><p> </p><p>以下进行脚本使用说明：</p><h3 id="安装-LKL"><a href="#安装-LKL" class="headerlink" title="安装 LKL"></a>安装 LKL</h3><p>此命令用于安装 LKL。 在&#x2F;home&#x2F;tcp_nanqinlang进行安装，所以安装完成后不要动这个文件夹了（除非你想修改端口）。 安装过程中，会提示你选择</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">单个端口</span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">端口段</span><br></pre></td></tr></table></figure><p>输入，具体已在运行脚本的提示中有说明，这里不再赘述。 安装完成后，会开启 LKL。以后重启机器也会随开机自启。 以后若需要修改转发端口，请将&#x2F;home&#x2F;tcp_nanqinlang&#x2F;haproxy.cfg中的端口号和&#x2F;home&#x2F;tcp_nanqinlang&#x2F;redirect.sh中的端口号改为你想要的端口或端口段，修改完成后重启服务器。 使用前请注意自己的 iptables 相关设置。</p><h3 id="检查-LKL-运行状态"><a href="#检查-LKL-运行状态" class="headerlink" title="检查 LKL 运行状态"></a>检查 LKL 运行状态</h3><p>此命令用于检查 LKL 运行与否，可通过返回的提示判断。</p><h3 id="卸载-LKL"><a href="#卸载-LKL" class="headerlink" title="卸载 LKL"></a>卸载 LKL</h3><p>运行此命令会卸载 haproxy、删除 &#x2F;home&#x2F;tcp_nanqinlang、移除 rc.local 开机自启项。稍后请自行移除iptables相关规则。 该脚本项目最新的地址是：<a target="_blank" rel="noopener" href="https://github.com/tcp-nanqinlang">https://github.com/tcp-nanqinlang</a></p><h2 id="第二部分：KVM平台、独服"><a href="#第二部分：KVM平台、独服" class="headerlink" title="第二部分：KVM平台、独服"></a><strong>第二部分：KVM平台、独服</strong></h2><p>一、BBR+BBR魔改+Lotsever(锐速)一键脚本 for Centos&#x2F;Debian&#x2F;Ubuntu 来源：<a target="_blank" rel="noopener" href="https://www.94ish.net/1635.html">千影</a> 支持系统 Centos 6+ &#x2F; Debian 7+ &#x2F; Ubuntu 14+ BBR魔改版不支持Debian 8 安装：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget -N --no-check-certificate &quot;https://raw.githubusercontent.com/chiakge/Linux-NetSpeed/master/tcp.sh&quot;</span><br><span class="line">chmod +x tcp.sh</span><br><span class="line">./tcp.sh</span><br></pre></td></tr></table></figure><p><a target="_blank" rel="noopener" href="https://maijiaoben.com/wp-content/uploads/2018/03/1.png"><img src="https://maijiaoben.com/wp-content/uploads/2018/03/1.png" alt="魔改BBR一键安装"></a></p><p>魔改BBR一键安装</p><p>说明：运行脚本后会出现上图的界面。安装魔改BBR先选择1安装对应内核，安装完毕后重启机器，然后再进入脚本目录重新执行脚本，选择4安装魔改BBR。 如果出现下图界面，需要选<strong>NO</strong>：</p><p><a target="_blank" rel="noopener" href="https://maijiaoben.com/wp-content/uploads/2018/03/2.png"><img src="https://maijiaoben.com/wp-content/uploads/2018/03/2-1024x677.png" alt="此界面要选NO"></a></p><p>此界面要选NO</p></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://jarod.vip/2018/10/07/%E5%9C%A8centos-7%E4%B8%AD%E5%AE%89%E8%A3%85kvm%E5%B9%B3%E5%8F%B0%E6%90%AD%E5%BB%BAvps-2/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Jarod"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jarod's Blog"><meta itemprop="description" content="记录生活中的点点滴滴"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content=" | Jarod's Blog"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2018/10/07/%E5%9C%A8centos-7%E4%B8%AD%E5%AE%89%E8%A3%85kvm%E5%B9%B3%E5%8F%B0%E6%90%AD%E5%BB%BAvps-2/" class="post-title-link" itemprop="url">在CentOS 7中安装KVM平台搭建VPS</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-10-07 17:24:42" itemprop="dateCreated datePublished" datetime="2018-10-07T17:24:42+08:00">2018-10-07</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-12-28 15:54:18" itemprop="dateModified" datetime="2025-12-28T15:54:18+08:00">2025-12-28</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Linux教程</span></a> </span></span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>2.4k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>2 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><p>KVM即Kernal-based Virtual Machine, 是一种高效且成熟稳定的虚拟化技术, 支持所有的操作系统. 因此, 掌握服务器上搭建KVM平台是很有意义的. 通过虚拟机的建立以及IP分配, 虚拟机可以当做一台完全独立的服务器来使用, 即我们常用的VPS. 搭建虚拟机平台对宿主机系统的要求较高. KVM虚拟化要求宿主机的CPU支持Intel VT或AMD-V技术 (请执行cat &#x2F;proc&#x2F;cpuinfo查看), CPUBenchMark至少在1000以上, 建议5000或更多 (ATOM D525这种就不要来装虚拟机了). 系统内存要求至少为4G, 建议8G或更多. 硬盘要求20G以上. 操作系统必须为64位. 服务器至少分配2枚或以上的独立IP地址 (每个VPS一枚, 宿主机一枚). 本次教程, 我们以最新版本的CentOS 7为例, 介绍KVM平台的搭建.  </p><h2 id="1-系统环境准备"><a href="#1-系统环境准备" class="headerlink" title="1, 系统环境准备"></a>1, 系统环境准备</h2><p>(1) 设置服务器名(Hostname) 任何与网络相关的Linux操作都要求设置好服务器名. 请确保您已经正确设置服务器名: 当您在SSH中执行hostname -f命令时, 应看到servername.domainname.com; 当您执行hostname命令时, 应看到servername. 具体设置方法我已强调数十遍, 这里不再赘述. 若未设置好服务器名, 请不要继续.   (2) 软件更新 CentOS系统下执行yum -y update命令更新软件.   (3) 检查网络与IP信息 CentOS 7系统中执行ip addr命令查看网卡及IP地址信息. 查看一下绑定您的宿主机外网主IP地址的网卡名称, 记下它, 我这里是ens9. 查看一下是否有其他的虚拟网卡绑定了额外的外网IP地址, 若有, 请删除对应的虚拟网卡. 本次教程中, 我们假设给宿主机分配的IP地址段为标准网段100.100.100.200&#x2F;29共8个IP, 则网络地址100.100.100.200, 网关100.100.100.201, 宿主机IP 100.100.100.202, VPS IP段100.100.100.203 ~ 100.100.100.206, 广播地址100.100.100.207, 子网掩码255.255.255.248.  </p><h2 id="2-桌面环境的搭建"><a href="#2-桌面环境的搭建" class="headerlink" title="2, 桌面环境的搭建"></a>2, 桌面环境的搭建</h2><p>如果您仅使用一台服务器搭建KVM, 那我建议搭建桌面环境并搭建VNC服务器, 这样在管理KVM虚拟机和安装操作系统时较为方便. 我们以GNOME桌面环境为例介绍VNC服务器的搭建. GNOME桌面环境安装很简单, 执行下面这行命令即可:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum groupinstall &quot;GNOME Desktop&quot;</span><br></pre></td></tr></table></figure><p>然后安装VNC服务器. 执行:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install tigervnc-server</span><br></pre></td></tr></table></figure><p>新建用户, 用来连接VNC, 并配置用户的连接文件. 执行:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">useradd jarod</span><br><span class="line">cp /lib/systemd/system/vncserver@.service /etc/systemd/system/vncserver@:1.service</span><br></pre></td></tr></table></figure><p>编辑文件: &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;vncserver@:1.service 将文件中的<user>替换为我们的用户名jarod, 并取消行首的注释符. 配置防火墙:</user></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --zone=public --add-service vnc-server</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><p>然后, 切换到用户jarod， 启动VNC服务器: su jarod vncserver 此时, 会提示输入VNC密码, 设置好后回车即可. 最后切换回root, 设置随开机启动:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">su root</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl enable vncserver@:1.service</span><br></pre></td></tr></table></figure><p>这样, 我们就配置好VNC服务器了. 在本地电脑上使用VNC客户端连接100.100.100.202:5901即可访问服务器的GNOME桌面环境. 第一次使用VNC连接的时候会提示输入管理员密码, 如下图. <img src="https://www.jarods.org/wp-content/uploads/2018/10/0.png" alt="0"> 此时请输入您的root用户密码. 然后会提示一系列配置信息, 直接NEXT就好.  </p><h2 id="3-KVM的安装"><a href="#3-KVM的安装" class="headerlink" title="3, KVM的安装"></a>3, KVM的安装</h2><p>KVM安装很简单. 在SSH中执行下面这行命令即可.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install qemu-kvm qemu-img virt-manager libvirt libvirt-python libvirt-client virt-install virt-viewer</span><br></pre></td></tr></table></figure><h2 id="4-在宿主机上新建VPS"><a href="#4-在宿主机上新建VPS" class="headerlink" title="4, 在宿主机上新建VPS"></a>4, 在宿主机上新建VPS</h2><p>首先, 使用VNC连接宿主机. 进入桌面后, 找到Virtual Machine Manager, 如下图. <img src="https://www.jarods.org/wp-content/uploads/2018/10/1.png" alt="1"> 打开后, 点击图标Create a new virtual machine. <img src="https://www.jarods.org/wp-content/uploads/2018/10/2.png" alt="2"> 然后按步骤载入系统镜像. 如果没有系统镜像的, 可以去我的下载站<a target="_blank" rel="noopener" href="http://wget.pro下载/">http://wget.pro下载</a>. <img src="https://www.jarods.org/wp-content/uploads/2018/10/3.png" alt="3"> <img src="https://www.jarods.org/wp-content/uploads/2018/10/4.png" alt="4"> <img src="https://www.jarods.org/wp-content/uploads/2018/10/5.png" alt="5"> <img src="https://www.jarods.org/wp-content/uploads/2018/10/6.png" alt="6"> 接着分配内存和硬盘. KVM是实虚拟, 因此分配内存后宿主机就不能再使用这部分资源了. <img src="https://www.jarods.org/wp-content/uploads/2018/10/7.png" alt="7"> <img src="https://www.jarods.org/wp-content/uploads/2018/10/8.png" alt="8"> 最后分配网卡. 这里我们要选择桥接模式Bridge, 并选择宿主机的出口网卡. 如下图. <img src="https://www.jarods.org/wp-content/uploads/2018/10/9.png" alt="9"> 这样, 我们就新建完成了VPS, 可以安装操作系统了. <img src="https://www.jarods.org/wp-content/uploads/2018/10/10.png" alt="10"> 是不是很简单呢? 安装系统的时候有一个步骤是配置网络信息, 这里我们的DHCP是不生效的, 需要在VPS上获取IP. 选择Configure Network Manually, 然后按照第一部分第三小节的信息来配置即可. <img src="https://www.jarods.org/wp-content/uploads/2018/10/11.png" alt="11"> 至此, 大功告成. 我们在VPS上安装SSH服务器后, 就可以对它进行完全独立的网络访问了.  </p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料:"></a>参考资料:</h3><p>1, Kishore, S. <em>VNC-Server installation on CentOS 7</em>. <a target="_blank" rel="noopener" href="https://www.howtoforge.com/vnc-server-installation-on-centos-7">https://www.howtoforge.com/vnc-server-installation-on-centos-7</a> <a target="_blank" rel="noopener" href="http://linux.dell.com/files/whitepapers/KVM_Virtualization_in_RHEL_7_Made_Easy.pdf">2, Rosa, J. <em>KVM Virtualization in RHEL 7 Made Easy</em>. Dell.</a></p></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://jarod.vip/2018/10/03/%E4%B8%80%E9%94%AE%E7%BD%91%E7%BB%9C%E5%AE%89%E8%A3%85%E6%9C%80%E6%96%B0%E7%BA%AF%E5%87%80centos7-x%E8%87%AA%E5%8A%A8%E5%88%86%E5%8C%BA%E6%89%A9%E5%AE%B9%E7%89%88%E5%8F%91%E5%B8%83/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Jarod"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jarod's Blog"><meta itemprop="description" content="记录生活中的点点滴滴"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content=" | Jarod's Blog"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2018/10/03/%E4%B8%80%E9%94%AE%E7%BD%91%E7%BB%9C%E5%AE%89%E8%A3%85%E6%9C%80%E6%96%B0%E7%BA%AF%E5%87%80centos7-x%E8%87%AA%E5%8A%A8%E5%88%86%E5%8C%BA%E6%89%A9%E5%AE%B9%E7%89%88%E5%8F%91%E5%B8%83/" class="post-title-link" itemprop="url">一键网络安装最新纯净CentOS7.X(自动分区扩容版)发布</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-10-03 14:20:00" itemprop="dateCreated datePublished" datetime="2018-10-03T14:20:00+08:00">2018-10-03</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-12-28 15:54:18" itemprop="dateModified" datetime="2025-12-28T15:54:18+08:00">2025-12-28</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Linux教程</span></a> </span></span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>2.3k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>2 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><p>简介 之前的CentOS7系统模板是手动分区版，是为兼容磁盘较小的服务器以及使得用户可以手动挂载自己的数据盘，避免在安装时因为自动分区导致将用户数据盘格式化等问题，因此手动分区版在自动安装完成后，系统默认只分配了4.5GB，剩余磁盘需要进行手动分区扩容。 所以，今天的自动分区版发布了，毕竟手动分区还要花费几分钟时间去手动操作，为什么不在安装时就自动分配所有的磁盘空间给（&#x2F;）根分区呢？这样安装完直接就是所有磁盘空间都被应用，省去了人工去分区的精力和时间，效率就是金钱。这真是太棒了。 当然手动分区版的存在也是必要的，毕竟有些MJJ们需要手动去分区，例如想给home自定义分区或者挂载数据盘，脚本中默认为自动分区版，因此对于需要手动分区的MJJ们可以手动修改安装地址为手动分区版地址即可。两个版本的唯一差别就是一个会自动分区(所有空间划给&#x2F;根分区)，一个需要手动分区(安装完成后可自定义手动划分分区)。两版安装完均是当前最新的CentOS7.X，CentOS发布什么最新版本，安装完就是什么最新的版本。截至2018年8月CentOS发布的为7.5版。 预览图片（套路云一键重装完） 配置为：1C&#x2F;1G&#x2F;40G&#x2F;200M&#x2F;1T的机器 <img src="https://www.jarods.org/wp-content/uploads/2018/10/5b8514af9ddb6.png"></p><h3 id="如何使用和做"><a href="#如何使用和做" class="headerlink" title="如何使用和做"></a>如何使用和做</h3><p>一键安装具有两种系统模板，以下教程中默认使用自动分区版（一个是自动分区版，一个是手动分区版，你应该按照你的需求进行选择） <code>自动分区版：https://opendisk.cxthhhhh.com/OperatingSystem/CentOS/CentOS_7.X_NetInstall_AutoPartition.vhd.gz</code> <code>手动分区版：https://opendisk.cxthhhhh.com/OperatingSystem/CentOS/CentOS_7.X_NetInstall.vhd.gz</code> 如需手动进行分区（可根据您的需求定制化，比如挂载数据盘等），请将下面代码中的系统模板地址替换为手动分区版的地址，代码中默认为自动分区版。 我提供两种方式供你采用。（任选其一）。 1. 进入恢复模式（推荐）或在常规模式下，查看要安装的磁盘。（以下命令需要修改到您自己的磁盘） ①如果你是VPS，你应该像这样运行 <code>wget -qO- https://opendisk.cxthhhhh.com/OperatingSystem/CentOS/CentOS_7.X_NetInstall_AutoPartition.vhd.gz gunzip -dc dd of=/dev/vda</code> ②如果你是一个专用服务器，你应该像这样运行 <code>wget -qO- https://opendisk.cxthhhhh.com/OperatingSystem/CentOS/CentOS_7.X_NetInstall_AutoPartition.vhd.gz gunzip -dc dd of=/dev/sda</code> 2. 在正常模式下执行以下命令（通过MoeClub.org提供的脚本） (你需要注意，下面命令中引号是”英文状态引号”。) <code>wget --no-check-certificate -qO InstallNET.sh &#39;https://moeclub.org/attachment/LinuxShell/InstallNET.sh&#39; &amp;&amp; bash InstallNET.sh -dd &#39;https://opendisk.cxthhhhh.com/OperatingSystem/CentOS/CentOS_7.X_NetInstall_AutoPartition.vhd.gz&#39;</code></p><h3 id="您得明白"><a href="#您得明白" class="headerlink" title="您得明白"></a>您得明白</h3><p>1. 它将帮助您重新安装最新的CentOS7.X系统。（正式，纯粹，安全，高效） 2. 执行后，您可能需要15-45分钟后才能通过IP:22进行连接。 3. 新安装的系统root密码为[cxthhhhh.com] 。 4. 系统首次启动后，请等待自动安装完成，系统将自动重启，然后才能使用。（安装过程中的手动干预可能会导致错误） 5. IPV4和IPV6是开启的，并通过DHCP获取网络信息。 6. 系统的DNS将被设置为1.1.1.1和8.8.8.8，用来保护您的隐私。 7. 系统使用官方CentOS镜像，将自动匹配yum信息。拒绝服务提供商劫持。 8. 登录信息标准化，易于管理。您需要在登录后修改它。 9. 完成测试，非常适合Azure，Google Cloud，Vultr，Online，Net，OVH，阿里云，腾讯云中的许多专用服务器和KVM服务器。欢迎您的反馈。 10. 对于手动分区版系统模板，默认分配磁盘大小为4.5G。 11. 当你使用我的解决方案，我想说，感谢您信任我。我非常感谢您。我很高兴可以帮助到你。如果您不信任我的解决方案，请关闭页面，信任这是平等的。我相信技术不分国家，欢迎一起讨论，共同研究最新技术。 12. 自动分区版将会把所有的硬盘剩余空间分配给（&#x2F;）根分区，请注意，你只可以在全新的服务器上使用自动分区版，如果你有数据在服务器上，请使用手动分区版（根据需求手动挂载您的数据盘），这是为了防止自动分区版在安装时将您的数据盘格式化。 13. 在每次重装前，请保证你已经通过服务商面板重装过一次系统（CentOS&#x2F;Debian&#x2F;Ubuntu均可），不可以在已经DD安装过的系统上使用萌咖的自动脚本再次DD本系统，否则会报错，系统无法启动。手动DD不受此问题影响。 14. 在安装过程中，请勿手动进行操作，也许会导致错误。如果您在屏幕（VNC）上看到以下界面，代表正在安装系统，请耐心等待。 <img src="https://www.jarods.org/wp-content/uploads/2018/10/CentOS_7.X_NetInstall.png"></p><h3 id="开始享受纯净的CentOS7。"><a href="#开始享受纯净的CentOS7。" class="headerlink" title="开始享受纯净的CentOS7。"></a>开始享受纯净的CentOS7。</h3></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><nav class="pagination"><a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/20/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><span class="page-number current">21</span><a class="page-number" href="/page/22/">22</a><span class="space">&hellip;</span><a class="page-number" href="/page/30/">30</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/22/"><i class="fa fa-angle-right"></i></a></nav></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Jarod</span></div><div class="wordcount"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i> </span><span title="站点总字数">755k</span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="站点阅读时长">11:26</span></span></div><div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动</div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript></body></html>