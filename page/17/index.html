<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"jarod.vip",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"always",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="记录生活中的点点滴滴"><meta property="og:type" content="website"><meta property="og:title" content="Jarod&#39;s Blog"><meta property="og:url" content="https://jarod.vip/page/17/index.html"><meta property="og:site_name" content="Jarod&#39;s Blog"><meta property="og:description" content="记录生活中的点点滴滴"><meta property="og:locale" content="zh_CN"><meta property="article:author" content="Jarod"><meta property="article:tag" content="VPS,hexo,linux,debian,windows,macos"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://jarod.vip/page/17/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!0,isPost:!1,lang:"zh-CN"}</script><title>Jarod's Blog</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="Jarod's Blog" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">Jarod's Blog</h1><span class="logo-line-after"><i></i></span></a></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content index posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://jarod.vip/2018/10/20/%E7%AE%80%E5%8D%95%E4%B8%89%E6%AD%A5%E7%BB%99%E7%BD%91%E7%AB%99%E7%94%B3%E8%AF%B7%E5%AE%89%E8%A3%85letsencrypt%E5%85%8D%E8%B4%B9ssl%E8%AF%81%E4%B9%A6-acme-sh%E8%87%AA%E5%8A%A8%E7%BB%AD%E6%9C%9F/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Jarod"><meta itemprop="description" content="记录生活中的点点滴滴"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jarod's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2018/10/20/%E7%AE%80%E5%8D%95%E4%B8%89%E6%AD%A5%E7%BB%99%E7%BD%91%E7%AB%99%E7%94%B3%E8%AF%B7%E5%AE%89%E8%A3%85letsencrypt%E5%85%8D%E8%B4%B9ssl%E8%AF%81%E4%B9%A6-acme-sh%E8%87%AA%E5%8A%A8%E7%BB%AD%E6%9C%9F/" class="post-title-link" itemprop="url">简单三步给网站申请安装letsencrypt免费SSL证书-acme.sh自动续期</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-10-20 01:03:24" itemprop="dateCreated datePublished" datetime="2018-10-20T01:03:24+08:00">2018-10-20</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-09-29 21:27:45" itemprop="dateModified" datetime="2022-09-29T21:27:45+08:00">2022-09-29</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Linux教程</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>8.3k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>8 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><p>昨天晚上花了一个小时的时间把挖站否VPS监控SSL证书由原来的TrustAsia即赛门铁克(Symantec)个人DV SSL证书换成了letsencrypt免费SSL证书，原因是Chrome 70开始将开始不再信任 Symantec证书了，自己正在用的Chromium浏览器已经不能再打开Symantec证书的网站了。</p><p>赛门铁克(Symantec)个人DV SSL证书是在腾讯云申请的，实际上国内的阿里云、七牛云、又拍云等都提供了免费一年赛门铁克(Symantec)个人DV SSL证书。<strong>自己犯了错，干脆把之前的SSL产品趁“打烊”之前清仓大处理了？</strong>这也怪不得赛门铁克(Symantec)在国内搞了这么多的<strong>免费推广</strong>。</p><p>本篇文章就来分享一下利用<strong>acme.sh</strong>来一键申请和安装letsencrypt免费SSL证书，基本上可以适合各大VPS主机服务器，而且acme.sh可以自动更新SSL证书，再也不用担心SSL证书会过期的问题的。从我的个人使用经验来看，官方推荐的Certbot还是不如<strong>acme.sh</strong>好用一些。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/15396999612187d2e20ad1b.jpg"></p><p>更多的VPS主机及SSL证书还可以看看：</p><ol><li>免费SSL证书收集整理汇总-免费给网站添加Https安全加密访问</li><li>CN2 GIA VPS主机收集整理汇总-电信,联通,移动三网CN2 GIA线路VPS主机</li><li>启用HSTS并加入HSTS Preload List让网站Https访问更加安全-附删除HSTS方法</li></ol><p><strong>一、第一步：一键安装acme.sh</strong></p><p>网站：</p><ol><li><a target="_blank" rel="noopener" href="https://letsencrypt.org/">https://letsencrypt.org/</a></li><li><a target="_blank" rel="noopener" href="https://github.com/Neilpang/acme.sh">https://github.com/Neilpang/acme.sh</a></li></ol><p>使用以下可以一键安装：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://get.acme.sh  sh</span><br></pre></td></tr></table></figure><p>或者:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -O - https://get.acme.sh  sh</span><br></pre></td></tr></table></figure><p>使用喜欢Git命令也可以用以下命令安装:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/Neilpang/acme.sh.git</span><br><span class="line">cd ./acme.sh</span><br><span class="line">./acme.sh --install</span><br></pre></td></tr></table></figure><p>脚本主要做了以下事情:</p><blockquote><p>1.生成复制了acme.sh 到你的($HOME): ~&#x2F;.acme.sh&#x2F;目录下 ，后面所有的证书都会在这个目录生成.</p><p>2.Create alias for: acme.sh&#x3D;~&#x2F;.acme.sh&#x2F;acme.sh. 注意：<strong>安装完成后你需要关闭再打开终端才可以让alias 生效。</strong></p><p>3.增加了一个定时任务，用于SSL证书更新.</p></blockquote><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/1539699961197b8ffc25e88.gif"></p><p>你可以使用Crontab -l来查看当前的定时任务：</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/1539699961258598e4684a7.gif"></p><p>同时你也可以使用SFTP来查看acme.sh 文件夹。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/153969996126143bb7e5bbc.gif"></p><p><strong>二、第二步：一键签发SSL证书</strong></p><p>2.1 单个域名SSL</p><p>注意：-w后面是域名的根目录，请根据实际修改.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --issue -d wzfou.com -w /home/wwwroot/wzfou.com</span><br><span class="line">#默认签发的是RSA，如果你想签发ECC证书，请使用以下命令</span><br><span class="line">acme.sh --issue -d wzfou.com -w /home/wwwroot/wzfou.com --keylength ec-256 </span><br></pre></td></tr></table></figure><p>或者:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --issue -d wzfou.com -w /home/wzfou/public_html</span><br><span class="line">#默认签发的是RSA，如果你想签发ECC证书，请使用以下命令</span><br><span class="line">acme.sh --issue -d wzfou.com -w /home/wzfou/public_html --keylength ec-256</span><br></pre></td></tr></table></figure><p>或者:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --issue -d wzfou.com -w /var/www/html</span><br><span class="line">#默认签发的是RSA，如果你想签发ECC证书，请使用以下命令</span><br><span class="line">acme.sh --issue -d wzfou.com -w /var/www/html --keylength ec-256</span><br></pre></td></tr></table></figure><p>2.2 多个域名SSL</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --issue -d wzfou.com -d www.wzfou.com -d cp.wzfou.com -w /home/wwwroot/wzfou.com</span><br><span class="line">#默认签发的是RSA，如果你想签发ECC证书，请使用以下命令</span><br><span class="line">acme.sh --issue -d wzfou.com -d www.wzfou.com -d cp.wzfou.com -w /home/wwwroot/wzfou.com --keylength ec-256 </span><br></pre></td></tr></table></figure><p>2.3 泛域名SSL</p><p>注意：泛域名SSL证书签发要用到DNS验证的方式，参考2.4部分。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --issue --dns dns_dp -d wzfou.com -d *.wzfou.com</span><br><span class="line">#默认签发的是RSA，如果你想签发ECC证书，请使用以下命令</span><br><span class="line">acme.sh --issue --dns dns_dp -d wzfou.com -d *.wzfou.com --keylength ec-256</span><br><span class="line">#可选长度有：</span><br><span class="line"> ec-256 (prime256v1, “ECDSA P-256”)</span><br><span class="line"> ec-384 (secp384r1, “ECDSA P-384”)</span><br></pre></td></tr></table></figure><p>2.4 无法验证域名？</p><p>上面通过指定网站根目录的验证域名的方法有时会失效，也有朋友VPS上没有安装Web环境，无法使用80端口。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/15396999612225e64847789.gif"></p><p>这里acme.sh 提供了一个添加DNS API自动验证域名的方式，首先到你的域名DNS处获得API，这里我以NS1 DNS域名解析来作为演示，首先到官网后台获得API（<strong>其它的DNS，如DNSPOD、Cloudxns、阿里云DNS等使用API的方法见本文第四部分</strong>）。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/1539699961184b536dc483c.gif"></p><p>然后是导入NS1.com API</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export NS1_Key=&quot;fdmlfxxxxxxxfk&quot;</span><br></pre></td></tr></table></figure><p>现在就可以开始签发SSL证书了:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --issue --dns dns_nsone -d wzfou.com -d www.wzfou.com</span><br><span class="line">#或者签发ECC证书</span><br><span class="line">acme.sh --issue --dns dns_nsone -d wzfou.com -d www.wzfou.com --keylength ec-256</span><br></pre></td></tr></table></figure><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/1539699961531adf860a02c.gif"></p><p>使用DNS API验证域名的方式有一个好处就是不需要WEB访问就可以签发SSL证书，acme.sh 会在你的DNS域名解析处添加一个TXT记录，验证成功后会自动删除该TXT记录。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/1539699961534906ab4cb21.gif"></p><p><strong>三、第三步：安装letsencrypt SSL证书</strong></p><p>这一步部分其实可以根据各自的实际来执行了，为了让acme.sh 可以自动更新续期SSL证书，建议使用以下操作方法来执行，这样acme.sh 每次更新完了SSL证书后都自动按照你第一次安装SSL证书的方法执行一遍同步SSL证书的命令。</p><p><strong>Apache</strong> 服务器安装letsencrypt SSL证书如下：:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --install-cert -d wzfou.com \</span><br><span class="line">--cert-file /path/to/certfile/in/apache/cert.pem \</span><br><span class="line">--key-file /path/to/keyfile/in/apache/key.pem \</span><br><span class="line">--fullchain-file /path/to/fullchain/certfile/apache/fullchain.pem \</span><br><span class="line">--reloadcmd &quot;service apache2 force-reload&quot;</span><br></pre></td></tr></table></figure><p><strong>Nginx</strong> 服务器安装letsencrypt SSL证书e:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --install-cert -d wzfou.com \</span><br><span class="line">--key-file /path/to/keyfile/in/nginx/key.pem \</span><br><span class="line">--fullchain-file /path/to/fullchain/nginx/cert.pem \</span><br><span class="line">--reloadcmd &quot;service nginx force-reload&quot;</span><br></pre></td></tr></table></figure><p>实际操作中，大家根据需要调整好证书和密钥的路径，由于我使用的ECC证书，并且重启Apache2的命令无效，所以我用的以下命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --install-cert -d ping.wzfou.com --ecc \</span><br><span class="line">--cert-file /etc/pki/tls/certs/ping.wzfou.com.cer \</span><br><span class="line">--key-file /etc/pki/tls/certs/ping.wzfou.com.key \</span><br><span class="line">--fullchain-file /etc/pki/tls/certs/fullchain.cer \</span><br><span class="line">--reloadcmd &quot;/etc/init.d/httpd force-reload&quot;</span><br></pre></td></tr></table></figure><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/1539699961547719746a31b.gif"></p><p>执行命令后，我们就可以在路径中看到已经复制过来的证书还有Key等文件了，下次acme.sh 执行更新SSL证书时也会同样执行上述的命令。否则，需要自己手动复制粘贴证书。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/15396999616206e31fe7f6a.gif"></p><p>最后记得到Apache或者Nginx的配置中调整好证书和Key的路径，重启Apache或者Nginx就算完成了。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/1539699961579ab93c65bee.gif"></p><p>如果你发现letsencrypt SSL证书不能定时更新，你也可以自己手动强制更新:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --renew -d example.com --force</span><br></pre></td></tr></table></figure><p>如果是ECC cert，使用以下命令:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --renew -d example.com --force --ecc</span><br></pre></td></tr></table></figure><p>目前wzfou.com用的就是letsencrypt SSL证书。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/1539699961561d925775d3d.gif"></p><p><strong>四、附录：各大DNS API获取与签发SSL</strong></p><p><strong>说明</strong>：</p><ol><li>附录参考自：<a target="_blank" rel="noopener" href="https://github.com/Neilpang/acme.sh/blob/master/dnsapi/README.md">https://github.com/Neilpang/acme.sh/blob/master/dnsapi/README.md</a></li><li>DNS解析服务汇总：<a target="_blank" rel="noopener" href="https://wzfou.com/mianfei-dns/">https://wzfou.com/mianfei-dns/</a></li><li>签发泛域名SSL时请把命令部分：-d <a target="_blank" rel="noopener" href="http://www.example.com/">www.example.com</a> 改成 ：-d *.example.com</li></ol><p><strong>4.1 CloudFlare DNS API</strong></p><p>First you need to login to your CloudFlare account to get your API key.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export CF_Key=&quot;sdfsdfsdfljlbjkljlkjsdfoiwje&quot;</span><br><span class="line">export CF_Email=&quot;xxxx@sss.com&quot;</span><br></pre></td></tr></table></figure><p>Ok, let’s issue a cert now:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --issue --dns dns_cf -d example.com -d www.example.com</span><br></pre></td></tr></table></figure><p>The CF_Key and CF_Email will be saved in ~&#x2F;.acme.sh&#x2F;account.conf and will be reused when needed.</p><p><strong>4.2 DNSPod DNS API</strong></p><p>First you need to login to your DNSPod account to get your API Key and ID.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export DP_Id=&quot;1234&quot;</span><br><span class="line">export DP_Key=&quot;sADDsdasdgdsf&quot;</span><br></pre></td></tr></table></figure><p>Ok, let’s issue a cert now:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --issue --dns dns_dp -d example.com -d www.example.com</span><br></pre></td></tr></table></figure><p>The DP_Id and DP_Key will be saved in ~&#x2F;.acme.sh&#x2F;account.conf and will be reused when needed.</p><p><strong>4.3 CloudXNS DNS API</strong></p><p>First you need to login to your CloudXNS account to get your API Key and Secret.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export CX_Key=&quot;1234&quot;</span><br><span class="line">export CX_Secret=&quot;sADDsdasdgdsf&quot;</span><br></pre></td></tr></table></figure><p>Ok, let’s issue a cert now:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --issue --dns dns_cx -d example.com -d www.example.com</span><br></pre></td></tr></table></figure><p>The CX_Key and CX_Secret will be saved in ~&#x2F;.acme.sh&#x2F;account.conf and will be reused when needed.</p><p><strong>4.4 阿里云Aliyun DNS API</strong></p><p>First you need to login to your 阿里云 Aliyun account to get your API key. <a target="_blank" rel="noopener" href="https://ak-console.aliyun.com/#/accesskey">https://ak-console.aliyun.com/#/accesskey</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export Ali_Key=&quot;sdfsdfsdfljlbjkljlkjsdfoiwje&quot;</span><br><span class="line">export Ali_Secret=&quot;jlsdflanljkljlfdsaklkjflsa&quot;</span><br></pre></td></tr></table></figure><p>Ok, let’s issue a cert now:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --issue --dns dns_ali -d example.com -d www.example.com</span><br></pre></td></tr></table></figure><p>The Ali_Key and Ali_Secret will be saved in ~&#x2F;.acme.sh&#x2F;account.conf and will be reused when needed.</p><p><strong>4.5 GoDaddy DNS API</strong></p><p>First you need to login to your GoDaddy account to get your API Key and Secret. <a target="_blank" rel="noopener" href="https://developer.godaddy.com/keys/">https://developer.godaddy.com/keys/</a></p><p>Please create a Production key, instead of a Test key.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export GD_Key=&quot;sdfsdfsdfljlbjkljlkjsdfoiwje&quot;</span><br><span class="line">export GD_Secret=&quot;asdfsdafdsfdsfdsfdsfdsafd&quot;</span><br></pre></td></tr></table></figure><p>Ok, let’s issue a cert now:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --issue --dns dns_gd -d example.com -d www.example.com</span><br></pre></td></tr></table></figure><p>The GD_Key and GD_Secret will be saved in ~&#x2F;.acme.sh&#x2F;account.conf and will be reused when needed.</p><p><strong>4.6 PowerDNS DNS API</strong></p><p>First you need to login to your PowerDNS account to enable the API and set your API-Token in the configuration. <a target="_blank" rel="noopener" href="https://doc.powerdns.com/md/httpapi/README/">https://doc.powerdns.com/md/httpapi/README/</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export PDNS_Url=&quot;http://ns.example.com:8081&quot;</span><br><span class="line">export PDNS_ServerId=&quot;localhost&quot;</span><br><span class="line">export PDNS_Token=&quot;0123456789ABCDEF&quot;</span><br><span class="line">export PDNS_Ttl=60</span><br></pre></td></tr></table></figure><p>Ok, let’s issue a cert now:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --issue --dns dns_pdns -d example.com -d www.example.com</span><br></pre></td></tr></table></figure><p>The PDNS_Url, PDNS_ServerId, PDNS_Token and PDNS_Ttl will be saved in ~&#x2F;.acme.sh&#x2F;account.confand will be reused when needed.</p><p><strong>4.7 Amazon Route53 DNS API</strong></p><p>方法见：<a target="_blank" rel="noopener" href="https://github.com/Neilpang/acme.sh/wiki/How-to-use-Amazon-Route53-API">https://github.com/Neilpang/acme.sh/wiki/How-to-use-Amazon-Route53-API</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export AWS_ACCESS_KEY_ID=XXXXXXXXXX</span><br><span class="line">export AWS_SECRET_ACCESS_KEY=XXXXXXXXXXXXXXX</span><br></pre></td></tr></table></figure><p>To issue a cert:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --issue --dns dns_aws -d example.com -d www.example.com</span><br></pre></td></tr></table></figure><p>The AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY will be saved in ~&#x2F;.acme.sh&#x2F;account.conf and will be reused when needed.</p><p><strong>4.8 Linode DNS API</strong></p><p>First you need to login to your Linode account to get your API Key. <a target="_blank" rel="noopener" href="https://manager.linode.com/profile/api">https://manager.linode.com/profile/api</a></p><p>Then add an API key with label <em>ACME</em> and copy the new key.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export LINODE_API_KEY=&quot;...&quot;</span><br></pre></td></tr></table></figure><p>Due to the reload time of any changes in the DNS records, we have to use the dnssleep option to wait at least 15 minutes for the changes to take effect.</p><p>Ok, let’s issue a cert now:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --issue --dns dns_linode --dnssleep 900 -d example.com -d www.example.com</span><br></pre></td></tr></table></figure><p>The LINODE_API_KEY will be saved in ~&#x2F;.acme.sh&#x2F;account.conf and will be reused when needed.</p><p><strong>4.9 DigitalOcean DNS API (native)</strong></p><p>You need to obtain a read and write capable API key from your DigitalOcean account. See: <a target="_blank" rel="noopener" href="https://www.digitalocean.com/help/api/">https://www.digitalocean.com/help/api/</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export DO_API_KEY=&quot;75310dc4ca779ac39a19f6355db573b49ce92ae126553ebd61ac3a3ae34834cc&quot;</span><br></pre></td></tr></table></figure><p>Ok, let’s issue a cert now:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --issue --dns dns_dgon -d example.com -d www.example.com</span><br></pre></td></tr></table></figure><p><strong>4.10 Namesilo DNS API</strong></p><p>You’ll need to generate an API key at <a target="_blank" rel="noopener" href="https://www.namesilo.com/account/_api.php">https://www.namesilo.com/account\_api.php</a> Optionally you may restrict the access to an IP range there.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export Namesilo_Key=&quot;xxxxxxxxxxxxxxxxxxxxxxxx&quot;</span><br></pre></td></tr></table></figure><p>And now you can issue certs with:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --issue --dns dns_namesilo --dnssleep 900 -d example.com -d www.example.com</span><br></pre></td></tr></table></figure><p><strong>4.11 使用自定义API</strong></p><p>If your API is not supported yet, you can write your own DNS API.</p><p>Let’s assume you want to name it ‘myapi’:</p><ol><li>Create a bash script named ~&#x2F;.acme.sh&#x2F;dns_myapi.sh,</li><li>In the script you must have a function named dns_myapi_add() which will be called by acme.sh to add the DNS records.</li><li>Then you can use your API to issue cert like this:</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --issue --dns dns_myapi -d example.com -d www.example.com</span><br></pre></td></tr></table></figure><p><strong>五、总结</strong></p><p>letsencrypt免费SSL证书申请与安装过程还是挺简单的，只需要一个VPS主机，不管有没有安装Web环境都可以签发SSL证书，个人觉得DNS验证方式是最方便的。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/15396999618600251bd9718.jpg"></p><p>没有VPS主机的同学该如何使用letsencrypt免费SSL证书呢？<strong>方法一：</strong>手动在线申请，三个在线免费SSL证书申请地址; <strong>方法二：</strong>直接用Cpanel、DirectAdmin面板自带的SSL申请。</p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://jarod.vip/2018/10/19/%E4%BD%BF%E7%94%A8overture%E6%90%AD%E5%BB%BA%E6%94%AF%E6%8C%81edns%E7%9A%84%E7%A7%81%E4%BA%BAdns/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Jarod"><meta itemprop="description" content="记录生活中的点点滴滴"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jarod's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2018/10/19/%E4%BD%BF%E7%94%A8overture%E6%90%AD%E5%BB%BA%E6%94%AF%E6%8C%81edns%E7%9A%84%E7%A7%81%E4%BA%BAdns/" class="post-title-link" itemprop="url">使用Overture搭建支持EDNS的私人DNS</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-10-19 01:45:34" itemprop="dateCreated datePublished" datetime="2018-10-19T01:45:34+08:00">2018-10-19</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-09-29 21:27:45" itemprop="dateModified" datetime="2022-09-29T21:27:45+08:00">2022-09-29</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Linux教程</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>1.6k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>1 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h4 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h4><p>先匹配域名，再匹配解析出的ip来决定走primary DNS还是alternative DNS来解析，域名列表(domain_sample)命中，走alternative DNS, 否则走primary DNS，如果解析出的ip不在ip段(ip_network_sample)里，则再去走alternative DNS解析，这样可通过自己组合来完成逻辑上的解析流程。</p><h4 id="安装配置（Centos7-4）"><a href="#安装配置（Centos7-4）" class="headerlink" title="安装配置（Centos7.4）"></a>安装配置（Centos7.4）</h4><h5 id="创建文件夹并进入"><a href="#创建文件夹并进入" class="headerlink" title="创建文件夹并进入"></a>创建文件夹并进入</h5><blockquote><p>cd &#x2F; &amp;&amp; mkdir overture &amp;&amp; cd overture</p></blockquote><h5 id="下载Overture"><a href="#下载Overture" class="headerlink" title="下载Overture"></a>下载Overture</h5><blockquote><p>wget <a target="_blank" rel="noopener" href="https://github.com/shawn1m/overture/releases/download/1.3.6rc2/overture-linux-amd64.zip">https://github.com/shawn1m/overture/releases/download/1.3.6rc2/overture-linux-amd64.zip</a></p></blockquote><h5 id="解压文件"><a href="#解压文件" class="headerlink" title="解压文件"></a>解压文件</h5><blockquote><p>unzip overture-linux-amd64.zip</p></blockquote><h5 id="备份初始文件"><a href="#备份初始文件" class="headerlink" title="备份初始文件"></a>备份初始文件</h5><blockquote><p>cp ip_network_sample ip_network_sample.bak</p></blockquote><h5 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h5><blockquote><p>echo “0.0.0.0&#x2F;0” &gt; ip_network_sample vim config.json</p></blockquote><h5 id="配置文件介绍"><a href="#配置文件介绍" class="headerlink" title="配置文件介绍"></a>配置文件介绍</h5><blockquote><p>BindAddress：监听的ip地址和端口号，默认同时监听TCP和UDP端口 PrimaryDNS：主DNS Name：DNS标志 Address：DNS的IP和端口号 Protocol：使用的协议 SOCKS5Address：转发DNS请求到Socket5代理 Timeout：代理到后端的超时时间 EDNSClientSubnet：智能DNS解析，建议设置为auto，根据客户端的IP地址做判断而不是客户端指定的DNS的IP地址 MinimumTTL：Overture缓存解析记录的时长 CacheSize：Overture缓存大小</p></blockquote><h5 id="域名配置"><a href="#域名配置" class="headerlink" title="域名配置"></a>域名配置</h5><blockquote><p>“DomainFile”: “.&#x2F;domain_sample” #这个文件里可放需走alternative DNS的域名, 如google.com, 支持后缀命中 “DomainBase64Decode”: false #这个要false关闭域名列表的64解码，才能用明文来表达域名</p></blockquote><h5 id="IP列表配置"><a href="#IP列表配置" class="headerlink" title="IP列表配置"></a>IP列表配置</h5><blockquote><p>“IPNetworkFile”: “.&#x2F;ip_network_sample” #直接用0.0.0.0&#x2F;0, 如有特别的逻辑可改</p></blockquote><h5 id="启动Overture"><a href="#启动Overture" class="headerlink" title="启动Overture"></a>启动Overture</h5><blockquote><p>.&#x2F;overture-linux-amd64 -c：指定配置文件路径；默认当前启动路径的下的config.json文件 -l：指定日志路径和日志文件；默认当前启动路径下的overture.log -p：指定进程数；默认当前CPU的核心数 -v：Debug日志模式</p></blockquote><p> </p><h3 id="真麻烦为什么不能自启动？？？这简直糟糕透了！！！"><a href="#真麻烦为什么不能自启动？？？这简直糟糕透了！！！" class="headerlink" title="真麻烦为什么不能自启动？？？这简直糟糕透了！！！"></a>真麻烦为什么不能自启动？？？这简直糟糕透了！！！</h3><p> </p><h5 id="设置Overture自启动"><a href="#设置Overture自启动" class="headerlink" title="设置Overture自启动"></a>设置Overture自启动</h5><blockquote><p>chmod +x &#x2F;etc&#x2F;rc.d&#x2F;rc.local vi &#x2F;etc&#x2F;rc.local 并写入 sh &#x2F;dns.sh vi &#x2F;dns.sh cd &#x2F;overture nohup &#x2F;overture&#x2F;overture-linux-amd64 -c &#x2F;overture&#x2F;config.json -l &#x2F;overture&#x2F;overture.log &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1 &amp; chmod 777 &#x2F;dns.sh</p></blockquote><h5 id="大功告成"><a href="#大功告成" class="headerlink" title="大功告成~~~"></a>大功告成~~~</h5><p>但是，但是！！！重点在这里！！！ 自己搭建Overture耗时耗钱，不想折腾可以直接使用Hi!XNS，已经稳定运行3年，非常可靠乐观！当然不是单纯的Overture那么简单，通过二次开发达到更高水准！非常纯净哦~~ 传送门：<a target="_blank" rel="noopener" href="https://hixns.com/">https://hixns.com/</a></p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://jarod.vip/2018/10/19/ssl%E4%BC%98%E5%8C%96/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Jarod"><meta itemprop="description" content="记录生活中的点点滴滴"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jarod's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2018/10/19/ssl%E4%BC%98%E5%8C%96/" class="post-title-link" itemprop="url">SSL优化</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-10-19 01:44:22" itemprop="dateCreated datePublished" datetime="2018-10-19T01:44:22+08:00">2018-10-19</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-09-29 21:27:45" itemprop="dateModified" datetime="2022-09-29T21:27:45+08:00">2022-09-29</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Linux教程</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>2k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>2 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h5 id="一、关闭TLSv1-0提高安全性"><a href="#一、关闭TLSv1-0提高安全性" class="headerlink" title="一、关闭TLSv1.0提高安全性"></a>一、关闭TLSv1.0提高安全性</h5><p>大多数是比较老旧系统上自带浏览器不支持，如果是主流用户使用的Chrome、Firefox和国产浏览器基本都兼容。</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3;</span><br></pre></td></tr></table></figure></blockquote><h5 id="二、开启HTTP-Strict-Transport-Security-HSTS"><a href="#二、开启HTTP-Strict-Transport-Security-HSTS" class="headerlink" title="二、开启HTTP Strict Transport Security (HSTS)"></a>二、开启HTTP Strict Transport Security (HSTS)</h5><p>指示浏览器只使用 HTTPS 连接到目标服务器。这可以防止一些潜在的中间人攻击，包括 SSL 剥离，会话 cookie 窃取（如果没有被 适当保护）。如果遇到任何与证书相关的错误，它还可以阻止浏览器连接到网站。当浏览器访问一个设置相应 HTTP header 的 HTTPS 网站时，HSTS 将被激活。 HSTS 有一个固定期限，由 max-age 字段值控制。这个值可以是静态的，也可以是相对于将来某个特定日期的，你可以设置成 SSL 证书的过期时间。 在浏览器中，HSTS 首选项可以通过提交到 Chromium’s HSTS preload list 来硬编码，这是所有实现 HSTS 使用的浏览器。 注意，HSTS 确实有陷阱。它提供了 include subdomains 选项，这在实践中可能是太宽泛了。此外，客户端错误可能会造成严重的后果——客户端错误的时钟导致它认为服务器的 SSL 证书无效或过期，或者缺少根 CA 证书——将不再导致浏览器中的证书错误。浏览器将完全拒绝访问页面，并且可能会显示让安全专家之外的完全无法理解的错误。</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Strict-Transport-Security: max-age=31536000</span><br></pre></td></tr></table></figure></blockquote><h6 id="二·1、同时还允许预加载"><a href="#二·1、同时还允许预加载" class="headerlink" title="二·1、同时还允许预加载"></a>二·1、同时还允许预加载</h6><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Strict-Transport-Security: max-age=31536000; includeSubDomains; preload</span><br></pre></td></tr></table></figure></blockquote><h5 id="三、部署-CSP"><a href="#三、部署-CSP" class="headerlink" title="三、部署 CSP"></a>三、部署 CSP</h5><p>内容安全策略（CSP）是网站可以用来限制浏览器操作的安全机制。尽管最初旨在解决跨站点脚本（XSS），CSP 不断发展，并支持对增强TLS安全性有用的功能。特别地，它可以用于限制混合内容，当涉及到第三方网站，HSTS没有帮助。</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: default-src https: &#x27;unsafe-inline&#x27; &#x27;unsafe-eval&#x27;; </span><br><span class="line">connect-src https: wss:</span><br></pre></td></tr></table></figure><p> </p></blockquote><h5 id="四、Web-Framework-Information"><a href="#四、Web-Framework-Information" class="headerlink" title="四、Web Framework Information"></a>四、Web Framework Information</h5><p>许多 web 框架设置 HTTP 头，识别框架或版本号。除了满足用户的好奇心，而且主要作为技术堆栈的广告，这几乎没有什么作用。这些头是不标准的，对浏览器渲染站点的方式没有影响。 从服务器响应中删除这些标头: X-Powered-By, X-Runtime, X-Version 和 X-AspNet-Version。 标记所有 cookie 安全和 HttpOnly。</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: Key=Value; path=/; secure; HttpOnly, Key2=Value2; secure; HttpOnly</span><br></pre></td></tr></table></figure></blockquote><h5 id="五、加密优化"><a href="#五、加密优化" class="headerlink" title="五、加密优化"></a>五、加密优化</h5><p>如果您的服务器需要支持IE6这种古董级别的浏览器，那么就按照百度的做法，如果说对兼容性没有太大的需求，只要主流的浏览器能够访问那么就不要支持3DES系列的加密套件，如果说想要在保证安全性的同时，也要有最好的兼容性，那么就请按照淘宝的配置方式进行配置。</p><h6 id="五·1、类似百度"><a href="#五·1、类似百度" class="headerlink" title="五·1、类似百度"></a>五·1、类似百度</h6><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH; </span><br><span class="line">ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2;</span><br></pre></td></tr></table></figure></blockquote><h6 id="五·2、类似淘宝"><a href="#五·2、类似淘宝" class="headerlink" title="五·2、类似淘宝"></a>五·2、类似淘宝</h6><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssl_ciphers EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5; </span><br><span class="line">ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br></pre></td></tr></table></figure></blockquote><h6 id="五·3、正常"><a href="#五·3、正常" class="headerlink" title="五·3、正常"></a>五·3、正常</h6><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssl_ciphers EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256::!MD5; </span><br><span class="line">ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br></pre></td></tr></table></figure></blockquote><h6 id="五·3、更安全"><a href="#五·3、更安全" class="headerlink" title="五·3、更安全"></a>五·3、更安全</h6><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssl_ciphers EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256::!MD5; </span><br><span class="line">ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3;</span><br></pre></td></tr></table></figure></blockquote><p>注：转载并合理整理及修改，原著作网站：<a target="_blank" rel="noopener" href="https://blog.myssl.com/">https://blog.myssl.com/</a></p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://jarod.vip/2018/10/18/%E6%90%AD%E5%BB%BA%E9%AB%98%E5%A4%A7%E4%B8%8A%E7%9A%84zimbra%E5%8A%9E%E5%85%AC%E4%B8%8E%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E7%B3%BB%E7%BB%9F/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Jarod"><meta itemprop="description" content="记录生活中的点点滴滴"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jarod's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2018/10/18/%E6%90%AD%E5%BB%BA%E9%AB%98%E5%A4%A7%E4%B8%8A%E7%9A%84zimbra%E5%8A%9E%E5%85%AC%E4%B8%8E%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E7%B3%BB%E7%BB%9F/" class="post-title-link" itemprop="url">搭建高大上的Zimbra办公与邮件服务系统</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-10-18 11:59:08" itemprop="dateCreated datePublished" datetime="2018-10-18T11:59:08+08:00">2018-10-18</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-09-29 21:27:45" itemprop="dateModified" datetime="2022-09-29T21:27:45+08:00">2022-09-29</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Linux教程</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>14k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>13 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><p>Table of Contents</p><ul><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#Ubuntu_1604" title="一、Ubuntu 16.04搭建方法">一、Ubuntu 16.04搭建方法</a><ul><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#1" title="1.系统软硬件要求">1.系统软硬件要求</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#2DNS" title="2.配置DNS">2.配置DNS</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#3" title="3.系统环境的设置">3.系统环境的设置</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#4" title="4.下载并安装软件包">4.下载并安装软件包</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#5" title="5.选择安装组件">5.选择安装组件</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#6_Zimbra" title="6, 配置Zimbra">6, 配置Zimbra</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#7SSL" title="7.配置SSL">7.配置SSL</a></li></ul></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#CentOS_7" title="二、CentOS 7的搭建方法">二、CentOS 7的搭建方法</a><ul><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#i" title="安装要求">安装要求</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#i-2" title="开始">开始</a><ul><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#i-3" title="域名解析">域名解析</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#DNS" title="反向DNS解析">反向DNS解析</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#sendmailpostfix25" title="关闭sendmail或postfix服务，避免25端口被占用">关闭sendmail或postfix服务，避免25端口被占用</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#selinux" title="关闭selinux">关闭selinux</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#i-4" title="防火墙">防火墙</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#HOSTNAME" title="配置主机名HOSTNAME">配置主机名HOSTNAME</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#HOSTS" title="配置HOSTS">配置HOSTS</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#NTP" title="NTP">NTP</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#_wiki" title="安装依赖包 wiki">安装依赖包 wiki</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#i-5" title="安装及使用">安装及使用</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#SPF" title="SPF">SPF</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#DKIM" title="DKIM">DKIM</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#DMARC" title="DMARC">DMARC</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#i-6" title="域名解析记录">域名解析记录</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#DKIM-2" title="验证DKIM">验证DKIM</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#i-7" title="重新签发证书">重新签发证书</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#i-8" title="可以学习的内容">可以学习的内容</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#i-9" title="小工具">小工具</a></li><li><a target="_blank" rel="noopener" href="https://www.zrj96.com/post-884.html#i-10" title="参考文章">参考文章</a></li></ul></li></ul></li></ul><h1 id="一、Ubuntu-16-04搭建方法"><a href="#一、Ubuntu-16-04搭建方法" class="headerlink" title="一、Ubuntu 16.04搭建方法"></a>一、Ubuntu 16.04搭建方法</h1><p>Zimbra是著名的开源系统，它一体化地提供了邮件收发、文件共享、协同办公、即时聊天等一系列解决方案，是开源软件中的精品。它拥有美观大气的使用界面，以及非常实用的功能。作为邮件服务器系统，Zimbra更是凭借卓越的稳定性和功能当之无愧地成为开源邮件服务器系统的首选，适合各类型&#x2F;人数的用户群，尤其适合团队使用。之前我们写过一个简单的Zimbra邮件服务器安装的教程，然而那篇文章写于五年前，对于现在的版本已经不再适用。正好由于前天，Online.net服务器大幅提价，我们不得不迁移之前的服务器，于是需要在新的系统上重新搭建一次Zimbra. 因此，我们这里凭借这个机会再介绍一下如何安装与配置独立的Zimbra开源办公与邮件服务系统，希望对大家有所帮助。多台服务器协同部署的步骤这里不做太多介绍。</p><h2 id="1-系统软硬件要求"><a href="#1-系统软硬件要求" class="headerlink" title="1.系统软硬件要求"></a>1.系统软硬件要求</h2><p>Zimbra的体量较大，因此对于系统环境的要求较高。首先，系统必须为64位。目前，Zimbra支持的操作系统包括：CentOS 6, CentOS 7, Ubuntu 14.04 LTS, Ubuntu 16.04 LTS, Red Hat Linux 6&#x2F;7, 以及Oracle Linux 6&#x2F;7.</p><p>关于硬件需求，首先，内存需要8 GB或者以上，建议16 GB. 系统的硬盘占用约为8 GB左右，视自己的需要而定。CPU和其他硬件没有特别需求，但是Zimbra官方说明中有提到，<strong>强烈不建议在RAID 5 (包括50)的服务器上搭建Zimbra</strong>. 如果您有类似的服务器，建议更改RAID模式，避免RAID 5或者50.</p><p>鉴于Zimbra的体量，我们不建议在VPS上安装Zimbra, 而最好是在一台独立服务器上安装。本文的操作环境为Ubuntu 16.04 LTS 64bit.</p><h2 id="2-配置DNS"><a href="#2-配置DNS" class="headerlink" title="2.配置DNS"></a>2.配置DNS</h2><p>我们简要说明一下一个最简单的zimbra邮件服务器的DNS配置需求。</p><p>如果以qing.su域名为例，我们将域名本身qing.su以A记录解析到任意IP, 然后将邮件服务器的hostname, 比如mx.qing.su以A记录解析到我们将要搭建的邮件服务器的IP上。</p><p>然后，我们分别将qing.su与mx.qing.su以MX记录解析到mx.qing.su, 优先级可以为任意值。</p><p>如果需要用web访问邮箱，可以将mail.qing.su解析到邮件服务器的IP上。</p><p>其他记录的设置，比如TXT, SRV等，可以后期根据自己的需要来自行配制。</p><h2 id="3-系统环境的设置"><a href="#3-系统环境的设置" class="headerlink" title="3.系统环境的设置"></a>3.系统环境的设置</h2><p>毫无疑问，对于任何邮件服务器来说，最重要的前提步骤是正确设置服务器的hostname. 如何正确设置服务器的hostname我们已经强调过多次。我们以mx.example.com为例，当在SSH中执行hostname命令时，应当看到的回显为短主机名，即mx; 而在SSH中执行hostname -f命令时，应当看到的回显为长主机名(FQDN), 即mx.example.com. 若hostname没有正确设置好，请不要继续。</p><p>然后，我们用root账户登录SSH, 即可开始安装。(不要sudo, 请直接su到root, 否则会出错)</p><h2 id="4-下载并安装软件包"><a href="#4-下载并安装软件包" class="headerlink" title="4.下载并安装软件包"></a>4.下载并安装软件包</h2><p>Zimbra各系统软件包的下载地址如下：<a target="_blank" rel="noopener" href="https://www.zimbra.com/downloads/zimbra-collaboration-open-source/">https://www.zimbra.com/downloads/zimbra-collaboration-open-source/</a></p><p>请按照自己的需求下载。我们这里以Ubuntu 16.04为例。执行：</p><p><code>apt-get update &amp;&amp; apt-get upgrade cd /tmp wget https://files.zimbra.com/downloads/8.8.9_GA/zcs-8.8.9_GA_2055.UBUNTU16_64.20180703080917.tgz tar xvzf *.tgz rm -f zcs*.tgz cd zcs* ./install.sh</code></p><h2 id="5-选择安装组件"><a href="#5-选择安装组件" class="headerlink" title="5.选择安装组件"></a>5.选择安装组件</h2><p>正确执行上述步骤后，首先会提示是否同意用户协议，选择Y即可。</p><p><code>Do you agree with the terms of the https://qing.su software license agreement? [N] Y</code></p><p>然后会提示选择需要安装的组件，如果您不是特别了解的话可以直接选择默认选项。</p><p><code>Use Zimbra&#39;s package repository [Y] Install zimbra-ldap [Y] Install zimbra-logger [Y] Install zimbra-mta [Y] Install zimbra-dnscache [Y] Install zimbra-snmp [Y] Install zimbra-store [Y] Install zimbra-apache [Y] Install https://qing.su[Y] Install zimbra-spell [Y] Install zimbra-memcached [Y] Install zimbra-proxy [Y] Install zimbra-drive [Y] Install zimbra-imapd (BETA - for evaluation only) [N] Install zimbra-chat [Y]</code></p><p>最后，系统会提示是否确认更改，我们需要选择Y。</p><p><code>The system will be modified.  Continue? [N] Y</code></p><p>至此，系统将会下载必要的安装包并自动安装。</p><h2 id="6-配置Zimbra"><a href="#6-配置Zimbra" class="headerlink" title="6, 配置Zimbra"></a>6, 配置Zimbra</h2><p>安装完毕后，系统会弹出命令行菜单，如下面这样：</p><p><code>Main menu 1) Common Configuration: 2) zimbra-ldap: Enabled 3) zimbra-logger: Enabled 4) zimbra-mta: Enabled 5) zimbra-dnscache: Enabled 6) zimbra-snmp: Enabled 7) zimbra-store: Enabled +Create Admin User: yes +Admin user to create: admin@mx.example.com ******* +Admin Password UNSET +Anti-virus quarantine user: virus-quarantine.6zk4_0qy@mx.example.com +Enable automated spam training: yes +Spam training user: spam.zc3z28w0@mx.example.com +Non-spam(Ham) training user: ham.bkojeqoiq@mx.example.com +SMTP host: mx.example.com +Web server HTTP port: 8080 +Web server HTTPS port: 8443 +Web server mode: https +IMAP server port: 7143 +IMAP server SSL port: 7993 +POP server port: 7110 +POP server SSL port: 7995 +Use spell check server: yes +Spell server URL: http://mx.example.com:7780/aspell.php +Enable version update checks: TRUE +Enable version update notifications: TRUE +Version update notification email: admin@mx.example.com +Version update source email: admin@mx.example.com +Install mailstore (service webapp): yes +Install UI (zimbra,zimbraAdmin webapps): yes 8) zimbra-spell: Enabled 9) zimbra-proxy: Enabled 10) Default Class of Service Configuration: s) Save config to file x) Expand menu q) Quit Address unconfigured (**) items (? - help) 7</code></p><p>这里我们选择7,  进入Store configuration, 并在下一步选择4, 设置管理员密码。</p><p><code>Store configuration 1) Status:                                  Enabled 2) Create Admin User:                       yes 3) Admin user to create:                    admin@mx.example.com ** 4) Admin Password                           UNSET 5) Anti-virus quarantine user:              virus-quarantine.6zk4_0qy@mx.example.com 6) Enable automated spam training:          yes 7) Spam training user:                      spam.zc3z28w0@mx.example.com 8) Non-spam(Ham) training user:             ham.bkojeqoiq@mx.example.com 9) SMTP host:                               mx.example.com 10) Web server HTTP port:                    8080 11) Web server HTTPS port:                   8443 12) Web server mode:                         https 13) IMAP server port:                        7143 14) IMAP server SSL port:                    7993 15) POP server port:                         7110 16) POP server SSL port:                     7995 17) Use spell check server:                  yes 18) Spell server URL:                        http://mx.example.com:7780/aspell.php 19) Enable version update checks:            TRUE 20) Enable version update notifications:     TRUE 21) Version update notification email:       admin@mx.example.com 22) Version update source email:             admin@mx.example.com 23) Install mailstore (service webapp):      yes 24) Install UI (zimbra,zimbraAdmin webapps): yes Select, or &#39;r&#39; for previous menu [r]</code></p><p>如果有其他选项您希望更改的，也可以一并更改（但是不建议更改端口地址）。更改完毕后，输入r返回上级菜单，然后输入a让更改生效并将配置写入至文件。</p><p><code>*** CONFIGURATION COMPLETE - press &#39;a&#39; to apply Select from menu, or press &#39;a&#39; to apply config (? - help) a Save configuration data to a file? [Yes] Save config in file: [/opt/zimbra/config.11819] Saving config in /opt/zimbra/config.11819...done. The system will be modified - continue? [No] Yes</code></p><p>要忘记最后要输入Yes来保存更改。几秒钟之后，系统就配置完毕。至此，Zimbra安装完毕，我们可以登录后台添加域名、添加用户等进行一系列的管理了。</p><h2 id="7-配置SSL"><a href="#7-配置SSL" class="headerlink" title="7.配置SSL"></a>7.配置SSL</h2><p>安装完毕Zimbra以后，我们就可以通过<a href="https://mx.example.com:7071登录后台，进行管理。此时，SSL证书还没有配置好，我们需要配置SSL">https://mx.example.com:7071登录后台，进行管理。此时，SSL证书还没有配置好，我们需要配置SSL</a>, 否则浏览器会一直报错。点击界面下方Get Started –&gt; Install Certificates, 选择Next然后选择Generate the CSR for the commercial certificate authorizer, 然后在弹出来的界面中生成CSR. 我们需要将主域名mx.example.com填在Common Name中，然后在Subjective Alternative Name中添加需要一并生成证书的其他域名，比如example.com, <a target="_blank" rel="noopener" href="http://www.example.com/">www.example.com</a>, mail.example.com等。点击Next即可生成证书CSR.</p><p>有了CSR之后，我们即可申请证书了。Zimbra配置证书的过程比较tricky, 经常会报错，特别是如果在网页后台安装证书时报错的原因很不清晰，导致无法分析错误发生的原因。因此，我们一般选择在SSH中使用命令行的方式安装证书。下面我们以Let’s Encrypt为例安装证书，其他的商业证书的安装较为简单，这里就不再重复。</p><p>我们用SSH登录服务器，然后su切换至root. 首先，我们将刚才的CSR保存至&#x2F;tmp&#x2F;mx.example.com.csr文件。然后，安装certbot, 签发Let’s Encrypt证书。</p><p><code>apt-get install software-properties-common add-apt-repository ppa:certbot/certbot apt-get update apt-get install certbot</code></p><p>这里有一个小技巧，通常我们签发Let’s Encrypt证书的时候是让它自己生成私钥和CSR的，但是在需要的时候，certbot可以根据已有的CSR来签发证书，只需使用–csr参数即可。因此，我们基于刚刚生成的CSR来签发证书。</p><p><code>certbot certonly --standalone --csr /tmp/mx.example.com.csr</code></p><p>签发的证书和链文件位于&#x2F;tmp目录内。需要注意的是，Certbot生成的中间链会在Zimbra中校验失败，我们需要下载额外的Root CA和中间链证书。</p><p><code>wget https://letsencrypt.org/certs/isrgrootx1.pem.txt -O ca.crt wget https://letsencrypt.org/certs/letsencryptauthorityx3.pem.txt -O ca_intermediary.crt</code></p><p>然后再整理、合并一下证书：</p><p><code>mv 0000_cert.pem commercial.crt cat /tmp/ca_intermediary.crt /tmp/ca.crt &gt; /tmp/ca_chain.crt</code></p><p>现在就可以开始签发安装证书了。安装证书需要使用zimbra用户，这是在安装Zimbra的时候新建的内置用户。</p><p><code>su zimbra</code></p><p>安装之前，我们先验证一下证书。执行</p><p><code>/opt/zimbra/bin/zmcertmgr verifycrt comm /opt/zimbra/ssl/zimbra/commercial/commercial.key /tmp/commercial.crt /tmp/ca_chain.crt</code></p><p>如果看到类似于下面的回显，说明合格了。如果报错，大概率是因为Root CA和中间链哪里没有弄对，请仔细检查后再试。</p><p><code>** Verifying &#39;/tmp/commercial.crt&#39; against &#39;/opt/zimbra/ssl/zimbra/commercial/commercial.key&#39; **Tutorial written by https://qing.su** Certificate &#39;/tmp/commercial.crt&#39; and private key &#39;/opt/zimbra/ssl/zimbra/commercial/commercial.key&#39; match. ** Verifying &#39;/tmp/commercial.crt&#39; against &#39;/tmp/ca_chain.crt&#39; Valid certificate chain: /tmp/commercial.crt: OK</code></p><p>证书验证完毕后，执行下面的命令安装并检验：</p><p><code>/opt/zimbra/bin/zmcertmgr deploycrt comm /tmp/commercial.crt /tmp/ca_chain.crt /opt/zimbra/bin/zmcertmgr viewdeployedcrt</code></p><p>最后，我们要重启zimbra服务器，让证书生效。</p><p><code>exit service zimbra restart</code></p><p>再次登录<a target="_blank" rel="noopener" href="https://mx.example.com:7071/">https://mx.example.com:7071</a>, 已经可以看到证书生效了。</p><p>至此，Zimbra服务器安装完毕并成功配置了SSL证书。在添加好相应的域名之后，即可使用相关用户名和密码登录<a target="_blank" rel="noopener" href="https://mail.example.com来登录邮箱,界面非常美观大气.可以看到,在邮箱右下角还有聊天窗口,可以和同一个工作组内的伙伴实时通讯并传输文件./">https://mail.example.com来登录邮箱，界面非常美观大气。可以看到，在邮箱右下角还有聊天窗口，可以和同一个工作组内的伙伴实时通讯并传输文件。</a></p><h1 id="二、CentOS-7的搭建方法"><a href="#二、CentOS-7的搭建方法" class="headerlink" title="二、CentOS 7的搭建方法"></a>二、CentOS 7的搭建方法</h1><h2 id="安装要求"><a href="#安装要求" class="headerlink" title="安装要求"></a>安装要求</h2><p>1、64位服务器并能设置反向DNS解析（zimbra新版不支持32位操作系统）</p><p>2、磁盘空间≥5GB（zimbra默认安装位置&#x2F;opt 请确保磁盘空间足够 可以挂载到新磁盘）</p><p>3、内存≥4GB（编译对内存要求较高，内存小的用户可以设置swap来缓解内存压力）</p><p>4、域名一枚</p><h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><h3 id="域名解析"><a href="#域名解析" class="headerlink" title="域名解析"></a>域名解析</h3><p>zimbra在线安装时要检查MX 安装之前配置好dns MX解析并确认已生效 未生效安装过程会终止</p><p>假如&gt;&gt;</p><p>邮件服务器IP：138.68.227.28</p><p>邮件服务器采用的域名：mail.example.com</p><p>对外发送和接收邮件的域名：example.com</p><p>mail.example.com. IN A 138.68.227.28</p><p>example.com. IN MX 10 mail.example.com.</p><h3 id="反向DNS解析"><a href="#反向DNS解析" class="headerlink" title="反向DNS解析"></a>反向DNS解析</h3><p>反向解析由主机商提供（有些面板可以设置，不行提交工单）</p><p>主要用于发件，确认邮件来源的有效性。</p><p>命令查看反向解析是否生效：<code>nslookup -qt=ptr 138.68.227.28</code> 返回指向mail.example.com则成功</p><h3 id="关闭sendmail或postfix服务，避免25端口被占用"><a href="#关闭sendmail或postfix服务，避免25端口被占用" class="headerlink" title="关闭sendmail或postfix服务，避免25端口被占用"></a>关闭sendmail或postfix服务，避免25端口被占用</h3><p># centos 6</p><p>&#x2F;etc&#x2F;init.d&#x2F;sendmail stop &amp;&amp; chkconfig sendmail off</p><p>&#x2F;etc&#x2F;init.d&#x2F;postfix stop &amp;&amp; chkconfig postfix off</p><p># centos 7</p><p>systemctl stop postfix &amp;&amp; yum erase postfix</p><p>systemctl stop sendmail &amp;&amp; systemctl disable sendmail</p><h3 id="关闭selinux"><a href="#关闭selinux" class="headerlink" title="关闭selinux"></a><a target="_blank" rel="noopener" href="https://www.zephyr.vip/204">关闭selinux</a></h3><h3 id="防火墙"><a href="#防火墙" class="headerlink" title="防火墙"></a><strong>防火墙</strong></h3><p>根据自已需求选择要不要关闭，也可以选用设置防火墙规则</p><p><strong>关闭防火墙功能</strong></p><p># centos 6</p><p>service iptables stop &amp;&amp; chkconfig iptables off</p><p># centos 7</p><p>systemctl stop firewalld.service &amp;&amp; systemctl disable firewalld.service</p><p><strong>添加防火墙规则 开放端口</strong></p><p>–A INPUT –m state —state NEW –m tcp –p tcp —dport 80 –j ACCEPT</p><p>–A INPUT –m state —state NEW –m tcp –p tcp —dport 443 –j ACCEPT</p><p>–A INPUT –m state —state NEW –m tcp –p tcp —dport 7071 –j ACCEPT</p><p>–A INPUT –m state —state NEW –m tcp –p tcp —dport 8087 –j ACCEPT</p><p>–A INPUT –m state —state NEW –m tcp –p tcp —dport 8080 –j ACCEPT</p><p>–A INPUT –m state —state NEW –m tcp –p tcp —dport 8443 –j ACCEPT</p><p>–A INPUT –m state —state NEW –m tcp –p tcp —dport 25 –j ACCEPT</p><p>–A INPUT –m state —state NEW –m tcp –p tcp —dport 110 –j ACCEPT</p><p>–A INPUT –m state —state NEW –m tcp –p tcp —dport 143 –j ACCEPT</p><p>–A INPUT –m state —state NEW –m tcp –p tcp —dport 993 –j ACCEPT</p><p>–A INPUT –m state —state NEW –m tcp –p tcp —dport 995 –j ACCEPT</p><p># iptables -F</p><p># iptables -P INPUT DROP</p><p># iptables -P OUTPUT ACCEPT</p><p># iptables -A INPUT -i lo -j ACCEPT</p><p># iptables -A INPUT -s IP-Address-of-your-server&#x2F;32 -j ACCEPT</p><p># iptables -A INPUT -m state –state ESTABLISHED,RELATED -j ACCEPT</p><p># iptables -A INPUT -p tcp –dport 22 -j ACCEPT</p><p># iptables -A INPUT -p icmp -j ACCEPT</p><p>## Zimbra rules for external access ##</p><p># iptables -A INPUT -p tcp –dport 25  -j ACCEPT</p><p># iptables -A INPUT -p tcp –dport 80  -j ACCEPT</p><p># iptables -A INPUT -p tcp –dport 110  -j ACCEPT</p><p># iptables -A INPUT -p tcp –dport 143 -j ACCEPT</p><p># iptables -A INPUT -p tcp –dport 443  -j ACCEPT</p><p># iptables -A INPUT -p tcp –dport 465  -j ACCEPT</p><p># iptables -A INPUT -p tcp –dport 587  -j ACCEPT</p><p># iptables -A INPUT -p tcp –dport 993  -j ACCEPT</p><p># iptables -A INPUT -p tcp –dport 995  -j ACCEPT</p><p># iptables -A INPUT -p tcp –dport 3443  -j ACCEPT</p><p># iptables -A INPUT -p tcp –dport 9071  -j ACCEPT</p><p># iptables -A INPUT -p tcp –dport 7071  -j ACCEPT</p><h3 id="配置主机名HOSTNAME"><a href="#配置主机名HOSTNAME" class="headerlink" title="配置主机名HOSTNAME"></a>配置主机名HOSTNAME</h3><p><strong>修改配置文件</strong></p><p><code>vi /etc/sysconfig/network</code> 内容 <code>HOSTNAME=mail.example.com</code></p><p>或 <strong>命令设置</strong></p><p>hostnamectl set–hostname mail.example.com</p><p>hostnamectl status</p><p>hostname</p><h3 id="配置HOSTS"><a href="#配置HOSTS" class="headerlink" title="配置HOSTS"></a>配置HOSTS</h3><p>安装时会检查hosts文件内容要否符合要求：<ip><fqhn> <hn></hn></fqhn></ip></p><p>核查hosts文件中的FQHN是否与与hostname一致，不一致安装中止</p><p>不设置<ip><fqhn><hn>返回的错误信息：</hn></fqhn></ip></p><p>ERROR: Installation can not proceeed. Please fix your &#x2F;etc&#x2F;hosts file</p><p>to contain:</p><p>&lt;ip&gt; &lt;FQHN&gt; &lt;HN&gt;</p><p>Where &lt;IP&gt; is the ip address of the host,</p><p>&lt;FQHN&gt; is the FULLY QUALIFIED host name, and</p><p>&lt;HN&gt; is the (optional) hostname–only portion</p><p>错误信息2 出错原因也说的很详细了 注释掉有12.0.0.1的行 DO服务器注释掉<code>#centos-512mb-ams2-01 centos-512mb-ams2-01的行</code></p><p>ERROR: Installation can not proceeed. Please fix your &#x2F;etc&#x2F;hosts file</p><p>to contain:</p><p>127.0.0.1 localhost.localdomain localhost</p><p>Zimbra install grants mysql permissions only to localhost and</p><p>localhost.localdomain users. But Fedora&#x2F;RH installs leave lines such</p><p>as these in &#x2F;etc&#x2F;hosts:</p><p>127.0.0.1 myhost.mydomain.com myhost localhost.localdomain localhost</p><p>This causes MySQL to reject users coming from 127.0.0.1 as users from</p><p>myhost.mydomain.com. You can read more details at:</p><p><a target="_blank" rel="noopener" href="http://bugs.mysql.com/bug.php?id=11822">http://bugs.mysql.com/bug.php?id=11822</a></p><p><em>服务器IP</em> <em>完整域名</em> 主机名称（hostname命令显示的）</p><p>vi &#x2F;etc&#x2F;hosts</p><p>138.68.243.239 mail.example.com mail.example.com</p><h3 id="NTP"><a href="#NTP" class="headerlink" title="NTP"></a>NTP</h3><blockquote><p>Network Time Protocol（NTP）是用来使计算机时间同步化的一种协议，它可以使计算机对其服务器或时钟源（如石英钟，GPS等等)做同步化，它可以提供高精准度的时间校正（LAN上与标准间差小于1毫秒，WAN上几十毫秒），且可介由加密确认的方式来防止恶毒的协议攻击。</p></blockquote><p>yum install ntp</p><p>systemctl start ntpd</p><p>systemctl enable ntpd</p><h3 id="安装依赖包-wiki"><a href="#安装依赖包-wiki" class="headerlink" title="安装依赖包 wiki"></a>安装依赖包 <a target="_blank" rel="noopener" href="https://wiki.zimbra.com/wiki/Zimbra_dependencies_per_Operating_System">wiki</a></h3><p>从Zimbra Collaboration 8.7开始，Zimbra依赖于自己的存储库打包系统，这意味着Zimbra安装脚本会自动处理操作系统的依赖关系。</p><h3 id="安装及使用"><a href="#安装及使用" class="headerlink" title="安装及使用"></a>安装及使用</h3><p>wget <a target="_blank" rel="noopener" href="https://files.zimbra.com/downloads/8.7.5/_GA/zcs-8.7.5/_GA/_1764.RHEL7/_64.20170314032533.tgz">https://files.zimbra.com/downloads/8.7.5\_GA/zcs-8.7.5\_GA\_1764.RHEL7\_64.20170314032533.tgz</a></p><p>tar zxvf zcs–8.7.5_GA_1764.RHEL7_64.20170314032533.tgz</p><p>cd zcs–8.7.5_GA_1764.RHEL7_64.20170314032533</p><p># .&#x2F;install.sh</p><p>.&#x2F;install.sh —platform–override</p><p>安装出错可行一次：<code>/opt/zimbra/libexec/zmsetup.pl</code> 日志分析，不行就卸载重装了<code>./install.sh -u</code></p><p>安装过程就不一一列出来了，能y的设置y，跳到菜单的时候选7、选4设置管理员密码，r返回，a</p><p>查看占用空间：<code>du -sh /opt/zimbra/</code></p><p>切换到zimbra用户：<code>su - zimbra</code></p><p>查看运行状态：<code>zmcontrol status</code></p><p>重启服务：<code>zmcontrol restart</code></p><p>web管理界面：<a target="_blank" rel="noopener" href="https://mail.example.com:7071/">https://mail.example.com:7071/</a></p><p>web用户界面：<a target="_blank" rel="noopener" href="https://mail.example.com:7073/">https://mail.example.com:7073/</a></p><p><strong>添加新域名</strong> example.com</p><p><strong>简单的收发邮件</strong>：example.com 设置@的MX记录到mail.example.com</p><p>SPF,DKIM,DMARC <a target="_blank" rel="noopener" href="https://wiki.zimbra.com/wiki/Best_Practices_on_Email_Protection:_SPF,_DKIM_and_DMARC">wiki</a> <a target="_blank" rel="noopener" href="http://www.mail163.cn/anti-spam/">spam</a></p><h3 id="SPF"><a href="#SPF" class="headerlink" title="SPF"></a>SPF</h3><p>什么是SPF？ (Sender Policy Framework) 的缩写，一种以IP地址认证电子邮件发件人身份的技术，是非常高效的垃圾邮件解决方案。 接收邮件方会首先检查域名的SPF记录，来确定发件人的IP地址是否被包含在SPF记录里面，如果在，就认为是一封正确的邮件，否则会认为是一封伪造的邮件进行退回。</p><p>example.com 设置@的SPF和txt记录：v&#x3D;spf1 mx ~all（允许当前域名的mx记录对应的IP地址）</p><h3 id="DKIM"><a href="#DKIM" class="headerlink" title="DKIM"></a>DKIM</h3><p>Bug：</p><p>ZCS 8.7.x 已知问题 BUG zmdkimkeyutil 生成非有效的2048位DKIM</p><p>解决：&#x2F;opt&#x2F;zimbra&#x2F;libexec&#x2F;zmdkimkeyutil 修改所有2048关键字为1024</p><p>》升级DKIM签名：<code>/opt/zimbra/libexec/zmdkimkeyutil -u -d example.com</code></p><p>》更改DNS设置</p><p><strong>命令生成2048位DKIM</strong>：&#x2F;opt&#x2F;zimbra&#x2F;libexec&#x2F;zmdkimkeyutil -a -b 2048 -d example.com</p><p>DKIM是利用加密签名和验证的原理，发件人在发送邮件时候，将与域名相关的加密签名插入邮件，收件人收到邮件后就可以对签名进行验证，判断发件人地址的真实性。</p><ul><li>添加DKIM &#x2F;opt&#x2F;zimbra&#x2F;libexec&#x2F;zmdkimkeyutil -a -d example.com</li><li>升级DKIM &#x2F;opt&#x2F;zimbra&#x2F;libexec&#x2F;zmdkimkeyutil -u -d example.com</li><li>删除DKIM &#x2F;opt&#x2F;zimbra&#x2F;libexec&#x2F;zmdkimkeyutil -r -d example.com</li><li>查看DKIM &#x2F;opt&#x2F;zimbra&#x2F;libexec&#x2F;zmdkimkeyutil -q -d example.com</li></ul><p>生成1024位的DKIM 内容为</p><p>DKIM Data added to LDAP for domain example.com with selector E298BEBE–2D5A–11E7–9E70–F55E985B5BE7</p><p>Public signature to enter into DNS:</p><p>E298BEBE–2D5A–11E7–9E70–F55E985B5B17._domainkey IN TXT ( “v&#x3D;DKIM1; k&#x3D;rsa; “</p><p>“p&#x3D;MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC5Lkk2XnUgA9LoHWYgDb1URxyTnab0WuHA9CKUFtLWrjV6S87bcpzoVa3</p><h3 id="DMARC"><a href="#DMARC" class="headerlink" title="DMARC"></a>DMARC</h3><p>[DMARC]协议的主要目的是识别并拦截钓鱼邮件</p><p>DNS记录 名称：_dmarc  值：v&#x3D;DMARC1; p&#x3D;none</p><h3 id="域名解析记录"><a href="#域名解析记录" class="headerlink" title="域名解析记录"></a>域名解析记录</h3><p>类型：txt</p><p>DNS名称：E298BEBE-2D5A-11E7-9E70-F55E985B5B17._domainkey</p><p>值：”v&#x3D;DKIM1; k&#x3D;rsa;p&#x3D;MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC5Lkk2XnUgA9LoHWYgDb1URxyTnab0WuHA9CKUFtLWrjV6S87bcpzoVa3fGVc&#x2F;jChVfu5E4ZTif&#x2F;jNkBPeow7wnwajEpFo8G&#x2F;yR0e8aNwDghW8DYf9B21QPAtB9NqoNjoUSD1tDsTXor2tSqf8wormbVhN3Y9aWkAxMEUP594zUwIDAQAB”</p><h3 id="验证DKIM"><a href="#验证DKIM" class="headerlink" title="验证DKIM"></a>验证DKIM</h3><p><strong>验证公钥是否与私钥匹配</strong> 测试通过没有任何信息返回，否则返回record not found</p><p>&#x2F;opt&#x2F;zimbra&#x2F;common&#x2F;sbin&#x2F;opendkim-testkey -d example.com -s E298BEBE-2D5A-11E7-9E70-F55E985B5B17 -x &#x2F;opt&#x2F;zimbra&#x2F;conf&#x2F;opendkim.conf</p><h3 id="重新签发证书"><a href="#重新签发证书" class="headerlink" title="重新签发证书"></a>重新签发证书</h3><p>zimbra的证书有效期为365天，为了避免下次的麻烦，可以重新签发一个证书，有效期20年。</p><p>&#x2F;opt&#x2F;zimbra&#x2F;bin&#x2F;zmcertmgr createca –new</p><p>&#x2F;opt&#x2F;zimbra&#x2F;bin&#x2F;zmcertmgr deployca</p><p>&#x2F;opt&#x2F;zimbra&#x2F;bin&#x2F;zmcertmgr createcrt –new –days 7300</p><p>&#x2F;opt&#x2F;zimbra&#x2F;bin&#x2F;zmcertmgr deploycrt self</p><p>&#x2F;opt&#x2F;zimbra&#x2F;bin&#x2F;zmcertmgr viewdeployedcrt</p><h3 id="可以学习的内容"><a href="#可以学习的内容" class="headerlink" title="可以学习的内容"></a>可以学习的内容</h3><p>dnsmasq</p><p>named</p><h3 id="小工具"><a href="#小工具" class="headerlink" title="小工具"></a>小工具</h3><p><a target="_blank" rel="noopener" href="https://intodns.com/one.one">https://intodns.com/one.one</a> DNS检查</p><p><a target="_blank" rel="noopener" href="http://www.mail-tester.com/">http://www.mail-tester.com/</a> 邮件评分</p><p><a target="_blank" rel="noopener" href="https://dmarcian.com/dmarc-inspector/mgtgxp.pw">https://dmarcian.com/dmarc-inspector/mgtgxp.pw</a> dmarc测试</p><h3 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h3><p><a target="_blank" rel="noopener" href="https://www.renfei.org/blog/introduction-to-spf.html">https://www.renfei.org/blog/introduction-to-spf.html</a></p><p><a target="_blank" rel="noopener" href="http://170182.blog.51cto.com/160182/1272569">http://170182.blog.51cto.com/160182/1272569</a></p><p><a target="_blank" rel="noopener" href="https://www.mawenbao.com/research/email-spf-and-exim4-dkim-dmarc-config.html">https://www.mawenbao.com/research/email-spf-and-exim4-dkim-dmarc-config.html</a></p><p><a target="_blank" rel="noopener" href="http://imzhen.com/note/2015/08/09/20150809/">http://imzhen.com/note/2015/08/09/20150809/</a></p><blockquote><p><a target="_blank" rel="noopener" href="http://blog.topspeedsnail.com/archives/5546">CentOS 7 安装配置Zimbra邮件服务器</a></p></blockquote><p><a target="_blank" rel="noopener" href="https://www.chenxie.net/archives/1476.html">https://www.chenxie.net/archives/1476.html</a></p><p><a target="_blank" rel="noopener" href="http://www.bkjia.com/Linux/1112319.html">http://www.bkjia.com/Linux/1112319.html</a></p><p><a target="_blank" rel="noopener" href="https://bbotte.com/server-config/zimbra-configuration-mail-service-full-record/">https://bbotte.com/server-config/zimbra-configuration-mail-service-full-record/</a></p><blockquote><p><a target="_blank" rel="noopener" href="http://www.huike007.cn/?p=463">Zimbra8 安装说明</a></p></blockquote><p><a target="_blank" rel="noopener" href="http://blog.csdn.net/zzban/article/details/8640510">http://blog.csdn.net/zzban/article/details/8640510</a></p><p><a target="_blank" rel="noopener" href="https://www.kenceng-solusindo.net/read/intalasi-zimbra-mail-server-ubuntu-16-04/">https://www.kenceng-solusindo.net/read/intalasi-zimbra-mail-server-ubuntu-16-04/</a></p><p><a target="_blank" rel="noopener" href="http://record.blog.51cto.com/3300006/1206745">http://record.blog.51cto.com/3300006/1206745</a></p><p><a target="_blank" rel="noopener" href="https://www.chenxie.net/archives/1476.html">https://www.chenxie.net/archives/1476.html</a></p><p><a target="_blank" rel="noopener" href="http://www.linuxyw.com/linux/qitafuwu/20130605/540.html">http://www.linuxyw.com/linux/qitafuwu/20130605/540.html</a></p><p><a target="_blank" rel="noopener" href="http://m.blog.chinaunix.net/uid-31075838-id-5698408.html">http://m.blog.chinaunix.net/uid-31075838-id-5698408.html</a></p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://jarod.vip/2018/10/18/hetzner%E4%BD%BF%E7%94%A8proxmox%E6%88%96%E8%80%85solusvm%E5%BC%80nat-kvm%E7%8B%AC%E7%AB%8Bipv6%E6%A1%A5%E6%8E%A5%E7%BD%91%E5%8D%A1%E8%AE%BE%E7%BD%AE/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Jarod"><meta itemprop="description" content="记录生活中的点点滴滴"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jarod's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2018/10/18/hetzner%E4%BD%BF%E7%94%A8proxmox%E6%88%96%E8%80%85solusvm%E5%BC%80nat-kvm%E7%8B%AC%E7%AB%8Bipv6%E6%A1%A5%E6%8E%A5%E7%BD%91%E5%8D%A1%E8%AE%BE%E7%BD%AE/" class="post-title-link" itemprop="url">hetzner使用proxmox或者solusvm开Nat kvm独立ipv6桥接网卡设置</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-10-18 09:46:22" itemprop="dateCreated datePublished" datetime="2018-10-18T09:46:22+08:00">2018-10-18</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-09-29 21:27:45" itemprop="dateModified" datetime="2022-09-29T21:27:45+08:00">2022-09-29</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Linux教程</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>959</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>1 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><p>结果谷歌一系列的查找资料，最后还是到了hetzner的wiki找到了解决办法。</p><h3 id="1-proxmox桥接网卡配置："><a href="#1-proxmox桥接网卡配置：" class="headerlink" title="1.proxmox桥接网卡配置："></a>1.proxmox桥接网卡配置：</h3><p># &#x2F;etc&#x2F;network&#x2F;interfaces<br>### Hetzner Online GmbH - installimage<br># Loopback device:<br>auto lo<br>iface lo inet loopback<br>#<br># device: eth0<br>auto eth0<br>iface eth0 inet static<br>address<main ip><br>netmask 255.255.255.255<br>pointopoint<gateway><br>gateway<gateway><br>#<br>iface eth0 inet6 static<br>address<address from the ipv6 subnet>#eg: 2001:db8::2<br>netmask 128<br>gateway fe80::1<br>up sysctl -p<br># for single IPs<br>auto vmbr0<br>iface vmbr0 inet static<br>address 10.0.1.1<br>netmask 255.255.255.0<br>bridge_ports none<br>bridge_stp off<br>bridge_fd 0<br>#<br>iface vmbr0 inet6 static<br>address<address from the ipv6 subnet>#eg: 2001:db8::2<br>netmask 64</address></address></gateway></gateway></main></p><p>关于Nat链接网络请使用iptables实现。</p><h3 id="2-solusvm下网卡配置："><a href="#2-solusvm下网卡配置：" class="headerlink" title="2.solusvm下网卡配置："></a>2.solusvm下网卡配置：</h3><p>主网卡中默认配置请不要修改，仅需将IPV6ADDR的&#x2F;64换为&#x2F;128 例如：IPV6ADDR&#x3D; 2001:db8::2&#x2F;128 然后将桥接网卡更改为：</p><p>DEVICE=br0<br>ONBOOT=yes<br>TYPE=Bridge<br>BOOTPROTO=static<br>IPADDR=10.0.1.1<br>NETMASK=255.255.255.0<br>IPV6ADDR=2001:db8::2&#x2F;64</p><p>关于联网与端口映射请使用iptables</p><h3 id="3-关于虚拟机（kvm）的配置："><a href="#3-关于虚拟机（kvm）的配置：" class="headerlink" title="3.关于虚拟机（kvm）的配置："></a>3.关于虚拟机（kvm）的配置：</h3><p>这里拿2001:db8::此ipv6做示范 Debian or Ubuntu：</p><p>iface eth0 inet6 static<br>address 2001:db8::f001<br>netmask 64<br>gateway 2001:db8::2</p><p>Centos:</p><p>IPV6INIT=yes<br>IPV6ADDR=2001:db8::f001&#x2F;64<br>IPV6_DEFAULTGW=2001:db8::2</p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://jarod.vip/2018/10/18/%E4%BD%BF%E7%94%A8ipip%E6%89%93%E9%80%9A%E9%9A%A7%E9%81%93/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Jarod"><meta itemprop="description" content="记录生活中的点点滴滴"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jarod's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2018/10/18/%E4%BD%BF%E7%94%A8ipip%E6%89%93%E9%80%9A%E9%9A%A7%E9%81%93/" class="post-title-link" itemprop="url">使用IPIP打通隧道</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-10-18 09:41:58" itemprop="dateCreated datePublished" datetime="2018-10-18T09:41:58+08:00">2018-10-18</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-09-29 21:27:45" itemprop="dateModified" datetime="2022-09-29T21:27:45+08:00">2022-09-29</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Linux教程</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>804</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>1 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><p>查看IPIP模块：</p><p>modinfo ipip</p><p>开始建立隧道：</p><p>注：这里设置A主机的公网IP为1.1.1.1，B主机的公网IP为2.2.2.2</p><p>A主机操作：</p><p>ip tunnel add ipip-tunnel mode ipip remote 2.2.2.2 local 1.1.1.1 ifconfig ipip-tunnel 10.0.1.1 netmask 255.255.255.0</p><p>B主机操作：</p><p>ip tunnel add ipip-tunnel mode ipip remote 1.1.1.1 local 2.2.2.2 ifconfig ipip-tunnel 10.0.1.2 netmask 255.255.255.0</p><p>然后这时候就可以在B主机上pingA主机设置的内网IP10.0.1.1看是否想通，如果同的话就代表成功打通。</p><p>此外介绍一种直接使用网卡配置文件（CentOS系统）的方法：</p><p>A主机（&#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-ipip-tunnel）</p><p>DEVICE=ipip-tunnel<br>ONBOOT=yes<br>TYPE=IPIP<br>TTL=255<br>PEER_OUTER_IPADDR=2.2.2.2<br>PEER_INNER_IPADDR=10.0.1.2<br>MY_OUTER_IPADDR=1.1.1.1<br>MY_INNER_IPADDR=10.0.1.1</p><p>B主机（&#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-ipip-tunnel）</p><p>DEVICE=ipip-tunnel<br>ONBOOT=yes<br>TYPE=IPIP<br>TTL=255<br>PEER_OUTER_IPADDR=1.1.1.1<br>PEER_INNER_IPADDR=10.0.1.1<br>MY_OUTER_IPADDR=2.2.2.2<br>MY_INNER_IPADDR=10.0.1.2</p><p>然后启动网卡即可</p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://jarod.vip/2018/10/10/%E8%B6%85%E7%BA%A7%E4%B8%80%E9%94%AE/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Jarod"><meta itemprop="description" content="记录生活中的点点滴滴"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jarod's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2018/10/10/%E8%B6%85%E7%BA%A7%E4%B8%80%E9%94%AE/" class="post-title-link" itemprop="url">超级一键</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-10-10 01:28:04" itemprop="dateCreated datePublished" datetime="2018-10-10T01:28:04+08:00">2018-10-10</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-09-29 21:27:45" itemprop="dateModified" datetime="2022-09-29T21:27:45+08:00">2022-09-29</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E5%85%B6%E4%BB%96/" itemprop="url" rel="index"><span itemprop="name">其他</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>137</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>1 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -N --no-check-certificate https://raw.githubusercontent.com/ToyoDAdoubi/doubi/master/ssr.sh &amp;&amp; chmod +x ssr.sh &amp;&amp; bash ssr.sh</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://jarod.vip/2018/10/07/%E9%AD%94%E6%94%B9bbr%E4%B8%80%E9%94%AE%E8%84%9A%E6%9C%AC%E5%90%88%E9%9B%86/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Jarod"><meta itemprop="description" content="记录生活中的点点滴滴"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jarod's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2018/10/07/%E9%AD%94%E6%94%B9bbr%E4%B8%80%E9%94%AE%E8%84%9A%E6%9C%AC%E5%90%88%E9%9B%86/" class="post-title-link" itemprop="url">魔改BBR一键脚本合集</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-10-07 20:38:45" itemprop="dateCreated datePublished" datetime="2018-10-07T20:38:45+08:00">2018-10-07</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-09-29 21:27:45" itemprop="dateModified" datetime="2022-09-29T21:27:45+08:00">2022-09-29</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Linux教程</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>2.7k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>2 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><p><strong>第一部分：OPENVZ平台</strong></p><p>一、OpenVZ 平台 Google BBR（魔改） 一键安装脚本</p><p>来源：<a target="_blank" rel="noopener" href="https://blog.kuoruan.com/116.html"><strong>扩软</strong></a></p><p>安装：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/kuoruan/shell-scripts/master/ovz-bbr/ovz-bbr-installer.sh</span><br><span class="line">chmod +x ovz-bbr-installer.sh</span><br><span class="line">./ovz-bbr-installer.sh</span><br></pre></td></tr></table></figure><p>卸载：.&#x2F;ovz-bbr-installer.sh uninstall</p><p>修改端口配置：vi &#x2F;usr&#x2F;local&#x2F;haproxy-lkl&#x2F;etc&#x2F;port-rules 。在文件里添加需要加速的端口，每行一条，可以配置单个端口或者端口范围，以 # 开头的行将被忽略。 例如：8800 或者 8800-8810 配置完成之后，只需要重启 haproxy-lkl 即可。使用 systemctl 或者 service 命令来启动、停止和重启 HAporxy-lkl：</p><p>systemctl {startstoprestart} haproxy-lkl</p><p>或</p><p>service haproxy-lkl {startstoprestart}</p><p><strong>二、OpenVZ平台魔改BBR一键脚本之Rinetd方式</strong></p><p>来源：<a target="_blank" rel="noopener" href="https://sometimesnaive.org/article/54">南琴浪</a>  <a target="_blank" rel="noopener" href="https://github.com/nanqinlang-tcp/tcp_nanqinlang/tree/master/Rinetd/bash">GITHUB项目地址</a></p><p>优点：Rinetd就是另外一种lkl bbr，好处是不需要开启TUN&#x2F;TAP，对于后台没有或者找不到这个模块的，刚好可以用一下。</p><p><strong>缺点：不支持IP段加速，每个要加速的端口都需要单独配置。</strong></p><p>更新： 2018-03-24 新增 多网卡 适配</p><p><strong>Debian or Ubuntu</strong></p><p>单网卡（单 IP） 服务器：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/nanqinlang-tcp/tcp_nanqinlang/master/Rinetd/bash/tcp_nanqinlang-rinetd-debian+ubuntu.sh</span><br><span class="line">bash tcp_nanqinlang-rinetd-debian+ubuntu.sh</span><br></pre></td></tr></table></figure><p>多网卡（多 IP） 服务器，会为所有网卡（所有 IP）提供加速：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/nanqinlang-tcp/tcp_nanqinlang/master/Rinetd/bash/tcp_nanqinlang-rinetd-debian+ubuntu-multiNIC.sh</span><br><span class="line">bash tcp_nanqinlang-rinetd-debian+ubuntu-multiNIC.sh</span><br></pre></td></tr></table></figure><p>CentOS 7</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 单网卡</span><br><span class="line">wget https://raw.githubusercontent.com/nanqinlang-tcp/tcp_nanqinlang/master/Rinetd/bash/tcp_nanqinlang-rinetd-centos.sh</span><br><span class="line">bash tcp_nanqinlang-rinetd-centos.sh</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>运行脚本会出现下面几个选项：</p><p><strong>安装 rinetd-bbr</strong></p><p>此脚本会在&#x2F;home&#x2F;tcp_nanqinlang进行安装，所以安装完成后不要动这个文件夹了（除非你想修改端口）。安装过程中，会提示输入端口号。多个端口号用空格隔开。<strong>不支持端口段。</strong>安装完成后，会开启 rinetd-bbr。以后重启机器也会随开机自启。使用前请注意自己的 iptables 相关设置。</p><h3 id="检查-rinetd-bbr-运行状态"><a href="#检查-rinetd-bbr-运行状态" class="headerlink" title="检查 rinetd-bbr 运行状态"></a><strong>检查 rinetd-bbr 运行状态</strong></h3><p>此命令用于检查 rinetd-bbr 运行与否，可通过返回的提示判断。</p><h3 id="卸载-rinetd-bbr"><a href="#卸载-rinetd-bbr" class="headerlink" title="卸载 rinetd-bbr"></a><strong>卸载 rinetd-bbr</strong></h3><p>运行此命令会删除 &#x2F;home&#x2F;tcp_nanqinlang 、移除 rc.local 对应开机自启项和清空 iptables raw 表。属于完整卸载，不会有残留。且卸载后无需重启。</p><p><strong>三、OpenVZ 魔改 BBR - LKL 一键脚本</strong></p><p>来源：<a target="_blank" rel="noopener" href="https://sometimesnaive.org/article/39">南琴浪</a> <a target="_blank" rel="noopener" href="https://github.com/tcp-nanqinlang">GITHUB项目地址</a></p><p>优点：支持IP段加速</p><p>安装方法：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Debian 8+</span><br><span class="line"># 64 bit</span><br><span class="line"># ldd &gt; = 2.14</span><br><span class="line"># tun/tap enabled</span><br><span class="line">wget https://github.com/tcp-nanqinlang/lkl-haproxy/releases/download/1.1.1/tcp_nanqinlang-haproxy-debian.sh</span><br><span class="line">bash tcp_nanqinlang-haproxy-debian.sh</span><br><span class="line"></span><br></pre></td></tr></table></figure><p> </p><p>以下进行脚本使用说明：</p><h3 id="安装-LKL"><a href="#安装-LKL" class="headerlink" title="安装 LKL"></a>安装 LKL</h3><p>此命令用于安装 LKL。</p><p>在&#x2F;home&#x2F;tcp_nanqinlang进行安装，所以安装完成后不要动这个文件夹了（除非你想修改端口）。</p><p>安装过程中，会提示你选择</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">单个端口</span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">端口段</span><br></pre></td></tr></table></figure><p>输入，具体已在运行脚本的提示中有说明，这里不再赘述。</p><p>安装完成后，会开启 LKL。以后重启机器也会随开机自启。</p><p>以后若需要修改转发端口，请将&#x2F;home&#x2F;tcp_nanqinlang&#x2F;haproxy.cfg中的端口号和&#x2F;home&#x2F;tcp_nanqinlang&#x2F;redirect.sh中的端口号改为你想要的端口或端口段，修改完成后重启服务器。</p><p>使用前请注意自己的 iptables 相关设置。</p><h3 id="检查-LKL-运行状态"><a href="#检查-LKL-运行状态" class="headerlink" title="检查 LKL 运行状态"></a>检查 LKL 运行状态</h3><p>此命令用于检查 LKL 运行与否，可通过返回的提示判断。</p><h3 id="卸载-LKL"><a href="#卸载-LKL" class="headerlink" title="卸载 LKL"></a>卸载 LKL</h3><p>运行此命令会卸载 haproxy、删除 &#x2F;home&#x2F;tcp_nanqinlang、移除 rc.local 开机自启项。稍后请自行移除iptables相关规则。</p><p>该脚本项目最新的地址是：<a target="_blank" rel="noopener" href="https://github.com/tcp-nanqinlang">https://github.com/tcp-nanqinlang</a></p><h2 id="第二部分：KVM平台、独服"><a href="#第二部分：KVM平台、独服" class="headerlink" title="第二部分：KVM平台、独服"></a><strong>第二部分：KVM平台、独服</strong></h2><p>一、BBR+BBR魔改+Lotsever(锐速)一键脚本 for Centos&#x2F;Debian&#x2F;Ubuntu</p><p>来源：<a target="_blank" rel="noopener" href="https://www.94ish.net/1635.html">千影</a></p><p>支持系统 Centos 6+ &#x2F; Debian 7+ &#x2F; Ubuntu 14+ BBR魔改版不支持Debian 8</p><p>安装：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget -N --no-check-certificate &quot;https://raw.githubusercontent.com/chiakge/Linux-NetSpeed/master/tcp.sh&quot;</span><br><span class="line">chmod +x tcp.sh</span><br><span class="line">./tcp.sh</span><br></pre></td></tr></table></figure><p><a target="_blank" rel="noopener" href="https://maijiaoben.com/wp-content/uploads/2018/03/1.png"><img src="https://maijiaoben.com/wp-content/uploads/2018/03/1.png" alt="魔改BBR一键安装"></a></p><p>魔改BBR一键安装</p><p>说明：运行脚本后会出现上图的界面。安装魔改BBR先选择1安装对应内核，安装完毕后重启机器，然后再进入脚本目录重新执行脚本，选择4安装魔改BBR。</p><p>如果出现下图界面，需要选<strong>NO</strong>：</p><p><a target="_blank" rel="noopener" href="https://maijiaoben.com/wp-content/uploads/2018/03/2.png"><img src="https://maijiaoben.com/wp-content/uploads/2018/03/2-1024x677.png" alt="此界面要选NO"></a></p><p>此界面要选NO</p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://jarod.vip/2018/10/07/%E5%9C%A8centos-7%E4%B8%AD%E5%AE%89%E8%A3%85kvm%E5%B9%B3%E5%8F%B0%E6%90%AD%E5%BB%BAvps-2/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Jarod"><meta itemprop="description" content="记录生活中的点点滴滴"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jarod's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2018/10/07/%E5%9C%A8centos-7%E4%B8%AD%E5%AE%89%E8%A3%85kvm%E5%B9%B3%E5%8F%B0%E6%90%AD%E5%BB%BAvps-2/" class="post-title-link" itemprop="url">在CentOS 7中安装KVM平台搭建VPS</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-10-07 17:24:42" itemprop="dateCreated datePublished" datetime="2018-10-07T17:24:42+08:00">2018-10-07</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-09-29 21:27:45" itemprop="dateModified" datetime="2022-09-29T21:27:45+08:00">2022-09-29</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Linux教程</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>2.4k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>2 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><p>KVM即Kernal-based Virtual Machine, 是一种高效且成熟稳定的虚拟化技术, 支持所有的操作系统. 因此, 掌握服务器上搭建KVM平台是很有意义的. 通过虚拟机的建立以及IP分配, 虚拟机可以当做一台完全独立的服务器来使用, 即我们常用的VPS.</p><p>搭建虚拟机平台对宿主机系统的要求较高. KVM虚拟化要求宿主机的CPU支持Intel VT或AMD-V技术 (请执行cat &#x2F;proc&#x2F;cpuinfo查看), CPUBenchMark至少在1000以上, 建议5000或更多 (ATOM D525这种就不要来装虚拟机了). 系统内存要求至少为4G, 建议8G或更多. 硬盘要求20G以上. 操作系统必须为64位. 服务器至少分配2枚或以上的独立IP地址 (每个VPS一枚, 宿主机一枚). 本次教程, 我们以最新版本的CentOS 7为例, 介绍KVM平台的搭建.</p><h2 id="1-系统环境准备"><a href="#1-系统环境准备" class="headerlink" title="1, 系统环境准备"></a>1, 系统环境准备</h2><p>(1) 设置服务器名(Hostname)</p><p>任何与网络相关的Linux操作都要求设置好服务器名. 请确保您已经正确设置服务器名: 当您在SSH中执行hostname -f命令时, 应看到servername.domainname.com; 当您执行hostname命令时, 应看到servername. 具体设置方法我已强调数十遍, 这里不再赘述. 若未设置好服务器名, 请不要继续.</p><p>(2) 软件更新</p><p>CentOS系统下执行yum -y update命令更新软件.</p><p>(3) 检查网络与IP信息</p><p>CentOS 7系统中执行ip addr命令查看网卡及IP地址信息. 查看一下绑定您的宿主机外网主IP地址的网卡名称, 记下它, 我这里是ens9. 查看一下是否有其他的虚拟网卡绑定了额外的外网IP地址, 若有, 请删除对应的虚拟网卡.</p><p>本次教程中, 我们假设给宿主机分配的IP地址段为标准网段100.100.100.200&#x2F;29共8个IP, 则网络地址100.100.100.200, 网关100.100.100.201, 宿主机IP 100.100.100.202, VPS IP段100.100.100.203 ~ 100.100.100.206, 广播地址100.100.100.207, 子网掩码255.255.255.248.</p><h2 id="2-桌面环境的搭建"><a href="#2-桌面环境的搭建" class="headerlink" title="2, 桌面环境的搭建"></a>2, 桌面环境的搭建</h2><p>如果您仅使用一台服务器搭建KVM, 那我建议搭建桌面环境并搭建VNC服务器, 这样在管理KVM虚拟机和安装操作系统时较为方便. 我们以GNOME桌面环境为例介绍VNC服务器的搭建. GNOME桌面环境安装很简单, 执行下面这行命令即可:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum groupinstall &quot;GNOME Desktop&quot;</span><br></pre></td></tr></table></figure><p>然后安装VNC服务器. 执行:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install tigervnc-server</span><br></pre></td></tr></table></figure><p>新建用户, 用来连接VNC, 并配置用户的连接文件. 执行:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">useradd jarod</span><br><span class="line">cp /lib/systemd/system/vncserver@.service /etc/systemd/system/vncserver@:1.service</span><br></pre></td></tr></table></figure><p>编辑文件: &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;vncserver@:1.service</p><p>将文件中的<user>替换为我们的用户名jarod, 并取消行首的注释符.</user></p><p>配置防火墙:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --zone=public --add-service vnc-server</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><p>然后, 切换到用户jarod， 启动VNC服务器:</p><p>su jarod vncserver</p><p>此时, 会提示输入VNC密码, 设置好后回车即可.</p><p>最后切换回root, 设置随开机启动:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">su root</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl enable vncserver@:1.service</span><br></pre></td></tr></table></figure><p>这样, 我们就配置好VNC服务器了. 在本地电脑上使用VNC客户端连接100.100.100.202:5901即可访问服务器的GNOME桌面环境. 第一次使用VNC连接的时候会提示输入管理员密码, 如下图.</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/0.png" alt="0"></p><p>此时请输入您的root用户密码. 然后会提示一系列配置信息, 直接NEXT就好.</p><h2 id="3-KVM的安装"><a href="#3-KVM的安装" class="headerlink" title="3, KVM的安装"></a>3, KVM的安装</h2><p>KVM安装很简单. 在SSH中执行下面这行命令即可.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install qemu-kvm qemu-img virt-manager libvirt libvirt-python libvirt-client virt-install virt-viewer</span><br></pre></td></tr></table></figure><h2 id="4-在宿主机上新建VPS"><a href="#4-在宿主机上新建VPS" class="headerlink" title="4, 在宿主机上新建VPS"></a>4, 在宿主机上新建VPS</h2><p>首先, 使用VNC连接宿主机. 进入桌面后, 找到Virtual Machine Manager, 如下图.</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/1.png" alt="1"></p><p>打开后, 点击图标Create a new virtual machine.</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/2.png" alt="2"></p><p>然后按步骤载入系统镜像. 如果没有系统镜像的, 可以去我的下载站<a target="_blank" rel="noopener" href="http://wget.pro下载/">http://wget.pro下载</a>.</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/3.png" alt="3"></p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/4.png" alt="4"></p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/5.png" alt="5"></p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/6.png" alt="6"></p><p>接着分配内存和硬盘. KVM是实虚拟, 因此分配内存后宿主机就不能再使用这部分资源了.</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/7.png" alt="7"></p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/8.png" alt="8"></p><p>最后分配网卡. 这里我们要选择桥接模式Bridge, 并选择宿主机的出口网卡. 如下图.</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/9.png" alt="9"></p><p>这样, 我们就新建完成了VPS, 可以安装操作系统了.</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/10.png" alt="10"></p><p>是不是很简单呢? 安装系统的时候有一个步骤是配置网络信息, 这里我们的DHCP是不生效的, 需要在VPS上获取IP. 选择Configure Network Manually, 然后按照第一部分第三小节的信息来配置即可.</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/11.png" alt="11"></p><p>至此, 大功告成. 我们在VPS上安装SSH服务器后, 就可以对它进行完全独立的网络访问了.</p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料:"></a>参考资料:</h3><p>1, Kishore, S. <em>VNC-Server installation on CentOS 7</em>. <a target="_blank" rel="noopener" href="https://www.howtoforge.com/vnc-server-installation-on-centos-7">https://www.howtoforge.com/vnc-server-installation-on-centos-7</a></p><p><a target="_blank" rel="noopener" href="http://linux.dell.com/files/whitepapers/KVM_Virtualization_in_RHEL_7_Made_Easy.pdf">2, Rosa, J. <em>KVM Virtualization in RHEL 7 Made Easy</em>. Dell.</a></p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://jarod.vip/2018/10/03/%E4%B8%80%E9%94%AE%E7%BD%91%E7%BB%9C%E5%AE%89%E8%A3%85%E6%9C%80%E6%96%B0%E7%BA%AF%E5%87%80centos7-x%E8%87%AA%E5%8A%A8%E5%88%86%E5%8C%BA%E6%89%A9%E5%AE%B9%E7%89%88%E5%8F%91%E5%B8%83/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Jarod"><meta itemprop="description" content="记录生活中的点点滴滴"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jarod's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2018/10/03/%E4%B8%80%E9%94%AE%E7%BD%91%E7%BB%9C%E5%AE%89%E8%A3%85%E6%9C%80%E6%96%B0%E7%BA%AF%E5%87%80centos7-x%E8%87%AA%E5%8A%A8%E5%88%86%E5%8C%BA%E6%89%A9%E5%AE%B9%E7%89%88%E5%8F%91%E5%B8%83/" class="post-title-link" itemprop="url">一键网络安装最新纯净CentOS7.X(自动分区扩容版)发布</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-10-03 14:20:00" itemprop="dateCreated datePublished" datetime="2018-10-03T14:20:00+08:00">2018-10-03</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-09-29 21:27:45" itemprop="dateModified" datetime="2022-09-29T21:27:45+08:00">2022-09-29</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Linux教程</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>2.3k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>2 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><p>简介</p><p>之前的CentOS7系统模板是手动分区版，是为兼容磁盘较小的服务器以及使得用户可以手动挂载自己的数据盘，避免在安装时因为自动分区导致将用户数据盘格式化等问题，因此手动分区版在自动安装完成后，系统默认只分配了4.5GB，剩余磁盘需要进行手动分区扩容。</p><p>所以，今天的自动分区版发布了，毕竟手动分区还要花费几分钟时间去手动操作，为什么不在安装时就自动分配所有的磁盘空间给（&#x2F;）根分区呢？这样安装完直接就是所有磁盘空间都被应用，省去了人工去分区的精力和时间，效率就是金钱。这真是太棒了。</p><p>当然手动分区版的存在也是必要的，毕竟有些MJJ们需要手动去分区，例如想给home自定义分区或者挂载数据盘，脚本中默认为自动分区版，因此对于需要手动分区的MJJ们可以手动修改安装地址为手动分区版地址即可。两个版本的唯一差别就是一个会自动分区(所有空间划给&#x2F;根分区)，一个需要手动分区(安装完成后可自定义手动划分分区)。两版安装完均是当前最新的CentOS7.X，CentOS发布什么最新版本，安装完就是什么最新的版本。截至2018年8月CentOS发布的为7.5版。</p><p>预览图片（套路云一键重装完）</p><p>配置为：1C&#x2F;1G&#x2F;40G&#x2F;200M&#x2F;1T的机器</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/5b8514af9ddb6.png"></p><h3 id="如何使用和做"><a href="#如何使用和做" class="headerlink" title="如何使用和做"></a>如何使用和做</h3><p>一键安装具有两种系统模板，以下教程中默认使用自动分区版（一个是自动分区版，一个是手动分区版，你应该按照你的需求进行选择）</p><p><code>自动分区版：https://opendisk.cxthhhhh.com/OperatingSystem/CentOS/CentOS_7.X_NetInstall_AutoPartition.vhd.gz</code> <code>手动分区版：https://opendisk.cxthhhhh.com/OperatingSystem/CentOS/CentOS_7.X_NetInstall.vhd.gz</code></p><p>如需手动进行分区（可根据您的需求定制化，比如挂载数据盘等），请将下面代码中的系统模板地址替换为手动分区版的地址，代码中默认为自动分区版。</p><p>我提供两种方式供你采用。（任选其一）。</p><p>1. 进入恢复模式（推荐）或在常规模式下，查看要安装的磁盘。（以下命令需要修改到您自己的磁盘）</p><p>①如果你是VPS，你应该像这样运行 <code>wget -qO- https://opendisk.cxthhhhh.com/OperatingSystem/CentOS/CentOS_7.X_NetInstall_AutoPartition.vhd.gz gunzip -dc dd of=/dev/vda</code> ②如果你是一个专用服务器，你应该像这样运行 <code>wget -qO- https://opendisk.cxthhhhh.com/OperatingSystem/CentOS/CentOS_7.X_NetInstall_AutoPartition.vhd.gz gunzip -dc dd of=/dev/sda</code></p><p>2. 在正常模式下执行以下命令（通过MoeClub.org提供的脚本） (你需要注意，下面命令中引号是”英文状态引号”。)</p><p><code>wget --no-check-certificate -qO InstallNET.sh &#39;https://moeclub.org/attachment/LinuxShell/InstallNET.sh&#39; &amp;&amp; bash InstallNET.sh -dd &#39;https://opendisk.cxthhhhh.com/OperatingSystem/CentOS/CentOS_7.X_NetInstall_AutoPartition.vhd.gz&#39;</code></p><h3 id="您得明白"><a href="#您得明白" class="headerlink" title="您得明白"></a>您得明白</h3><p>1. 它将帮助您重新安装最新的CentOS7.X系统。（正式，纯粹，安全，高效） 2. 执行后，您可能需要15-45分钟后才能通过IP:22进行连接。 3. 新安装的系统root密码为[cxthhhhh.com] 。 4. 系统首次启动后，请等待自动安装完成，系统将自动重启，然后才能使用。（安装过程中的手动干预可能会导致错误） 5. IPV4和IPV6是开启的，并通过DHCP获取网络信息。 6. 系统的DNS将被设置为1.1.1.1和8.8.8.8，用来保护您的隐私。 7. 系统使用官方CentOS镜像，将自动匹配yum信息。拒绝服务提供商劫持。 8. 登录信息标准化，易于管理。您需要在登录后修改它。 9. 完成测试，非常适合Azure，Google Cloud，Vultr，Online，Net，OVH，阿里云，腾讯云中的许多专用服务器和KVM服务器。欢迎您的反馈。 10. 对于手动分区版系统模板，默认分配磁盘大小为4.5G。 11. 当你使用我的解决方案，我想说，感谢您信任我。我非常感谢您。我很高兴可以帮助到你。如果您不信任我的解决方案，请关闭页面，信任这是平等的。我相信技术不分国家，欢迎一起讨论，共同研究最新技术。 12. 自动分区版将会把所有的硬盘剩余空间分配给（&#x2F;）根分区，请注意，你只可以在全新的服务器上使用自动分区版，如果你有数据在服务器上，请使用手动分区版（根据需求手动挂载您的数据盘），这是为了防止自动分区版在安装时将您的数据盘格式化。 13. 在每次重装前，请保证你已经通过服务商面板重装过一次系统（CentOS&#x2F;Debian&#x2F;Ubuntu均可），不可以在已经DD安装过的系统上使用萌咖的自动脚本再次DD本系统，否则会报错，系统无法启动。手动DD不受此问题影响。 14. 在安装过程中，请勿手动进行操作，也许会导致错误。如果您在屏幕（VNC）上看到以下界面，代表正在安装系统，请耐心等待。</p><p><img src="https://www.jarods.org/wp-content/uploads/2018/10/CentOS_7.X_NetInstall.png"></p><h3 id="开始享受纯净的CentOS7。"><a href="#开始享受纯净的CentOS7。" class="headerlink" title="开始享受纯净的CentOS7。"></a>开始享受纯净的CentOS7。</h3></div><footer class="post-footer"><div class="post-eof"></div></footer></article><nav class="pagination"><a class="extend prev" rel="prev" href="/page/16/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><span class="page-number current">17</span><a class="page-number" href="/page/18/">18</a><span class="space">&hellip;</span><a class="page-number" href="/page/26/">26</a><a class="extend next" rel="next" href="/page/18/"><i class="fa fa-angle-right" aria-label="下一页"></i></a></nav></div><script>window.addEventListener("tabs:register",()=>{let t=CONFIG.comments["activeClass"];var e;(t=CONFIG.comments.storage?localStorage.getItem("comments_active")||t:t)&&(e=document.querySelector(`a[href="#comment-${t}"]`))&&e.click()}),CONFIG.comments.storage&&window.addEventListener("tabs:click",t=>{t.target.matches(".tabs-comment .tab-content .tab-pane")&&(t=t.target.classList[1],localStorage.setItem("comments_active",t))})</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><p class="site-author-name" itemprop="name">Jarod</p><div class="site-description" itemprop="description">记录生活中的点点滴滴</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">258</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">6</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">306</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/jarodvip" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jarodvip" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Jarod</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-chart-area"></i> </span><span title="站点总字数">647k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="站点阅读时长">9:48</span></div><div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动</div></div></footer></div><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script></body></html>