<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"jarod.vip",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"always",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="记录生活中的点点滴滴"><meta property="og:type" content="website"><meta property="og:title" content="Jarod&#39;s Blog"><meta property="og:url" content="https://jarod.vip/page/11/index.html"><meta property="og:site_name" content="Jarod&#39;s Blog"><meta property="og:description" content="记录生活中的点点滴滴"><meta property="og:locale" content="zh_CN"><meta property="article:author" content="Jarod"><meta property="article:tag" content="VPS,hexo,linux,debian,windows,macos"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://jarod.vip/page/11/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!0,isPost:!1,lang:"zh-CN"}</script><title>Jarod's Blog</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-R131WF8QZC"></script><script>function gtag(){dataLayer.push(arguments)}CONFIG.hostname===location.hostname&&(window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-R131WF8QZC"))</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?e67344a16e268228733f496a595ecb7a",document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="Jarod's Blog" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">Jarod's Blog</h1><span class="logo-line-after"><i></i></span></a></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content index posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://jarod.vip/2019/10/20/%E4%BD%BF%E7%94%A8acme-sh%E8%8E%B7%E5%8F%96%E5%85%8D%E8%B4%B9ssl%E8%AF%81%E4%B9%A6/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Jarod"><meta itemprop="description" content="记录生活中的点点滴滴"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jarod's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2019/10/20/%E4%BD%BF%E7%94%A8acme-sh%E8%8E%B7%E5%8F%96%E5%85%8D%E8%B4%B9ssl%E8%AF%81%E4%B9%A6/" class="post-title-link" itemprop="url">使用acme.sh获取免费SSL证书</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-10-20 01:49:01" itemprop="dateCreated datePublished" datetime="2019-10-20T01:49:01+08:00">2019-10-20</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-09-29 21:27:46" itemprop="dateModified" datetime="2022-09-29T21:27:46+08:00">2022-09-29</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Linux教程</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>886</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>1 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p><a target="_blank" rel="noopener" href="https://github.com/Neilpang/acme.sh">acme.sh</a> 是一个 ACME(自动化证书管理环境) 脚本，可以从 letsencrypt 生成免费的证书。</p><p>本来这个教程是写在 <a target="_blank" rel="noopener" href="https://zhih.me/make-your-website-support-tls1-3/">编译Nginx支持TLS1.3</a> 那篇帖子里的，后来感觉还是单独拿出来比较好，即能让那篇教程更简洁，也能更方便的让需要的人看到这个教程。</p><h2 id="安装工具"><a href="#安装工具" class="headerlink" title="安装工具"></a>安装工具</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install cron socat -y</span><br></pre></td></tr></table></figure><h2 id="获取-acme-sh"><a href="#获取-acme-sh" class="headerlink" title="获取 acme.sh"></a>获取 acme.sh</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl  https://get.acme.sh  sh</span><br></pre></td></tr></table></figure><p>重启终端，如果你使用 zsh 可以这样 <code>source ~/.zshrc</code></p><h2 id="生成证书"><a href="#生成证书" class="headerlink" title="生成证书"></a>生成证书</h2><p>使用 http 方式验证域名，需要先搭建 HTTP 站点，这里使用 acme.sh 自带的 webserver，所以先把 nginx 停掉</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service nginx stop</span><br></pre></td></tr></table></figure><p>接下来指定域名，开始签发</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --issue -d onmp.ooo \</span><br><span class="line">        --keylength ec-256 \</span><br><span class="line">        --standalone</span><br></pre></td></tr></table></figure><p>如果是多域名，可以使用 -d 参数添加，如：<code>-d www.onmp.ooo</code> <code>--keylength ec-256</code> 是签发 ECC 类型的证书，它的安全性更高，删除则使用默认的 RSA 证书</p><h2 id="复制证书"><a href="#复制证书" class="headerlink" title="复制证书"></a>复制证书</h2><p>证书已经签发了，不过默认是保存在 <code>~/.acme.sh/</code> 里</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --ecc --installcert -d onmp.ooo \</span><br><span class="line">        --key-file /usr/local/nginx/conf/ssl/onmp.ooo.key \</span><br><span class="line">        --fullchain-file /usr/local/nginx/conf/ssl/onmp.ooo.cer \</span><br><span class="line">        --reloadcmd &quot;service nginx restart&quot;</span><br></pre></td></tr></table></figure><p>指定域名，指定证书保存目录，我这里设置在 <code>/usr/local/nginx/conf/ssl/</code>，指定 Nginx 重载命令，如果签发的不是 ECC 证书，把 <code>--ecc</code> 参数去掉</p><p>这样使用 acme.sh 就完成了证书的签发，如果证书快要过期了，脚本会自动更新证书</p><p>脚本自动更新，可以使用以下命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --upgrade --auto-upgrade</span><br></pre></td></tr></table></figure><p> </p><h2 id="证书安装"><a href="#证书安装" class="headerlink" title="证书安装"></a>证书安装</h2><p>证书已经获取并且可以自动更新了，具体安装方法看 <a target="_blank" rel="noopener" href="https://zhih.me/make-your-website-support-tls1-3/">编译Nginx支持TLS1.3</a></p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://jarod.vip/2019/10/20/zerotier%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E6%95%99%E7%A8%8B/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Jarod"><meta itemprop="description" content="记录生活中的点点滴滴"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jarod's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2019/10/20/zerotier%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E6%95%99%E7%A8%8B/" class="post-title-link" itemprop="url">ZeroTier内网穿透教程</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-10-20 01:46:00" itemprop="dateCreated datePublished" datetime="2019-10-20T01:46:00+08:00">2019-10-20</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-09-29 21:27:46" itemprop="dateModified" datetime="2022-09-29T21:27:46+08:00">2022-09-29</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Linux教程</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>2.1k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>2 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>有时候需要在外边访问家里的设备，而众所周知一般家里都没有固定 IP 的，这时候就要内网穿透了，说到穿透的时候，大家都会提到 DDNS(动态域名解析)，或者使用反向代理的方式如 FRP、Ngrok。</p><p>首先说说 DDNS，这种方式使用起来很方便，只要设置好相应的服务提供商的 API，就能做到每次 IP 变化后自动解析，这样不管家里 IP 怎么变，用域名都能访问回家。这里最大的硬伤就是<strong>公网IP</strong>，有些朋友的带宽就是个大局域网，路由器只能获取到上一级内网的 IP，这时就 GG 了。</p><p>然后是 FRP、Ngrok 这样的反向代理程序，通过服务器转发数据来达到外网访问的目的，这样就需要自己有个 VPS，或者使用他人搭建的服务，据我所知的免费服务都是限速的，要是自己搭建的话，体验就要看服务器的<strong>网络质量</strong>了。</p><p>现在我们就来看看，<strong>不需要公网 IP，不依赖服务端网络性能的 ZeroTier</strong>。</p><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><a target="_blank" rel="noopener" href="https://www.zerotier.com/">ZeroTier 官网</a>上说</p><blockquote><p>ZeroTier is a smart Ethernet switch for planet Earth.</p></blockquote><p>!!! 适用于地球的智能网络交换机 …</p><p>它是一个分布式网络虚拟机管理程序，建立在加密安全的全球对等网络之上。它提供与企业 SDN 交换机同等的高级网络虚拟化和管理功能，而且可以跨本地和广域网并连接几乎任何类型的应用程序或设备。</p><p>好吧?，有点牛逼</p><p>而说到主要功能，就是可以把多个不同网络的设备连接在一起，用来就像在一个局域网下</p><p>例如，我在路由器上装了 ZeroTier，路由器挂了一个硬盘，而现在我在外边想要访问这个硬盘，那么只需要运行电脑上的 ZeroTier，就能通过 Samba、FTP 等方式访问硬盘，而且看起来就像我就在家里一样。</p><h2 id="基本原理介绍"><a href="#基本原理介绍" class="headerlink" title="基本原理介绍"></a>基本原理介绍</h2><p>说白了就是 P2P(Peer to Peer)，而且组织方式很像 DNS(关于 DNS 可以看<a target="_blank" rel="noopener" href="https://zhih.me/how-the-web-works/#DNS-%E6%9F%A5%E8%AF%A2">这里</a>)</p><p>根服务器 R 记录了路径信息，设备 A 能通过<strong>ZeroTier唯一地址标识</strong>找到需要连接的设备 B</p><p>这个过程如下：</p><ol><li>A 想要将数据包发送到 B，但由于它没有直接路径，因此将其向上发送到 R。</li><li>如果 R 有直接链接到 B，它会转发数据包给 B。否则它会继续向上游发送数据包，直到达到行星根(planet)。行星根知道所有节点，所以如果 B 在线，最终数据包将到达 B。</li><li>R 还向 A 发送一个名为<strong>会和</strong>的消息，包含有关它如何到达 B 的提示。同时，将<strong>会和</strong>发给 B，通知 B 它如何到达 A。</li><li>A 和 B 获取它们的会合消息并尝试相互发送测试消息，可能会对 NAT 或状态防火墙进行穿透。如果这样可以建立直接链路，则不再需要中继。</li><li>如果无法建立直接路径，则通信可以继续中继(速度慢)</li></ol><p>ZeroTier 官方搭建了一个行星根服务器叫做地球 Earth，行星根服务器唯一的且是免费的，它记录了所有的路径信息，一般情况下大家都直接用的这个。除此之外还有 12 个遍布全球的根服务器，这些是收费的服务。所以如果使用免费套餐，连接时的延迟可能会很高，另外由于 Earth 在国外，一些不确定因素可能会影响到使用。考虑到网络的不确定性，ZeroTier 能自己创建根服务器月球 Moons，这样就能在大局域网中得到更好的体验了。</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>ZeroTier 是跨平台的，能安装在几乎任何平台</p><p>Windows、macOS、Linux、iOS、Android、QNAP、Synology、西数 MyCloud NAS，下载地址：<a target="_blank" rel="noopener" href="https://www.zerotier.com/download.shtml">https://www.zerotier.com/download.shtml</a></p><p>路由器推荐安装 <a target="_blank" rel="noopener" href="https://zhih.me/tags/entware/">Entware</a> 后使用 <code>opkg install zerotier</code> 命令安装</p><h2 id="ZeroTier使用教程"><a href="#ZeroTier使用教程" class="headerlink" title="ZeroTier使用教程"></a>ZeroTier使用教程</h2><p>因为我们没有自己创建 Moons 服务器，现在就先使用 ZeroTier 提供的服务</p><h3 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h3><p>地址：<a target="_blank" rel="noopener" href="https://my.zerotier.com/">https://my.zerotier.com/</a></p><p><img src="https://www.jarods.org/wp-content/uploads/2019/10/create-account-2.jpg" alt="注册"></p><p>注册之后是这样的，保持默认就好，免费套餐能连接 100 个设备，一般人够用了</p><p><img src="https://www.jarods.org/wp-content/uploads/2019/10/account-2.jpg" alt="账户"></p><h3 id="创建网络"><a href="#创建网络" class="headerlink" title="创建网络"></a>创建网络</h3><p><img src="https://www.jarods.org/wp-content/uploads/2019/10/create-network-1.jpg" alt="创建网络"></p><p>创建一个新的网络之后，我们得到一个 Network ID，这个在后面的设备连接时需要用到，点击刚刚创建的网络我们可以设置更多选项</p><p><img src="https://www.jarods.org/wp-content/uploads/2019/10/network-setting.jpg" alt="网络设置"></p><p>默认的设置就可以用了，右边 IPv4 的设置就是分配设备内网 IP 网段，其他的设置可以在 Setting help 里看到说明，不了解的不建议乱设置，如果不小心把自己的网络暴露在外部，会相当危险</p><h3 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h3><p>直接在客户端输入刚才创建的 Network ID</p><p><strong>电脑</strong></p><p><img src="https://www.jarods.org/wp-content/uploads/2019/10/macos-join.jpg" alt="macOS"></p><p><strong>路由器</strong></p><p>我这里使用的是安装了 <a target="_blank" rel="noopener" href="https://zhih.me/tags/entware/">Entware</a> 的 LEDE</p><p># 启动<br>zerotier-one -d</p><p># 获取地址和服务状态<br>zerotier-cli status</p><p># 加入、离开、列出网络<br>zerotier-cli join # Network ID<br>zerotier-cli leave # Network ID<br>zerotier-cli listnetworks</p><h3 id="允许连接"><a href="#允许连接" class="headerlink" title="允许连接"></a>允许连接</h3><p>后台设置默认是需要 Auth 才能连接的，在客户端申请加入网络后，需要在后台允许一下</p><p><img src="https://www.jarods.org/wp-content/uploads/2019/10/members.jpg" alt="允许加入"></p><h3 id="测试连接"><a href="#测试连接" class="headerlink" title="测试连接"></a>测试连接</h3><p>为了测试不同网络访问，我添加了一台安卓手机，在移动网络下直接使用分配给路由器的 IP，连接了 ssh 和 <a target="_blank" rel="noopener" href="https://zhih.me/tags/onmp/">onmp</a> 创建的 PHP 探针页面，而且速度还算不错，宽带是电信的，手机是联通的，下文件时能有个 800k&#x2F;s，不知道瓶颈在哪</p><p><img src="https://www.jarods.org/wp-content/uploads/2019/10/android-test.jpg" alt="安卓"></p><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>目前 IPv6 还没得到普及，虽然我这里已经能有 IPv6 地址并且能 IPv6 站点了，奈何不是固定 IP，也不知道哪时才能人手一个固定 IP。就目前情况来看，使用 ZeroTier 来做内网穿透还是不错的，使用门槛较低，可用性也还行，值得一试。</p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://jarod.vip/2019/10/20/syncthing%E5%B0%B1%E6%98%AF%E6%88%91%E8%A6%81%E7%9A%84%E5%90%8C%E6%AD%A5%E5%A4%87%E4%BB%BD%E8%BD%AF%E4%BB%B6/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Jarod"><meta itemprop="description" content="记录生活中的点点滴滴"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jarod's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2019/10/20/syncthing%E5%B0%B1%E6%98%AF%E6%88%91%E8%A6%81%E7%9A%84%E5%90%8C%E6%AD%A5%E5%A4%87%E4%BB%BD%E8%BD%AF%E4%BB%B6/" class="post-title-link" itemprop="url">Syncthing就是我要的同步备份软件</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-10-20 01:36:54" itemprop="dateCreated datePublished" datetime="2019-10-20T01:36:54+08:00">2019-10-20</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-09-29 21:27:46" itemprop="dateModified" datetime="2022-09-29T21:27:46+08:00">2022-09-29</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Mac/" itemprop="url" rel="index"><span itemprop="name">Mac</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Linux教程</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>4.1k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>4 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>数据无价，平时不注意备份，电脑突然翻车就追悔莫及啦。</p><p>最开始的时候，我在路由器上开启 Samba，每次编辑完项目就手动拷贝到路由器硬盘里，麻烦程度可想而知，后来又用了 Google Drive&#x2F;One Drive，又因为它们的网络不理想，就又放弃使用了。</p><p>其实就是很简单的需求，自动备份、速度快，然后去找了一下，发现一堆人推荐用 Rsync，这货我只在 VPS 上用过，拿来做镜像同步，但是要做实时同步，不好配置。</p><p>我就想，这需求应该有一大堆人有吧，就去 github 搜索 sync，发现 Syncthing 这么个好东西，截止 2018-06-13 已经得到 20k+ 的 star，并且更新很活跃</p><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p><img src="https://www.jarods.org/wp-content/uploads/2019/10/logo.jpg" alt="logo"></p><p>Syncthing 是一个文件连续同步软件</p><p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/syncthing/syncthing">https://github.com/syncthing/syncthing</a></p><p>它有以下特性：</p><ul><li>跨平台<ul><li>使用 Golang 开发，几乎能在所有平台上使用，包括常见的安卓手机和路由器平台</li></ul></li><li>易于使用<ul><li>只需要下载运行，打开浏览设置本地目录和远程主机，其他的不需要管</li></ul></li><li>安全<ul><li>管理页可以设置密码，可以设置 https，设置备份需要两边都确认，使用唯一设备标识进行确认</li></ul></li></ul><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>Syncthing 有多种安装方式</p><p>有一定 Linux 基础的人，可以使用下面的配置来设置启动服务</p><ul><li><a target="_blank" rel="noopener" href="https://github.com/syncthing/syncthing/tree/master/etc">https://github.com/syncthing/syncthing/tree/master/etc</a></li></ul><p>Windows，Mac，Linux 和安卓手机可以在这里下载有 GUI 界面的程序使用</p><ul><li><a target="_blank" rel="noopener" href="https://docs.syncthing.net/users/contrib.html#gui-wrappers">https://docs.syncthing.net/users/contrib.html#gui-wrappers</a></li></ul><p>其他方法可以自己决定，我是直接下载安装包命令行启动的</p><h3 id="在-macOS-上安装"><a href="#在-macOS-上安装" class="headerlink" title="在 macOS 上安装"></a>在 macOS 上安装</h3><p>我用的是 macOS，可以直接使用 homebrew 安装启动，并且可以开机自动启动，你也可以到这里 <a target="_blank" rel="noopener" href="https://github.com/sieren/QSyncthingTray/releases">QSyncthingTray</a> 下载 macOS 的 GUI 版</p><p>brew install syncthing</p><p>启动服务（同时设置开机启动）</p><p>brew services start syncthing</p><p>停止服务（同时关闭自启）</p><p>brew services stop syncthing</p><p>手动启动（不会开机自启）</p><p>syncthing</p><p>启动进程后，可以用浏览器打开 <code>http://localhost:8384/</code> 来查看 web 管理页</p><h3 id="在-Windows-上安装"><a href="#在-Windows-上安装" class="headerlink" title="在 Windows 上安装"></a>在 Windows 上安装</h3><p>Windows 直接在这里 <a target="_blank" rel="noopener" href="https://github.com/canton7/SyncTrayzor/releases">SyncTrayzor</a> 下载软件运行</p><h3 id="在-Linux-VPS-上安装"><a href="#在-Linux-VPS-上安装" class="headerlink" title="在 Linux VPS 上安装"></a>在 Linux VPS 上安装</h3><p>大多数发行版和不同 CPU 平台的安装包，可以在这里 <a target="_blank" rel="noopener" href="https://github.com/syncthing/syncthing/releases">Syncthing</a> 找到，把它下载到你想要放在的目录然后设置权限，使用命令运行</p><p>文章开头有 GUI 版本的链接，不过我要装在没有 GUI 的 VPS 上，所以直接用命令行运行，系统用的是 Debian 9，然后用 supervisor 进程守护来启动的</p><p>碰巧前几天之前的一个客户，他的 VPS 做迁移，阿里云送了张代金券，然后客户就送给我了</p><p><img src="https://www.jarods.org/wp-content/uploads/2019/10/aff.jpg" alt="aff"></p><p>然后续费 9 个月的阿里云学生机，美滋滋?</p><p>虽然带宽比较低，但是对于这种连续同步的备份来说，在第一次备份之后，后面都是增量备份了，除非你都是备份大文件，要不对带宽的要求不是很高，另外 40G 的盘，完全够我备份用了，阿里云最主要就是稳定，很适合做我的备份机</p><h4 id="下载-Syncthing"><a href="#下载-Syncthing" class="headerlink" title="下载 Syncthing"></a>下载 Syncthing</h4><p>下载最新的包，解压，移动到 <code>/bin/</code> 里，改权限</p><p>wget <a target="_blank" rel="noopener" href="https://github.com/syncthing/syncthing/releases/download/v0.14.49-rc.1/syncthing-linux-amd64-v0.14.49-rc.1.tar.gz">https://github.com/syncthing/syncthing/releases/download/v0.14.49-rc.1/syncthing-linux-amd64-v0.14.49-rc.1.tar.gz</a></p><p>tar xzvf .&#x2F;syncthing-linux-amd64-v0.14.49-rc.1.tar.gz</p><p>mv .&#x2F;syncthing-linux-amd64-v0.14.49-rc.1&#x2F;syncthing &#x2F;bin&#x2F;</p><p>chmod +x &#x2F;bin&#x2F;syncthing</p><h4 id="进程守护"><a href="#进程守护" class="headerlink" title="进程守护"></a>进程守护</h4><p>安装 supervisor</p><p>apt-get install supervisor</p><p>配置守护</p><p>vi &#x2F;etc&#x2F;supervisor&#x2F;conf.d&#x2F;syncthing.conf</p><p>填入以下内容</p><p>[program:syncthing]<br>command &#x3D; &#x2F;bin&#x2F;syncthing -no-browser -home=“&#x2F;root&#x2F;.config&#x2F;syncthing”<br>directory &#x3D; &#x2F;root<br>autorestart &#x3D; True<br>user &#x3D; root<br>environment &#x3D; STNORESTART=“1”, HOME=“&#x2F;root”</p><p><strong>注意</strong>，我例子里使用的是 root 用户，所以响应的目录是 <code>/root</code>，你要是使用其他用户，应该是 <code>/home/用户名</code>，就是你登录时默认所在的目录</p><p>现在就可以使用 <code>supervisorctl</code> 命令来管理进程了</p><ul><li>启动</li></ul><p>supervisorctl start syncthing</p><ul><li>重启</li></ul><p>supervisorctl restart syncthing</p><ul><li>停止</li></ul><p>supervisorctl stop syncthing</p><p>启动进程后，可以用浏览器打开 <code>http://你的IP:8384/</code> 来查看 web 管理页</p><p>如果无法打开页面，需要修改 <code>/.config/syncthing/config.xml</code> 里的 <code>127.0.0.1:8384</code> 字段为 <code>0.0.0.0:8384</code>，或者你可以和我一样使用 nginx 做反向代理，前提是你知道怎么做</p><h3 id="在路由器上安装"><a href="#在路由器上安装" class="headerlink" title="在路由器上安装"></a>在路由器上安装</h3><p>目前 <a target="_blank" rel="noopener" href="https://entware.net/">Entware</a> 源里已经有这个包了，但是我发现它是个旧版本，并且有问题，所以这里我选择手动安装</p><p>这里的例子是 LEDE x64 但是也适合一切安装了 Entware 的路由器</p><p>在这里 <a target="_blank" rel="noopener" href="https://github.com/syncthing/syncthing/releases">Syncthing</a> 下载对应 CPU 平台的安装包，可以用 <code>uname -m</code> 查看，我这里是 x86_64 所以选择 amd64</p><h4 id="下载-syncthing"><a href="#下载-syncthing" class="headerlink" title="下载 syncthing"></a>下载 syncthing</h4><p>下载最新的包，解压，移动到 <code>/opt/bin/</code> 里，改权限</p><p>wget <a target="_blank" rel="noopener" href="https://github.com/syncthing/syncthing/releases/download/v0.14.49-rc.1/syncthing-linux-amd64-v0.14.49-rc.1.tar.gz">https://github.com/syncthing/syncthing/releases/download/v0.14.49-rc.1/syncthing-linux-amd64-v0.14.49-rc.1.tar.gz</a></p><p>tar xzvf .&#x2F;syncthing-linux-amd64-v0.14.49-rc.1.tar.gz</p><p>mv .&#x2F;syncthing-linux-amd64-v0.14.49-rc.1&#x2F;syncthing &#x2F;opt&#x2F;bin&#x2F;</p><p>chmod +x &#x2F;opt&#x2F;bin&#x2F;syncthing</p><h4 id="添加启动命令"><a href="#添加启动命令" class="headerlink" title="添加启动命令"></a>添加启动命令</h4><p>创建并编辑 <code>/opt/etc/init.d/S92syncthing</code></p><p>vi &#x2F;opt&#x2F;etc&#x2F;init.d&#x2F;S92syncthing</p><p>在里面填上下面所有字段</p><p>#!&#x2F;bin&#x2F;sh<br>ENABLED&#x3D;yes<br>PROCS&#x3D;syncthing<br>ARGS&#x3D;”-home&#x3D;&#x2F;opt&#x2F;etc&#x2F;syncthing”<br>PREARGS&#x3D;””<br>DESC&#x3D;$PROCS<br>PATH&#x3D;&#x2F;opt&#x2F;sbin:&#x2F;opt&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin:&#x2F;sbin:&#x2F;bin</p><p>if [ ! -d &#x2F;opt&#x2F;etc&#x2F;syncthing ]; then<br>&#x2F;opt&#x2F;bin&#x2F;syncthing -generate&#x3D;”&#x2F;opt&#x2F;etc&#x2F;syncthing”<br>sed -i ‘s127.0.0.1:83840.0.0.0:8384’ &#x2F;opt&#x2F;etc&#x2F;syncthing&#x2F;config.xml<br>elif [[ -f &#x2F;opt&#x2F;etc&#x2F;syncthing&#x2F;config.xml -a “127.0.0.1:8384”=&#x3D;”127.0.0.1:8384” ]]; then<br>sed -i ‘s127.0.0.1:83840.0.0.0:8384’ &#x2F;opt&#x2F;etc&#x2F;syncthing&#x2F;config.xml<br>fi</p><p>. &#x2F;opt&#x2F;etc&#x2F;init.d&#x2F;rc.func</p><p>然后给权限</p><p>chmod +x &#x2F;opt&#x2F;etc&#x2F;init.d&#x2F;S92syncthing</p><p>用法: &#x2F;opt&#x2F;etc&#x2F;init.d&#x2F;S92syncthing (startstoprestartcheck)</p><p>启动服务就能在浏览器打开 <code>路由器IP:8384</code> 例如 <code>192.168.1.1:8384</code> 打开管理页了</p><h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><p>易于使用是 Syncthing 的一个重要特性，打开管理页，一目了然</p><p>首次打开管理页，所有平台上都是一样的</p><p><img src="https://www.jarods.org/wp-content/uploads/2019/10/syncthing.jpg" alt="syncthing"></p><p>然后你需要做的就是</p><h3 id="设置用户名、密码"><a href="#设置用户名、密码" class="headerlink" title="设置用户名、密码"></a>设置用户名、密码</h3><p><img src="https://www.jarods.org/wp-content/uploads/2019/10/setpass.jpg" alt="setpass"></p><h3 id="设置文件夹"><a href="#设置文件夹" class="headerlink" title="设置文件夹"></a>设置文件夹</h3><p>删除默认的同步文件夹，添加新同步文件夹</p><p><img src="https://www.jarods.org/wp-content/uploads/2019/10/addlocal.jpg" alt="addlocal"></p><h3 id="添加远程设备"><a href="#添加远程设备" class="headerlink" title="添加远程设备"></a>添加远程设备</h3><p><img src="https://www.jarods.org/wp-content/uploads/2019/10/addremote.jpg" alt="addremote"></p><p>然后稍微等一分钟，两边就能连接上了</p><p>最终效果</p><p><img src="https://www.jarods.org/wp-content/uploads/2019/10/end.jpg" alt="end"></p><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>Syncthing 作为一款跨平台同步软件，它简单易用、功能完善强大，具有很高的稳定性，很容易让人想出各种使用场景，而且它还是开源的，感谢那上百位贡献者</p><p>本文简单介绍了初级使用方法，还未提及其他的诸如版本控制等功能，其他功能应用，如果以后我觉得值得一说，再更新了</p><blockquote><p>本文章发表于底噪博客 <a target="_blank" rel="noopener" href="https://zhih.me/">https://zhih.me</a> , 转载请注明</p></blockquote></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://jarod.vip/2019/10/20/%E7%BC%96%E8%AF%91nginx%E6%94%AF%E6%8C%81tls1-3/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Jarod"><meta itemprop="description" content="记录生活中的点点滴滴"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jarod's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2019/10/20/%E7%BC%96%E8%AF%91nginx%E6%94%AF%E6%8C%81tls1-3/" class="post-title-link" itemprop="url">编译Nginx支持TLS1.3</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-10-20 01:31:02" itemprop="dateCreated datePublished" datetime="2019-10-20T01:31:02+08:00">2019-10-20</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-09-29 21:27:46" itemprop="dateModified" datetime="2022-09-29T21:27:46+08:00">2022-09-29</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Linux教程</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>8.5k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>8 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>TLS1.2 发布于 2008 年 8 月，至今正好有 10 年，随着互联网安全越来越受到重视，新协议 TLS1.3 呼之欲出。值得一提的是，从第一份草案编写至今，已经有几年时间了，截止这篇文章编写，已经是第 28 份草案。在最近的 Chrome 版本更新中也逐步对 TLS1.3 进行支持，Chrome 65 开始默认开启 draft 23、Chrome 68 开始支持 draft 28</p><blockquote><p>更新：TLS 1.3 标准已于 2018 年 8 月正式发布为 <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc8446">RFC 8446</a> ，距 TLS1.2 发布正好 10 周年</p></blockquote><p>TLS1.3 对于 TLS1.2 有重大改写，既提高了安全性又提高了速度，以至于有争议称，应该把它叫做 TLS2.0</p><p>关于 TLS1.3 的科普可以看下面的页面</p><p><a target="_blank" rel="noopener" href="https://wiki.openssl.org/index.php/TLS1.3">https://wiki.openssl.org/index.php/TLS1.3</a> <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/28850798">https://zhuanlan.zhihu.com/p/28850798</a></p><p>之前我也写过 Nginx 的 https 的配置 <a target="_blank" rel="noopener" href="https://zhih.me/nginx-http2-https/">https://zhih.me/nginx-http2-https/</a> ，当时是使用 TLS1.2 的</p><p>碰巧前几天发现 <code>.ooo</code> 可以免费用 1 年，就撸了一个 <code>onmp.ooo</code> 来做为我 onmp 项目的页面，把它搭在 4 刀年付的 virmach 上，顺便测试 TLS1.3</p><h2 id="一键安装"><a href="#一键安装" class="headerlink" title="一键安装"></a>一键安装</h2><p>最近更新支持防火墙功能，详情可以看 <a target="_blank" rel="noopener" href="https://zhih.me/ngx-lua-waf/">https://zhih.me/ngx-lua-waf/</a></p><p>sh -c “$(curl -kfsSl <a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/xzhih/nginx-compile/master/install.sh)&quot;">https://raw.githubusercontent.com/xzhih/nginx-compile/master/install.sh)&quot;</a></p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>我这里用的系统是 Debian 8</p><h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><p>apt-get install git gcc make build-essential -y</p><h3 id="下载源码"><a href="#下载源码" class="headerlink" title="下载源码"></a>下载源码</h3><p>我们把源码全都放在一个地方，方便使用，创建 nginx 的运行用户 www-data</p><p>rm -rf &#x2F;usr&#x2F;src&#x2F;<br>mkdir -p &#x2F;usr&#x2F;src&#x2F;<br>mkdir -p &#x2F;var&#x2F;log&#x2F;nginx&#x2F;<br>useradd -s &#x2F;sbin&#x2F;nologin -M www-data</p><p><strong>克隆 OpenSSL</strong></p><p>这里用的是 1.1.1 稳定版的源码</p><p>cd &#x2F;usr&#x2F;src<br>wget <a target="_blank" rel="noopener" href="https://github.com/openssl/openssl/archive/OpenSSL/_1/_1/_1.tar.gz">https://github.com/openssl/openssl/archive/OpenSSL\_1\_1\_1.tar.gz</a><br>tar xzvf OpenSSL_1_1_1.tar.gz<br>mv openssl-OpenSSL_1_1_1 openssl</p><p><strong>下载 Nginx 的源码</strong></p><p>cd &#x2F;usr&#x2F;src&#x2F;<br>wget <a target="_blank" rel="noopener" href="https://nginx.org/download/nginx-1.15.6.tar.gz">https://nginx.org/download/nginx-1.15.6.tar.gz</a><br>tar zxf .&#x2F;nginx-1.15.6.tar.gz<br>mv nginx-1.15.6 nginx</p><p><strong>克隆 zlib</strong></p><p>开启 gzip 要用到 zlib 库，这里使用的是 Cloudflare 优化的版本，比原版具有更高的压缩性能</p><p>cd &#x2F;usr&#x2F;src&#x2F;<br>git clone <a target="_blank" rel="noopener" href="https://github.com/cloudflare/zlib.git">https://github.com/cloudflare/zlib.git</a> zlib<br>cd zlib<br>make -f Makefile.in distclean</p><p><strong>克隆 Brotli</strong></p><p>就像 gzip 一样，Brotli 也是一种压缩算法，它是由谷歌开发的一个更适合文本压缩的算法，因为它使用了字典，所以有更好的压缩比。</p><p>现在主流浏览器都已经支持 Brotli 了，而且也能与 gzip 共存，如果浏览器支持 Brotli 就会优先使用，所以可以放心兼容性，可以在这里看到支持的数据 <a target="_blank" rel="noopener" href="https://caniuse.com/#search=Brotli">https://caniuse.com/#search=Brotli</a></p><p>cd &#x2F;usr&#x2F;src&#x2F;<br>git clone –recursive <a target="_blank" rel="noopener" href="https://github.com/google/ngx/_brotli.git">https://github.com/google/ngx\_brotli.git</a></p><p>我给 nginx 默认配置的 Brotli 压缩等级为 6 级，这对于动态内容比较友好，如果你是像我现在这个博客一样是静态化的，那么建议开启 11 级压缩，这样可以获得最好的体验</p><p><strong>下载 PCRE</strong></p><p>nginx rewrite 模块需要 pcre 库</p><p>cd &#x2F;usr&#x2F;src&#x2F;<br>wget <a target="_blank" rel="noopener" href="https://ftp.pcre.org/pub/pcre/pcre-8.42.tar.gz">https://ftp.pcre.org/pub/pcre/pcre-8.42.tar.gz</a><br>tar zxf .&#x2F;pcre-8.42.tar.gz</p><h3 id="给-OpenSSL-打补丁"><a href="#给-OpenSSL-打补丁" class="headerlink" title="给 OpenSSL 打补丁"></a>给 OpenSSL 打补丁</h3><p>补丁来自：<a target="_blank" rel="noopener" href="https://github.com/hakasenyang/openssl-patch">https://github.com/hakasenyang/openssl-patch</a></p><p>此补丁的目的是让 OpenSSL 支持 TLS1.3 的 23,26,28 草案，以及 Final 版标准</p><p>cd &#x2F;usr&#x2F;src&#x2F;<br>git clone <a target="_blank" rel="noopener" href="https://github.com/hakasenyang/openssl-patch.git">https://github.com/hakasenyang/openssl-patch.git</a><br>cd &#x2F;usr&#x2F;src&#x2F;openssl<br>patch -p1 &lt; ..&#x2F;openssl-patch&#x2F;openssl-equal-1.1.1_ciphers.patch<br>patch -p1 &lt; ..&#x2F;openssl-patch&#x2F;openssl-1.1.1-chacha_draft.patch</p><h3 id="给-Nginx-打补丁"><a href="#给-Nginx-打补丁" class="headerlink" title="给 Nginx 打补丁"></a>给 Nginx 打补丁</h3><p>补丁来自：<a target="_blank" rel="noopener" href="https://github.com/kn007/patch">https://github.com/kn007/patch</a></p><p>nginx 补丁</p><ul><li>添加SPDY支持。</li><li>添加HTTP2 HPACK编码支持。</li><li>添加动态TLS记录支持。</li></ul><p>nginx_auto_using_PRIORITIZE_CHACHA 补丁</p><ul><li>支持时使用 SSL_OP_PRIORITIZE_CHACHA</li></ul><p>cd &#x2F;usr&#x2F;src&#x2F;<br>git clone <a target="_blank" rel="noopener" href="https://github.com/kn007/patch.git">https://github.com/kn007/patch.git</a> nginx-patch<br>cd &#x2F;usr&#x2F;src&#x2F;nginx<br>patch -p1 &lt; ..&#x2F;nginx-patch&#x2F;nginx.patch<br>patch -p1 &lt; ..&#x2F;nginx-patch&#x2F;nginx_auto_using_PRIORITIZE_CHACHA.patch</p><h3 id="使用-jemalloc-作为内存管理"><a href="#使用-jemalloc-作为内存管理" class="headerlink" title="使用 jemalloc 作为内存管理"></a>使用 jemalloc 作为内存管理</h3><p>cd &#x2F;usr&#x2F;src&#x2F;<br>wget <a target="_blank" rel="noopener" href="https://github.com/jemalloc/jemalloc/releases/download/5.1.0/jemalloc-5.1.0.tar.bz2">https://github.com/jemalloc/jemalloc/releases/download/5.1.0/jemalloc-5.1.0.tar.bz2</a><br>tar xjvf jemalloc-5.1.0.tar.bz2<br>cd jemalloc-5.1.0<br>.&#x2F;configure<br>make &amp;&amp; make install<br>echo ‘&#x2F;usr&#x2F;local&#x2F;lib’ &gt;&gt; &#x2F;etc&#x2F;ld.so.conf.d&#x2F;local.conf<br>ldconfig</p><h3 id="其他编译配置"><a href="#其他编译配置" class="headerlink" title="其他编译配置"></a>其他编译配置</h3><p>Nginx 默认会以 debug 模式编译，我们需要注释掉 <code>/usr/src/nginx/auto/cc/gcc</code> 中 <code>CFLAGS=&quot;$CFLAGS -g&quot;</code> 这行，这样可以减少生成文件的大小</p><p>sed -i ‘s@CFLAGS&#x3D;”$CFLAGS -g”@#CFLAGS&#x3D;”$CFLAGS -g”@’ &#x2F;usr&#x2F;src&#x2F;nginx&#x2F;auto&#x2F;cc&#x2F;gcc</p><h3 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h3><p>cd &#x2F;usr&#x2F;src&#x2F;nginx<br>.&#x2F;configure \<br>--user&#x3D;www-data –group&#x3D;www-data \<br>--prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx \<br>--sbin-path&#x3D;&#x2F;usr&#x2F;sbin&#x2F;nginx \<br>--with-compat –with-file-aio –with-threads \<br>--with-http_v2_module –with-http_v2_hpack_enc \<br>--with-http_spdy_module –with-http_realip_module \<br>--with-http_flv_module –with-http_mp4_module \<br>--with-openssl&#x3D;..&#x2F;openssl –with-http_ssl_module \<br>--with-pcre&#x3D;..&#x2F;pcre-8.42 –with-pcre-jit \<br>--with-zlib&#x3D;..&#x2F;zlib –with-http_gzip_static_module \<br>--add-module&#x3D;..&#x2F;ngx_brotli \<br>--with-ld-opt&#x3D;-ljemalloc</p><p>make<br>make install</p><p>Nginx 的可执行文件安装在 <code>/usr/sbin/nginx</code> ，Nginx 配置在 <code>/usr/local/nginx/conf/</code> 里</p><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>Nginx 已经安装上了，现在我们来配置网站，让它跑起来</p><h3 id="Nginx-全局配置"><a href="#Nginx-全局配置" class="headerlink" title="Nginx 全局配置"></a>Nginx 全局配置</h3><p>把以下内容覆盖填入 <code>/usr/local/nginx/conf/nginx.conf</code></p><p>user www-data;<br>pid &#x2F;var&#x2F;run&#x2F;nginx.pid;<br>worker_processes auto;<br>worker_rlimit_nofile 65535;</p><p>events {<br>use epoll;<br>multi_accept on;<br>worker_connections 65535;<br>}</p><p>http {<br>charset utf-8;<br>sendfile on;<br>aio threads;<br>directio 512k;<br>tcp_nopush on;<br>tcp_nodelay on;<br>server_tokens off;<br>log_not_found off;<br>types_hash_max_size 2048;<br>client_max_body_size 16M;</p><p># MIME<br>include mime.types;<br>default_type application&#x2F;octet-stream;</p><p># Logging<br>access_log &#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log;<br>error_log &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log warn;</p><p># Gzip<br>gzip on;<br>gzip_vary on;<br>gzip_proxied any;<br>gzip_comp_level 6;<br>gzip_types text&#x2F;plain text&#x2F;css text&#x2F;xml application&#x2F;json application&#x2F;javascript application&#x2F;xml+rss application&#x2F;atom+xml image&#x2F;svg+xml;<br>gzip_disable “MSIE [1-6]\.(?!.*SV1)”;</p><p># Brotli<br>brotli on;<br>brotli_comp_level 6;<br>brotli_static on;<br>brotli_types text&#x2F;plain text&#x2F;css text&#x2F;xml application&#x2F;json application&#x2F;javascript application&#x2F;xml+rss application&#x2F;atom+xml image&#x2F;svg+xml;</p><p>include vhost&#x2F;*.conf;<br>}</p><h3 id="Nginx-站点配置"><a href="#Nginx-站点配置" class="headerlink" title="Nginx 站点配置"></a>Nginx 站点配置</h3><p>我们已经在全局配置里设置了包含 <code>/usr/local/nginx/conf/vhost/</code> 目录下的 conf 文件</p><p>mkdir -p &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;vhost&#x2F;</p><p>然后在 <code>/usr/local/nginx/conf/vhost/</code> 里创建站点配置，比如我的是 <code>onmp.ooo.conf</code></p><p>server {<br>listen 80;<br>server_name onmp.ooo;<br>root &#x2F;wwwroot&#x2F;onmp.ooo;<br>location &#x2F; {<br>index index.html;<br>}<br>}</p><p>这样 HTTP 的站点配置就弄好了，不过还站点还没页面，我们把 Nginx 的欢迎也面给放进去</p><p>mkdir -p &#x2F;wwwroot<br>cp -r &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;html &#x2F;wwwroot&#x2F;onmp.ooo</p><p># 配置站点目录权限<br>chown -R www-data:www-data &#x2F;wwwroot&#x2F;<br>find &#x2F;wwwroot&#x2F; -type d -exec chmod 755 {} \;<br>find &#x2F;wwwroot&#x2F; -type f -exec chmod 644 {} \;</p><h3 id="service-配置"><a href="#service-配置" class="headerlink" title="service 配置"></a>service 配置</h3><p>service 命令用于对系统服务进行管理，比如启动（start）、停止（stop）、重启（restart）、查看状态（status）等，我们是编译安装的，所以要手动创建服务文件。</p><p>mkdir -p &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;</p><p>编辑 <code>/usr/lib/systemd/system/nginx.service</code> 写入以下内容</p><p>[Unit]<br>Description=nginx - high performance web server<br>After=network.target</p><p>[Service]<br>Type=forking<br>PIDFile=&#x2F;var&#x2F;run&#x2F;nginx.pid<br>ExecStartPost=&#x2F;bin&#x2F;sleep 0.1<br>ExecStartPre=&#x2F;usr&#x2F;sbin&#x2F;nginx -t -c &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf<br>ExecStart=&#x2F;usr&#x2F;sbin&#x2F;nginx -c &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf<br>ExecReload=&#x2F;usr&#x2F;sbin&#x2F;nginx -s reload<br>ExecStop=&#x2F;usr&#x2F;sbin&#x2F;nginx -s stop</p><p>[Install]<br>WantedBy=multi-user.target</p><p>启动服务</p><p>systemctl daemon-reload #重载<br>systemctl enable nginx #开机启动<br>systemctl start nginx #运行</p><p>我们现在可以用 <code>service</code> 或 <code>systemctl</code> 管理 nginx 了</p><p>启动 Nginx 后 HTTP 页面就正常了，打开 onmp.ooo 就能看到 Welcome to nginx!</p><h3 id="签发证书"><a href="#签发证书" class="headerlink" title="签发证书"></a>签发证书</h3><p>配置 HTTPS 首先要有证书，我这里是使用 <a target="_blank" rel="noopener" href="https://github.com/Neilpang/acme.sh">acme.sh</a> 自动颁发 Let’s Encrypt 的证书</p><p>具体使用教程看我的另一篇教程 <a target="_blank" rel="noopener" href="https://zhih.me/acme-sh-guide/">使用acme.sh获取免费SSL证书</a></p><p>当然，你要是已经有了 SSL 证书，直接看下面配置文件里证书存放的目录，直接放到里面去就行，其他操作一样的</p><h3 id="HTTPS-站点配置"><a href="#HTTPS-站点配置" class="headerlink" title="HTTPS 站点配置"></a>HTTPS 站点配置</h3><p>因为我给 OpenSSL 打的是 equal-1.1.1_ciphers 补丁，所以 ssl_ciphers 配置文件如下，如果你打的是别的补丁，则需要查看 <a target="_blank" rel="noopener" href="https://github.com/hakasenyang/openssl-patch">https://github.com/hakasenyang/openssl-patch</a> 给的配置</p><p>server {<br>listen 80;<br>server_name onmp.ooo;<br>return 301 <a target="_blank" rel="noopener" href="https://onmp.ooo$request/_uri">https://onmp.ooo$request\_uri</a>;<br>}</p><p>server {<br>listen 443 ssl http2;<br>server_name onmp.ooo;<br>root &#x2F;wwwroot&#x2F;onmp.ooo;</p><p># SSL<br>ssl_certificate &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;ssl&#x2F;onmp.ooo.cer;<br>ssl_certificate_key &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;ssl&#x2F;onmp.ooo.key;</p><p>ssl_protocols TLSv1.2 TLSv1.3;<br>ssl_ciphers ‘[TLS13+AESGCM+AES128TLS13+AESGCM+AES256TLS13+CHACHA20]:[EECDH+ECDSA+AESGCM+AES128EECDH+ECDSA+CHACHA20]:EECDH+ECDSA+AESGCM+AES256:EECDH+ECDSA+AES128+SHA:EECDH+ECDSA+AES256+SHA:[EECDH+aRSA+AESGCM+AES128EECDH+aRSA+CHACHA20]:EECDH+aRSA+AESGCM+AES256:EECDH+aRSA+AES128+SHA:EECDH+aRSA+AES256+SHA:RSA+AES128+SHA:RSA+AES256+SHA:RSA+3DES’;<br>ssl_ecdh_curve X25519:P-256:P-384;<br>ssl_prefer_server_ciphers on;</p><p>ssl_session_cache shared:SSL:50m;<br>ssl_session_timeout 1d;<br>ssl_session_tickets on;</p><p># OCSP Stapling<br>ssl_stapling on;<br>ssl_stapling_verify on;<br>resolver 119.29.29.29 8.8.8.8 valid&#x3D;300s;<br>resolver_timeout 10s;</p><p># Security headers<br>add_header X-Frame-Options “SAMEORIGIN” always;<br>add_header X-XSS-Protection “1; mode&#x3D;block” always;<br>add_header X-Content-Type-Options “nosniff” always;<br>add_header Referrer-Policy “no-referrer-when-downgrade” always;<br>add_header Strict-Transport-Security “max-age&#x3D;31536000; includeSubDomains; preload” always;</p><p>location &#x2F; {<br>index index.html;<br>http2_push &#x2F;style.css;<br>}</p><p>location ~ .*\.(gifjpgjpegpngbmpswfico)$ {<br>expires 30d;<br>}</p><p>location ~ .*\.(jscss)?$ {<br>expires 15d;<br>}<br>}</p><p>以上就是完整的站点配置文件，覆盖 <code>/usr/local/nginx/conf/vhost/onmp.ooo.conf</code> 后，使用 <code>service nginx reload</code> 重载 Nginx 再打开站点就能看到 HTTPS 的页面了</p><h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><p>在 Chrome 65 或更新的版本中，打开开发者工具的 Security 菜单，就能在里面看到 站点是否以 TLS1.3 连接</p><p><img src="https://www.jarods.org/wp-content/uploads/2019/10/chrome.jpg" alt="chrome"></p><p>或者可以到 SSL Server Test：<a target="_blank" rel="noopener" href="https://www.ssllabs.com/ssltest/index.html">https://www.ssllabs.com/ssltest/index.html</a> 进行测试</p><p><img src="https://www.jarods.org/wp-content/uploads/2019/10/ssllabs.jpg" alt="ssllabs"></p><p>我只开启了 TLSv1.2 TLSv1.3 的支持，如果需要，你可以自己增加其他协议的支持</p><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>人们的生活已经离不开网络，所以网络安全在现在和未来都至关重要，曾经很多站长都以 HTTPS 影响站点速度为由，又或者说 SSL 证书昂贵，拒绝配 HTTPS，而随着技术的迭代升级，配置 HTTPS+HTTPS2 能提高网站速度，而 SSL 不仅可以免费获取，还可以使用命令自动获取自动更新，在我看来已经没有理由不配置 HTTPS 了，所以希望各位站长，都赶紧上车吧</p><blockquote><p>本文章发表于底噪博客 <a target="_blank" rel="noopener" href="https://zhih.me/">https://zhih.me</a> , 转载请注明</p></blockquote></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://jarod.vip/2019/10/20/%E5%80%9F%E5%8A%A9mkcert%E7%AD%BE%E5%8F%91%E6%9C%AC%E5%9C%B0%E8%AF%81%E4%B9%A6/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Jarod"><meta itemprop="description" content="记录生活中的点点滴滴"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jarod's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2019/10/20/%E5%80%9F%E5%8A%A9mkcert%E7%AD%BE%E5%8F%91%E6%9C%AC%E5%9C%B0%E8%AF%81%E4%B9%A6/" class="post-title-link" itemprop="url">借助mkcert签发本地证书</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-10-20 01:24:08" itemprop="dateCreated datePublished" datetime="2019-10-20T01:24:08+08:00">2019-10-20</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-09-29 21:27:46" itemprop="dateModified" datetime="2022-09-29T21:27:46+08:00">2022-09-29</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Linux教程</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>3.9k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>4 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><p><a target="_blank" rel="noopener" href="https://github.com/FiloSottile/mkcert">mkcert</a> 是由 <a target="_blank" rel="noopener" href="https://blog.filippo.io/hi/">Filippo Valsorda</a> 使用<code>go</code>语言开源的一款零配置搭建本地证书服务的工具，它可以兼容<code>Window, Linux, macOS</code>等多种开发平台，省去了我们自签本地证书的繁琐步骤，从而让我们专注于开发。</p><p><img src="https://www.jarods.org/wp-content/uploads/2019/10/51066373-96d4aa80-15be-11e9-91e2-f4e44a3a4458.png"></p><h2 id="1-安装mkcert"><a href="#1-安装mkcert" class="headerlink" title="1. 安装mkcert"></a>1. 安装mkcert</h2><h3 id="1-1-Windows"><a href="#1-1-Windows" class="headerlink" title="1.1 Windows"></a>1.1 Windows</h3><p>在<code>Windows</code>环境下，推荐使用<code>Chocolatey</code>包管理工具安装<code>mkcert</code>，你可以选择使用<code>cmd</code>或<code>power shell</code>安装<code>Chocolatey</code>：</p><p>以管理员权限打开<code>cmd</code>窗口，输入以下命令进行安装</p><p>1</p><p>@”%SystemRoot%\System32\WindowsPowerShell\v1.0\powershell.exe” -NoProfile -InputFormat None -ExecutionPolicy Bypass -Command “iex ((New-Object System.Net.WebClient).DownloadString(‘<a target="_blank" rel="noopener" href="https://chocolatey.org/install.ps1&#39;))&quot;">https://chocolatey.org/install.ps1&#39;))&quot;</a> &amp;&amp; SET “PATH&#x3D;%PATH%;%ALLUSERSPROFILE%\chocolatey\bin”</p><p>以管理员权限打开<code>power shell</code>窗口，输入以下命令进行安装</p><p>1</p><p>Set-ExecutionPolicy Bypass -Scope Process -Force; iex ((New-Object System.Net.WebClient).DownloadString(‘<a target="_blank" rel="noopener" href="https://chocolatey.org/install.ps1&#39;">https://chocolatey.org/install.ps1&#39;</a>))</p><p><code>Chocolatey</code>安装完成之后，命令行窗口输入以下命令安装<code>mkcert</code></p><p>1</p><p>choco install mkcert</p><h3 id="1-2-Linux"><a href="#1-2-Linux" class="headerlink" title="1.2 Linux"></a>1.2 Linux</h3><p><strong>以下假定使用的是全新的<code>Linux</code>系统！</strong></p><p>首先更新软件源，防止<code>E: Unable to locate package</code>的错误，</p><p>1</p><p>sudo apt update</p><p>首先安装证书数据库工具<code>certutil</code>:</p><p>1<br>2</p><p>sudo apt install libnss3-tools &#x2F;&#x2F; ubuntu<br>sudo yum install nss-tools &#x2F;&#x2F; centos</p><p>然后，安装包管理工具<code>Linuxbrew</code>:</p><p>1<br>2</p><p>sudo apt install linuxbrew-wrapper &#x2F;&#x2F; ubuntu<br>sudo yum install linuxbrew-wrapper &#x2F;&#x2F; centos 待定</p><p>最后，使用<code>brew</code>安装<code>mkcert</code></p><p>1</p><p>brew install mkcert</p><p>tips:可能需要执行两次命令，同时不要使用<code>sudo</code>命令，系统会提示你不要使用<code>root</code>权限来执行<code>brew</code>。</p><p>在<code>mkcert</code>安装目录下启动<code>mkcert</code>，推荐将<code>mkcert</code>加入全局命令，</p><p>1</p><p>PATH&#x3D;$PATH:&#x2F;home&#x2F;linuxbrew&#x2F;.linuxbrew&#x2F;Cellar&#x2F;mkcert&#x2F;1.2.0&#x2F;bin</p><h3 id="1-3-macOS"><a href="#1-3-macOS" class="headerlink" title="1.3 macOS"></a>1.3 macOS</h3><p>使用<a target="_blank" rel="noopener" href="https://brew.sh/">Homebrew</a>安装<code>mkcert</code>：</p><p>1<br>2</p><p>brew install mkcert<br>brew install nss # if you use Firefox</p><h2 id="2-生成本地CA证书"><a href="#2-生成本地CA证书" class="headerlink" title="2. 生成本地CA证书"></a>2. 生成本地CA证书</h2><h3 id="2-1-生成根证书"><a href="#2-1-生成根证书" class="headerlink" title="2.1 生成根证书"></a>2.1 生成根证书</h3><p><code>mkcert</code>安装完成之后就可以使用<code>mkcert</code>命令生成本地<code>CA</code>证书了，非常简单，傻瓜式安装。</p><p>首先，生成根证书，一般在<code>C:\Users\用户名\AppData\Local\mkcert</code>目录下会生成<code>rootCA.pem</code>和<code>rootCA-key.pem</code>两个文件。</p><p>根证书用来充当第三方证书签发机构，类似于<code>Symantec</code>这种机构，为网站签发CA证书。因为证书也可以伪造，所以浏览器需要验证证书的有效性，证书有效之后才可以进行<code>https</code>连接，而第三方签发机构提供证书的可信度验证。</p><p><code>rootCA</code>文件就是告诉浏览器我们自签的证书是真实有效的，接下来我们签发的本地证书都离不开<code>rootCA</code>。</p><p>1<br>2<br>3<br>4</p><p>$ mkcert -install<br>Created a new local CA at “&#x2F;Users&#x2F;filippo&#x2F;Library&#x2F;Application Support&#x2F;mkcert” ?<br>The local CA is now installed in the system trust store! ⚡️<br>The local CA is now installed in the Firefox trust store (requires restart)! ?</p><h3 id="2-2-签发本地证书"><a href="#2-2-签发本地证书" class="headerlink" title="2.2 签发本地证书"></a>2.2 签发本地证书</h3><p>根证书生成之后就可以签发本地证书了，命令超级简单，唯一需要注意的就是生成的证书存放路径就是命令的执行路径。</p><p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12</p><p>$ mkcert example.com “*.example.org” myapp.dev localhost 127.0.0.1 ::1<br>Using the local CA at “&#x2F;Users&#x2F;filippo&#x2F;Library&#x2F;Application Support&#x2F;mkcert” ✨</p><p>Created a new certificate valid for the following names ?</p><ul><li>“example.com”</li><li>“*.example.org”</li><li>“myapp.dev”</li><li>“localhost”</li><li>“127.0.0.1”</li><li>“::1”</li></ul><p>The certificate is at “.&#x2F;example.com+5.pem” and the key at “.&#x2F;example.com+5-key.pem” ✅</p><h3 id="2-3-root-stores"><a href="#2-3-root-stores" class="headerlink" title="2.3 root stores"></a>2.3 root stores</h3><p><code>mkcert</code>支持以下根存储(mkcert supports the following root stores:)：</p><ul><li>macOS system store</li><li>Windows system store</li><li>Linux variants that provide either<ul><li>update-ca-trust (Fedora, RHEL, CentOS) or</li><li>update-ca-certificates (Ubuntu, Debian) or</li><li>trust (Arch)</li></ul></li><li>Firefox (macOS and Linux only)</li><li>Chrome and Chromium</li><li>Java (when JAVA_HOME is set)</li></ul><p>这句话的意思就是说，<code>mkcert</code>会自动把证书加入系统认证，操作系统和浏览器可以直接识别。比如，证书安装完成之后chrome的证书信任中心会增加以下内容：</p><p><img src="https://www.jarods.org/wp-content/uploads/2019/10/p36.png"></p><h3 id="2-4-node环境验证"><a href="#2-4-node环境验证" class="headerlink" title="2.4 node环境验证"></a>2.4 node环境验证</h3><p><code>node</code>不会使用<code>root store</code>，因此需要特殊对待，命令行手动设置<code>NODE_EXTRA_CA_CERTS</code>这个环境变量。</p><p>1</p><p>set NODE_EXTRA_CA_CERTS&#x3D;”$(mkcert -CAROOT)&#x2F;rootCA.pem”</p><p>** <code>mkcert -CAROOT</code>会输出本地根证书的存储路径，可以使用环境变量<code>$CAROOT</code>来指定寻找证书的默认路径。</p><p>使用<code>node</code>开启<code>https</code>服务：</p><p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20</p><p>var https &#x3D; require(‘https’);<br>var fs &#x3D; require(‘fs’);</p><p>const hostname &#x3D; ‘127.0.0.1’;<br>const port &#x3D; 3000;</p><p>var options &#x3D; {<br>key : fs.readFileSync(‘c:&#x2F;证书路径’),<br>cert : fs.readFileSync(‘c:&#x2F;证书路径’),<br>}</p><p>const server &#x3D; https.createServer(options ,(req, res) &#x3D;&gt; {<br>res.statusCode &#x3D; 200;<br>res.setHeader(‘Content-Type’, ‘text&#x2F;plain’);<br>res.end(‘Hello World\n’);<br>});</p><p>server.listen(port, hostname, () &#x3D;&gt; {<br>console.log(`Server running at https:&#x2F;&#x2F;${hostname}:${port}&#x2F;`);<br>});</p><p><code>https</code>进行访问：</p><p><img src="https://www.jarods.org/wp-content/uploads/2019/10/p37.png"></p><h2 id="3-分享"><a href="#3-分享" class="headerlink" title="3. 分享"></a>3. 分享</h2><p>搞定了自己，接下来就要搞定别人，如何让其它用户也识别我们的本地证书呢？</p><p><code>mkcert</code>同样也给我们提供了可移植的解决方案。</p><p>将自签证书(包括公钥和私钥)以及根证书的公钥拷贝给其它用户，修改<code>$CAROOT</code>环境变量，指定<code>mkcert</code>寻找根证书的路径，</p><p><code>linux</code>系统下：</p><p>1</p><p>export CAROOT&#x3D;”&#x2F;home&#x2F;…”</p><p><code>window</code>系统下：</p><p>设置系统的环境变量，变量名为<code>CAROOT</code></p><blockquote><p>我的电脑-&gt;属性-&gt;高级系统设置-&gt;环境变量</p></blockquote><p>最后执行<code>mkcert -install</code>即可，控制台会提示，此时我们的自签证书就可以在其它机器上运行了，根证书被导入到了浏览器的证书信任中心。</p><p>1<br>2</p><p>The local CA is now installed in the system trust store! ⚡️<br>The local CA is now installed in the Firefox and&#x2F;or Chrome&#x2F;Chromium trust store (requires browser restart)! ?</p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://jarod.vip/2019/10/13/centos-7-debian-9%E5%90%AF%E7%94%A8%E5%8E%9F%E7%94%9Fgoogle-bbr%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%8C%E5%AE%9E%E7%8E%B0tcp%E5%8A%A0%E9%80%9F/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Jarod"><meta itemprop="description" content="记录生活中的点点滴滴"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jarod's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2019/10/13/centos-7-debian-9%E5%90%AF%E7%94%A8%E5%8E%9F%E7%94%9Fgoogle-bbr%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%8C%E5%AE%9E%E7%8E%B0tcp%E5%8A%A0%E9%80%9F/" class="post-title-link" itemprop="url">CentOS 7 / Debian 9启用原生Google BBR的方法，实现TCP加速</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-10-13 22:31:37" itemprop="dateCreated datePublished" datetime="2019-10-13T22:31:37+08:00">2019-10-13</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-09-29 21:27:46" itemprop="dateModified" datetime="2022-09-29T21:27:46+08:00">2022-09-29</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Linux教程</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>1.4k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>1 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><p>CentOS 7&#x2F;Debian 9等新内核均已自带BBR，直接启用，安全。</p><p><strong>一、CentOS 7启用原生Google BBR</strong></p><p><strong>（一）更新CentOS 7内核为支持BBR的内核</strong></p><p>1、查看Centos内核</p><p>uname -r</p><p>2、如果低于4.10，则更新内核</p><p>rpm –import <a target="_blank" rel="noopener" href="https://www.elrepo.org/RPM-GPG-KEY-elrepo.org">https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</a><br>rpm -Uvh <a target="_blank" rel="noopener" href="http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm">http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm</a><br>yum –enablerepo&#x3D;elrepo-kernel install kernel-ml -y</p><p>3、安装完成后，查看已安装的内核：</p><p>rpm -qa grep kernel</p><p>如果看到 kernel-ml-5.3.5-1.el7.elrepo.x86_64 字样的，即是成功。 4、更新开机启动</p><p>egrep ^menuentry &#x2F;etc&#x2F;grub2.cfg cut -f 2 -d \‘</p><p>会看到类似这样的</p><p>CentOS Linux (5.3.5-1.el7.elrepo.x86_64) 7 (Core)<br>CentOS Linux (3.10.0-957.1.3.el7.x86_64) 7 (Core)<br>CentOS Linux (0-rescue-96820b9851c24560b5f942f2496b9aeb) 7 (Core)</p><p>设置CentOS Linux (5.3.5-1.el7.elrepo.x86_64) 7 (Core)为第一启动顺序（因为启动是从0开始计算）</p><p>grub2-set-default 0</p><p>5、重启系统</p><p>reboot</p><p><strong>（二）CentOS 7启用BBR</strong></p><p>1、执行</p><p>echo ‘net.core.default_qdisc&#x3D;fq’ sudo tee -a &#x2F;etc&#x2F;sysctl.conf<br>echo ‘net.ipv4.tcp_congestion_control&#x3D;bbr’ sudo tee -a &#x2F;etc&#x2F;sysctl.conf<br>sysctl -p</p><p>2、查看内核是否已开启BBR</p><p>sysctl net.ipv4.tcp_available_congestion_control</p><p>和</p><p>lsmod grep bbr</p><p>如果均显示BBR字样的，表示开启BBR成功。</p><p><strong>二、Debian 9启用原生Google BBR</strong></p><p>1、修改系统变量</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;net.core.default_qdisc=fq&quot; &gt;&gt; /etc/sysctl.conf</span><br><span class="line">echo &quot;net.ipv4.tcp_congestion_control=bbr&quot; &gt;&gt; /etc/sysctl.conf</span><br></pre></td></tr></table></figure><p>2、保存生效</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -p</span><br></pre></td></tr></table></figure><p>3、查看内核是否已开启BBR</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl net.ipv4.tcp_available_congestion_control</span><br></pre></td></tr></table></figure><p>显示如下内容表示开启：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sysctl net.ipv4.tcp_available_congestion_control</span><br><span class="line">net.ipv4.tcp_available_congestion_control = bbr cubic reno</span><br></pre></td></tr></table></figure><p>4、通过上面的操作应该已经启动了BBR。再看下BBR是否启动。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsmod  grep bbr</span><br></pre></td></tr></table></figure><p>显示以下即启动成功：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lsmod  grep bbr</span><br><span class="line">tcp_bbr                20480  14</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://jarod.vip/2019/10/08/centos%E6%8C%82%E8%BD%BD%E7%A3%81%E7%9B%98%E5%AE%8C%E6%95%B4%E5%9B%BE%E6%96%87%E6%95%99%E7%A8%8B/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Jarod"><meta itemprop="description" content="记录生活中的点点滴滴"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jarod's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2019/10/08/centos%E6%8C%82%E8%BD%BD%E7%A3%81%E7%9B%98%E5%AE%8C%E6%95%B4%E5%9B%BE%E6%96%87%E6%95%99%E7%A8%8B/" class="post-title-link" itemprop="url">Centos挂载磁盘完整图文教程</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-10-08 21:32:29" itemprop="dateCreated datePublished" datetime="2019-10-08T21:32:29+08:00">2019-10-08</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-09-29 21:27:46" itemprop="dateModified" datetime="2022-09-29T21:27:46+08:00">2022-09-29</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Linux教程</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>820</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>1 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><p><strong>1：查看服务器上未挂载的磁盘（磁盘有普通磁盘，高效磁盘，SSD磁盘）；命令如下：</strong></p><p>fdisk –l</p><p><img src="https://www.jarods.org/wp-content/uploads/2019/10/v2-4106065c56bb25db39c6c9dcef85c690_hd.jpg"></p><p>从上图可以看出，服务器的 &#x2F;dev&#x2F;vdb 42.9GB 此磁盘未挂载；</p><h2 id="2：磁盘分区（分区有主分区，扩展-分区，逻辑分区）；命令如下："><a href="#2：磁盘分区（分区有主分区，扩展-分区，逻辑分区）；命令如下：" class="headerlink" title="2：磁盘分区（分区有主分区，扩展 分区，逻辑分区）；命令如下："></a>2：磁盘分区（分区有主分区，扩展 分区，逻辑分区）；命令如下：</h2><p>fdisk &#x2F;dev&#x2F;vdb</p><p>n-&gt;p-&gt;1-&gt;回车-&gt;回车-&gt;w</p><p><img src="https://www.jarods.org/wp-content/uploads/2019/10/v2-e7513c23320fe2d00049c684084e9f35_hd.jpg"></p><p>上图的大概意思是这样的：</p><p>n：添加一个分区</p><p>P：主分区</p><p>两个回车指是开始和结束的磁盘大小；</p><p>w：写入磁盘</p><p>此时磁盘虽然已经分区，但是还没有文件系统，磁盘依然不能用；</p><p>博主服务器只购买了一块数据盘，所以我就全部用来做主分区了，如果你想把一个磁盘分成好几块，可以继续按此命令分区即可；你可以继续创建扩展分区……；</p><h2 id="3：格式化磁盘并写入文件系统：命令如下："><a href="#3：格式化磁盘并写入文件系统：命令如下：" class="headerlink" title="3：格式化磁盘并写入文件系统：命令如下："></a>3：格式化磁盘并写入文件系统：命令如下：</h2><p>mkfs.ext4 &#x2F;dev&#x2F;vdb1 &#x2F;&#x2F;这里可以用ext3，也可以用ext4；</p><p>出现如下图这们的界面，就是格式化磁盘写入文件成功：</p><p><img src="https://www.jarods.org/wp-content/uploads/2019/10/v2-24b491bb3789a42f60781b188c03c996_hd.jpg"></p><h2 id="4：挂载新磁盘到操作系统的某个节点上，命令如下："><a href="#4：挂载新磁盘到操作系统的某个节点上，命令如下：" class="headerlink" title="4：挂载新磁盘到操作系统的某个节点上，命令如下："></a>4：挂载新磁盘到操作系统的某个节点上，命令如下：</h2><p>mkdir &#x2F;mydata</p><p>mount &#x2F;dev&#x2F;vdb1 &#x2F;mydata</p><p>在系统的根创建一个mydata，把这个磁盘挂载到此目录；挂载位置可以自己随意创建；</p><h2 id="5：查看磁盘信息，确认挂载新磁盘是否成功，命令如下："><a href="#5：查看磁盘信息，确认挂载新磁盘是否成功，命令如下：" class="headerlink" title="5：查看磁盘信息，确认挂载新磁盘是否成功，命令如下："></a>5：查看磁盘信息，确认挂载新磁盘是否成功，命令如下：</h2><p>df</p><p>如果挂载成功，会出现如下图这样的界面；</p><p><img src="https://www.jarods.org/wp-content/uploads/2019/10/v2-9ff0cf49e020f3b6e4ad12990a933060_hd.jpg"></p><h2 id="6：查看磁盘所有信息；"><a href="#6：查看磁盘所有信息；" class="headerlink" title="6：查看磁盘所有信息；"></a>6：查看磁盘所有信息；</h2><p>当我们再来查所有分区时，用fdisk -l 命令就会多了一个主分区，&#x2F;dev&#x2F;vdb1；如下图：</p><p><img src="https://www.jarods.org/wp-content/uploads/2019/10/v2-c72776117591a916568612b49a71cd05_hd.jpg"></p><h2 id="7：设置开机启动自动挂载；"><a href="#7：设置开机启动自动挂载；" class="headerlink" title="7：设置开机启动自动挂载；"></a>7：设置开机启动自动挂载；</h2><p>新创建的分区不能开机自动挂载，每次重启机器都要手动挂载。</p><p>设置开机自动挂载需要修改&#x2F;etc&#x2F;fstab文件 ；命令如下：</p><p>echo “&#x2F;dev&#x2F;vdb1 &#x2F;mydata ext4 defaults 0 0” &gt;&gt; &#x2F;etc&#x2F;fstab</p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://jarod.vip/2019/10/05/cloudflare-%E8%87%AA%E5%AE%9A%E4%B9%89ip%E8%8A%82%E7%82%B9%E6%94%B6%E5%BD%95/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Jarod"><meta itemprop="description" content="记录生活中的点点滴滴"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jarod's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2019/10/05/cloudflare-%E8%87%AA%E5%AE%9A%E4%B9%89ip%E8%8A%82%E7%82%B9%E6%94%B6%E5%BD%95/" class="post-title-link" itemprop="url">Cloudflare 自定义IP节点收录</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-10-05 21:13:11" itemprop="dateCreated datePublished" datetime="2019-10-05T21:13:11+08:00">2019-10-05</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-09-29 21:27:46" itemprop="dateModified" datetime="2022-09-29T21:27:46+08:00">2022-09-29</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Linux教程</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>2.4k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>2 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="CFIP白名单"><a href="#CFIP白名单" class="headerlink" title="CFIP白名单"></a>CFIP白名单</h2><p>173.245.48.0&#x2F;20<br>103.21.244.0&#x2F;22<br>103.22.200.0&#x2F;22<br>103.31.4.0&#x2F;22<br>141.101.64.0&#x2F;18<br>108.162.192.0&#x2F;18<br>190.93.240.0&#x2F;20<br>188.114.96.0&#x2F;20<br>197.234.240.0&#x2F;22<br>198.41.128.0&#x2F;17<br>162.158.0.0&#x2F;15<br>104.16.0.0&#x2F;12<br>172.64.0.0&#x2F;13<br>131.0.72.0&#x2F;22</p><h2 id="百度云加速与Cloudflare合作节点"><a href="#百度云加速与Cloudflare合作节点" class="headerlink" title="百度云加速与Cloudflare合作节点"></a>百度云加速与Cloudflare合作节点</h2><p>162.159.211.4-103</p><p>103.21.244.0&#x2F;22<br>103.22.200.0&#x2F;22<br>103.31.4.0&#x2F;22<br>104.16.0.0&#x2F;12<br>108.162.192.0&#x2F;18<br>131.0.72.0&#x2F;22<br>141.101.64.0&#x2F;18<br>162.158.0.0&#x2F;15<br>172.64.0.0&#x2F;13<br>173.245.48.0&#x2F;20<br>188.114.96.0&#x2F;20<br>190.93.240.0&#x2F;20<br>197.234.240.0&#x2F;22<br>198.41.128.0&#x2F;17</p><h2 id="Cloudflare节点推荐"><a href="#Cloudflare节点推荐" class="headerlink" title="Cloudflare节点推荐"></a>Cloudflare节点推荐</h2><p><a target="_blank" rel="noopener" href="http://www.moeelf.com/archives/10.html">www.moeelf.com/archives/10.html</a></p><p>CloudFlare 百度云合作 ip：</p><p>162.159.208.4-162.159.208.103</p><p>162.159.209.4-162.159.209.103</p><p>162.159.210.4-162.159.210.103</p><p>162.159.211.4-162.159.211.103</p><p>官方列表：CloudFlare公开的节点 <a target="_blank" rel="noopener" href="https://www.cloudflare.com/zh-cn/ips/">https://www.cloudflare.com/zh-cn/ips/</a></p><p>各线路推荐列表：<br>电信：推荐走圣何塞，例：104.16.160.* 或者上面的百度云合作 ip。<br>移动：推荐走移动香港，例：172.64.32.*、141.101.115.* 或者 104.23.240.0-104.23.243.254。<br>联通：没发布什么好线路，可走圣何塞。例：104.16.160.* 或者 104.23.240.0-104.23.243.254。也可以试一下走亚特兰大 108.162.236.*（日前不可用。） 。</p><h2 id="Qi推荐"><a href="#Qi推荐" class="headerlink" title="Qi推荐"></a>Qi推荐</h2><p>108.162.236.1&#x2F;24 联通 走美国<br>172.64.32.1&#x2F;24 移动 走香港<br>104.16.160.1&#x2F;24 电信 走美国洛杉矶<br>———<br>172.64.0.0&#x2F;24 电信 美国旧金山<br>104.20.157.0&#x2F;24 联通 走日本<br>104.28.14.0&#x2F;24 移动 走新加坡<br>（联通移动推荐节点）<br>104.23.240.0-104.23.243.254<br>（电信推荐百度云合作ip）<br>162.159.208.4-162.159.208.103<br>162.159.209.4-162.159.209.103<br>162.159.210.4-162.159.210.103<br>162.159.211.4-162.159.211.103</p><h2 id="适合电信的节点"><a href="#适合电信的节点" class="headerlink" title="适合电信的节点"></a>适合电信的节点</h2><p>104.23.240.* 走欧洲各国出口 英国德国荷兰等 延迟比美国高一些 适合源站在欧洲的网站 172.64.32.* 虽然去程走新加坡，但是回程线路的绕路的，实际效果不好，不推荐 104.16.160.* 圣何塞的线路，比洛杉矶要快一点，推荐 108.162.236.* 亚特兰大线路，延迟稳定，但是延迟较高</p><h2 id="适合移动的节点"><a href="#适合移动的节点" class="headerlink" title="适合移动的节点"></a>适合移动的节点</h2><p>162.158.133.* 走的丹麦，这一段ip只有部分能用，可以自己试一下。绕美国。 198.41.214.* 198.41.212.* 198.41.208.* 198.41.209.* 172.64.32.* 141.101.115.* 移动走香港的IP段有很多，以上并不是全部。CF移动走香港的分直连和走ntt的效果都挺不错的，不过部分地区晚上还是会丢包。 172.64.0. 这是走圣何塞的，一般用香港的就行 172.64.16.* 欧洲线路.绕</p><h2 id="1-0-0-1效果较好"><a href="#1-0-0-1效果较好" class="headerlink" title="1.0.0.1效果较好"></a>1.0.0.1效果较好</h2><h2 id="电信部分"><a href="#电信部分" class="headerlink" title="电信部分"></a>电信部分</h2><p>大多数省直接使用1.0.0.0即可，延迟低，丢包少， 少部分还是需要换ip</p><h3 id="新加坡"><a href="#新加坡" class="headerlink" title="新加坡"></a>新加坡</h3><p>172.64.32.0-172.64.47.254</p><h3 id="移动部分"><a href="#移动部分" class="headerlink" title="移动部分"></a>移动部分</h3><h3 id="新加坡-1"><a href="#新加坡-1" class="headerlink" title="新加坡"></a>新加坡</h3><p>104.18.48.0-104.18.63.255 104.24.112.0-104.24.127.255 104.27.128.0-104.27.143.255 104.28.0.0-104.28.15.255</p><h3 id="移动部分-1"><a href="#移动部分-1" class="headerlink" title="移动部分"></a>移动部分</h3><h3 id="圣何塞-cogentco-com"><a href="#圣何塞-cogentco-com" class="headerlink" title="圣何塞 cogentco.com"></a>圣何塞 cogentco.com</h3><p>104.28.16.0-31.255 104.27.144.0-243.254 104.23.240.0-243.254</p><h3 id="香港cloudflare1-100g-hkix-net"><a href="#香港cloudflare1-100g-hkix-net" class="headerlink" title="香港cloudflare1-100g.hkix.net"></a>香港cloudflare1-100g.hkix.net</h3><p>大部分都是这个通道 1.0.0.0-254 1.1.1.0-254 66.235.200.0-254 此段为IPOWER.COM endurance.com专用，有可能被跳转到IPOWER.COM endurance.com页面 104.16.80.0-95.255 104.16.175.255-104.16.191.255</p><h3 id="香港直连"><a href="#香港直连" class="headerlink" title="香港直连"></a>香港直连</h3><p>23.227.63.0-254 此段为shopify.com专用，有可能被跳转到shopify.com页面 104.16.0.0-79.255 104.16.96.0-175.254 104.16.192.0-207.255</p><h3 id="新加坡-ae-0-cloudflare-sngpsi07-sg-bb-gin-ntt-net"><a href="#新加坡-ae-0-cloudflare-sngpsi07-sg-bb-gin-ntt-net" class="headerlink" title="新加坡 ae-0.cloudflare.sngpsi07.sg.bb.gin.ntt.net"></a>新加坡 ae-0.cloudflare.sngpsi07.sg.bb.gin.ntt.net</h3><p>都从香港ntt转发 104.28.0.0-15.255</p><h3 id="联通部分"><a href="#联通部分" class="headerlink" title="联通部分"></a>联通部分</h3><h3 id="伦敦-cloudflare-gw-cr10-lon1-ip4-gtt-net"><a href="#伦敦-cloudflare-gw-cr10-lon1-ip4-gtt-net" class="headerlink" title="伦敦 cloudflare-gw.cr10-lon1.ip4.gtt.net"></a>伦敦 cloudflare-gw.cr10-lon1.ip4.gtt.net</h3><p>172.64.19.16</p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://jarod.vip/2019/10/05/centos%E7%B2%BE%E7%AE%80%E4%B8%8E%E4%BC%98%E5%8C%96/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Jarod"><meta itemprop="description" content="记录生活中的点点滴滴"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jarod's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2019/10/05/centos%E7%B2%BE%E7%AE%80%E4%B8%8E%E4%BC%98%E5%8C%96/" class="post-title-link" itemprop="url">CentOS精简与优化</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-10-05 21:12:17" itemprop="dateCreated datePublished" datetime="2019-10-05T21:12:17+08:00">2019-10-05</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-09-29 21:27:46" itemprop="dateModified" datetime="2022-09-29T21:27:46+08:00">2022-09-29</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Linux教程</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>1.9k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>2 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><p>CentOS安装完毕后，需要进行的优化步骤。</p><blockquote><p>注意：本文所述的优化，是针对于VPS环境的，桌面环境和独立服务器的CentOS请勿使用本文中的方法进行优化，否则可能导致桌面环境不正常。独立服务器也不要使用本文中的方法去优化，否则会引起异常~</p></blockquote><h2 id="1，删除不必要的软件包"><a href="#1，删除不必要的软件包" class="headerlink" title="1，删除不必要的软件包"></a>1，删除不必要的软件包</h2><p>yum remove Deployment_Guide-en-US finger cups-libs cups ypbind<br>yum remove bluez-libs desktop-file-utils ppp rp-pppoe wireless-tools irda-utils<br>yum remove sendmail* samba* talk-server finger-server bind* xinetd<br>yum remove nfs-utils nfs-utils-lib rdate fetchmail eject ksh mkbootdisk mtools<br>yum remove syslinux tcsh startup-notification talk apmd rmt dump setserial portmap yp-tools<br>yum groupremove “Mail Server” “Games and Entertainment” “X Window System” “X Software Development” yum groupremove “Development Libraries” “Dialup Networking Support” yum groupremove “Games and Entertainment” “Sound and Video” “Graphics” “Editors” yum groupremove “Text-based Internet” “GNOME Desktop Environment” “GNOME Software Development”</p><h2 id="2，升级整个系统"><a href="#2，升级整个系统" class="headerlink" title="2，升级整个系统"></a>2，升级整个系统</h2><p>yum update #更新全部更新 yum clean all #清理全部缓存的安装文件以节省空间</p><h2 id="3，禁用seLinux"><a href="#3，禁用seLinux" class="headerlink" title="3，禁用seLinux"></a>3，禁用seLinux</h2><p>sestatus 先执行这一句看看seLinux状态，如果不是disabled，那么执行如下步骤将其禁用 vi &#x2F;etc&#x2F;selinux&#x2F;config<br>SELINUX=disabled 禁用SeLinux SELINUX=enforcing 使用SeLinux</p><h2 id="4，停止网卡对ipv6的支持"><a href="#4，停止网卡对ipv6的支持" class="headerlink" title="4，停止网卡对ipv6的支持"></a>4，停止网卡对ipv6的支持</h2><p>vi &#x2F;etc&#x2F;modprobe.conf 添加如下行到文尾：<br>alias net-pf-10 off alias ipv6 off</p><p>重启后生效。</p><h2 id="5，修改环境变量语言编码，防止出现乱码"><a href="#5，修改环境变量语言编码，防止出现乱码" class="headerlink" title="5，修改环境变量语言编码，防止出现乱码"></a>5，修改环境变量语言编码，防止出现乱码</h2><p>vi &#x2F;etc&#x2F;profile 找到export PATH ……这一行，在其上面加上一行 LANG=en_US.UTF-8<br>然后在export PATH ……这一行后面补充一个LANG<br>source &#x2F;etc&#x2F;profile</p><h2 id="6，初始化防火墙"><a href="#6，初始化防火墙" class="headerlink" title="6，初始化防火墙"></a>6，初始化防火墙</h2><p>touch &#x2F;etc&#x2F;sysconfig&#x2F;iptables<br>iptables -F<br>iptables -X<br>iptables -Z<br>service iptables save<br>service iptables restart</p><h2 id="7，来个一键优化脚本，自动禁用无用服务，且禁止其开机自启动"><a href="#7，来个一键优化脚本，自动禁用无用服务，且禁止其开机自启动" class="headerlink" title="7，来个一键优化脚本，自动禁用无用服务，且禁止其开机自启动"></a>7，来个一键优化脚本，自动禁用无用服务，且禁止其开机自启动</h2><p>#! &#x2F;bin&#x2F;bash service acpid off<br>service atd stop<br>service auditd stop<br>service avahi-daemon stop<br>service avahi-dnsconfd stop<br>service bluetooth stop<br>service conman stop<br>service cpuspeed stop<br>service cups stop<br>service dnsmasq stop<br>service dund stop<br>service firstboot stop<br>service hidd stop<br>service httpd stop<br>service ibmasm stop<br>service ip6tables stop<br>service irda stop<br>service kdump stop<br>service lm_sensors stop<br>service mcstrans stop<br>service messagebus stop<br>service microcode_ctl stop<br>service netconsole stop<br>service netfs stop<br>service netplugd stop<br>service nfs stop<br>service nfslock stop<br>service nscd stop<br>service ntpd stop<br>service oddjobd stop</p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://jarod.vip/2019/09/28/linux%E4%B8%8B%EF%BC%8C%E5%AE%89%E8%A3%85rclone%EF%BC%8C%E6%8C%82%E8%BD%BDgoogle-drive%E3%80%81onedrive%E3%80%81webdav%E3%80%81ftp%E7%AD%89%E7%AD%89%EF%BC%9B%E4%BA%92%E7%9B%B8%E6%8B%B7%E8%B4%9D/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Jarod"><meta itemprop="description" content="记录生活中的点点滴滴"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jarod's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/2019/09/28/linux%E4%B8%8B%EF%BC%8C%E5%AE%89%E8%A3%85rclone%EF%BC%8C%E6%8C%82%E8%BD%BDgoogle-drive%E3%80%81onedrive%E3%80%81webdav%E3%80%81ftp%E7%AD%89%E7%AD%89%EF%BC%9B%E4%BA%92%E7%9B%B8%E6%8B%B7%E8%B4%9D/" class="post-title-link" itemprop="url">Linux下，安装Rclone，挂载Google Drive、OneDrive、WebDAV、FTP等等；互相拷贝、备份文件等</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-09-28 16:14:53" itemprop="dateCreated datePublished" datetime="2019-09-28T16:14:53+08:00">2019-09-28</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-09-29 21:27:46" itemprop="dateModified" datetime="2022-09-29T21:27:46+08:00">2022-09-29</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Linux教程</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>1.5k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>1 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><p>Rclone，Linux下，可挂载Google Drive、OneDrive、WebDAV、FTP等等，堪称神器。下面是安装和使用教程。</p><p><strong>一、安装Rclone</strong> 下面的操作基于Centos系统</p><p>1、安装必须的应用</p><p>yum -y install wget unzip screen fuse fuse-devel</p><p>2、安装Rclone</p><p>curl <a target="_blank" rel="noopener" href="https://rclone.org/install.sh">https://rclone.org/install.sh</a> sudo bash</p><p><strong>二、挂载Google Drive</strong></p><p>1、挂载GDrive</p><p>rclone config</p><p>选择 <em>n</em> ，创建新链接，并命名为 <em>gdrive</em> 。然后选择Google Drive <img src="https://www.jarods.org/wp-content/uploads/2019/09/rclone-01.png"></p><p>client_id、client_secret 留空直接回车，SCOPE 选1，root_folder_id、service_account_file留空回车,Edit advanced config、Use auto config 选择n</p><p>这时，会出现个链接，复制到浏览器中，获取授权代码，并把授权代码粘贴到终端。 根据提示选择，一般为n、y、q <img src="https://www.jarods.org/wp-content/uploads/2019/09/rclone-02.png"></p><p>把Google Drive挂载到服务器上的一个目录。为便于以后web访问，可挂载到&#x2F;www&#x2F;wwwroot&#x2F;下（以下演示为&#x2F;www&#x2F;wwwroot&#x2F;gdrive.xxx.com，gdrive.xxx.com改为自己的域名）</p><p>.&#x2F;rclone mount gdrive: &#x2F;www&#x2F;wwwroot&#x2F;gdrive.xxx.com –allow-other –allow-non-empty –vfs-cache-mode writes</p><p>2、设置开机启动rclone</p><p>先把rclone的可执行文件复制到&#x2F;usr&#x2F;bin：</p><p>cp &#x2F;root&#x2F;rclone-v*&#x2F;rclone &#x2F;usr&#x2F;bin&#x2F;rclone</p><p>新建一个rclone.service文件：</p><p>vi &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;rclone.service</p><p>粘贴：</p><p>[Unit]<br>Description&#x3D;rclone<br>    <br>[Service]<br>User&#x3D;root<br>ExecStart&#x3D;&#x2F;usr&#x2F;bin&#x2F;rclone mount gdrive: &#x2F;www&#x2F;wwwroot&#x2F;gdrive.xxx.com –allow-other –allow-non-empty –vfs-cache-mode writes<br>Restart&#x3D;on-abort<br>    <br>[Install]<br>WantedBy&#x3D;multi-user.target</p><p>重载daemon，让新的服务文件生效：</p><p>systemctl daemon-reload</p><p>启动rclone：</p><p>systemctl start rclone</p><p>设置开机启动：</p><p>systemctl enable rclone</p><p><strong>三、Rclone的操作</strong></p><p>1、列出远程目录（gdrive为之前创建的）</p><p>rclone lsd gdrive</p><p>2、复制文件</p><p>rclone copy 源文件&#x2F;目录 目标目录</p><p>源文件&#x2F;目录、目标目录要绝对路径，均可以为服务器、网盘等 如要保存别人分享的Gdrive，可先保存到自己的网盘，然后复制这些文件到自己的网盘，以免共享的人删除文件。</p><p>rclone copy gdrive:gongxiang&#x2F;japan gdrive:gongxiang&#x2F;self</p><p>3、同步文件</p><p>rclone sync 源文件&#x2F;目录 目标目录</p><p>这个只同步没有的文件。适合变化较大的文件。</p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><nav class="pagination"><a class="extend prev" rel="prev" href="/page/10/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><span class="page-number current">11</span><a class="page-number" href="/page/12/">12</a><span class="space">&hellip;</span><a class="page-number" href="/page/26/">26</a><a class="extend next" rel="next" href="/page/12/"><i class="fa fa-angle-right" aria-label="下一页"></i></a></nav></div><script>window.addEventListener("tabs:register",()=>{let t=CONFIG.comments["activeClass"];var e;(t=CONFIG.comments.storage?localStorage.getItem("comments_active")||t:t)&&(e=document.querySelector(`a[href="#comment-${t}"]`))&&e.click()}),CONFIG.comments.storage&&window.addEventListener("tabs:click",t=>{t.target.matches(".tabs-comment .tab-content .tab-pane")&&(t=t.target.classList[1],localStorage.setItem("comments_active",t))})</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><p class="site-author-name" itemprop="name">Jarod</p><div class="site-description" itemprop="description">记录生活中的点点滴滴</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">258</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">6</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">306</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/jarodvip" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jarodvip" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Jarod</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-chart-area"></i> </span><span title="站点总字数">647k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="站点阅读时长">9:48</span></div><div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动</div></div></footer></div><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script></body></html>