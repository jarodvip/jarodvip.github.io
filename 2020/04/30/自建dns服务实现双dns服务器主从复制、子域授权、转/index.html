<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"jarod.vip",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"always",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="测试环境： 硬件：一台主DNS服务器 一台从DNS服务器，一台子域DNS服务器  (一个有更改NS解析地址权限的二级域名) 系统：Centos 6.5 x86_64 BIND版本：9.9.5 下面是两台服务器的网络情况 [root@LookBack223 ~]&#96;&#96;# ifconfig awk -F&#39;[ :]+&#39; &#39;&#x2F;inet addr&#x2F;&amp;#123;print$4&amp;#125;"><meta property="og:type" content="article"><meta property="og:title" content="自建DNS服务,实现双DNS服务器主从复制、子域授权、转发、智能解析等效果"><meta property="og:url" content="https://jarod.vip/2020/04/30/%E8%87%AA%E5%BB%BAdns%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E5%8F%8Cdns%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E3%80%81%E5%AD%90%E5%9F%9F%E6%8E%88%E6%9D%83%E3%80%81%E8%BD%AC/index.html"><meta property="og:site_name" content="Jarod&#39;s Blog"><meta property="og:description" content="测试环境： 硬件：一台主DNS服务器 一台从DNS服务器，一台子域DNS服务器  (一个有更改NS解析地址权限的二级域名) 系统：Centos 6.5 x86_64 BIND版本：9.9.5 下面是两台服务器的网络情况 [root@LookBack223 ~]&#96;&#96;# ifconfig awk -F&#39;[ :]+&#39; &#39;&#x2F;inet addr&#x2F;&amp;#123;print$4&amp;#125;"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://jarod.vip/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A315.png"><meta property="og:image" content="https://jarod.vip/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A335.png"><meta property="og:image" content="https://jarod.vip/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3815.png"><meta property="og:image" content="https://jarod.vip/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A365.png"><meta property="og:image" content="https://jarod.vip/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A372.png"><meta property="og:image" content="https://jarod.vip/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3121-283x300-1.png"><meta property="og:image" content="https://www.jarods.org/wp-content/uploads/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3101.png"><meta property="og:image" content="https://jarod.vip/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A391.png"><meta property="og:image" content="https://jarod.vip/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3131.png"><meta property="og:image" content="https://jarod.vip/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3141.png"><meta property="og:image" content="https://jarod.vip/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3151.png"><meta property="og:image" content="https://jarod.vip/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A316.png"><meta property="og:image" content="https://jarod.vip/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A320.png"><meta property="og:image" content="https://jarod.vip/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A319.png"><meta property="og:image" content="https://jarod.vip/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A321.png"><meta property="og:image" content="https://jarod.vip/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A322.png"><meta property="og:image" content="https://jarod.vip/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A323.png"><meta property="og:image" content="https://jarod.vip/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A324.png"><meta property="og:image" content="https://jarod.vip/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A325.png"><meta property="article:published_time" content="2020-04-30T14:40:51.000Z"><meta property="article:modified_time" content="2022-09-29T13:27:46.098Z"><meta property="article:author" content="Jarod"><meta property="article:tag" content="DNS"><meta property="article:tag" content="BIND"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://jarod.vip/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A315.png"><link rel="canonical" href="https://jarod.vip/2020/04/30/%E8%87%AA%E5%BB%BAdns%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E5%8F%8Cdns%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E3%80%81%E5%AD%90%E5%9F%9F%E6%8E%88%E6%9D%83%E3%80%81%E8%BD%AC/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>自建DNS服务,实现双DNS服务器主从复制、子域授权、转发、智能解析等效果 | Jarod's Blog</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-R131WF8QZC"></script><script>function gtag(){dataLayer.push(arguments)}CONFIG.hostname===location.hostname&&(window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-R131WF8QZC"))</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?e67344a16e268228733f496a595ecb7a",document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="Jarod's Blog" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">Jarod's Blog</h1><span class="logo-line-after"><i></i></span></a></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://jarod.vip/2020/04/30/%E8%87%AA%E5%BB%BAdns%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E5%8F%8Cdns%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E3%80%81%E5%AD%90%E5%9F%9F%E6%8E%88%E6%9D%83%E3%80%81%E8%BD%AC/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="Jarod"><meta itemprop="description" content="记录生活中的点点滴滴"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Jarod's Blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">自建DNS服务,实现双DNS服务器主从复制、子域授权、转发、智能解析等效果</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-04-30 22:40:51" itemprop="dateCreated datePublished" datetime="2020-04-30T22:40:51+08:00">2020-04-30</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-09-29 21:27:46" itemprop="dateModified" datetime="2022-09-29T21:27:46+08:00">2022-09-29</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Linux教程</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>29k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>26 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><p>测试环境：</p><p>硬件：一台主DNS服务器 一台从DNS服务器，一台子域DNS服务器  (一个有更改NS解析地址权限的二级域名) 系统：Centos 6.5 x86_64 BIND版本：9.9.5 下面是两台服务器的网络情况</p><p><code>[root@LookBack223 ~]``# ifconfig awk -F&#39;[ :]+&#39; &#39;/inet addr/&#123;print$4&#125;&#39; grep -vE &quot;^127.&quot;</code></p><p><code>92.222.219.223</code> <code>#DNS主服务器</code></p><p><code>=============================================================================</code></p><p><code>[root@LookBack226 ~]``# ifconfig awk -F&#39;[ :]+&#39; &#39;/inet addr/&#123;print$4&#125;&#39; grep -vE &quot;^127.&quot;</code></p><p><code>92.222.219.226</code> <code>#DNS从服务器</code></p><p><code>=============================================================================</code></p><p><code>[root@LookBack37 ~]``# ifconfig awk -F&#39;[ :]+&#39; &#39;/inet addr/&#123;print$4&#125;&#39; grep -vE &quot;^127.&quot;</code></p><p><code>37.59.108.37</code> <code>#DNS子域服务器</code></p><p> </p><hr><h1 id="一、安装bind-由于现在的bind大版本有9和10，这里用9版本来测试。"><a href="#一、安装bind-由于现在的bind大版本有9和10，这里用9版本来测试。" class="headerlink" title="一、安装bind(由于现在的bind大版本有9和10，这里用9版本来测试。)"></a><strong>一、安装bind(由于现在的bind大版本有9和10，这里用9版本来测试。)</strong></h1><p><a target="_blank" rel="noopener" href="https://www.dwhd.org/20150519_164840.html#down-file" title="下载链接">bind-9.9.5.tar.gz下载</a></p><p>（官方下载地址：<a target="_blank" rel="noopener" href="http://www.isc.org/downloads/%EF%BC%89">http://www.isc.org/downloads/）</a></p><p><code>[root@LookBack223 ~]``# groupadd -g 153 -r named</code></p><p><code>[root@LookBack223 ~]``# useradd -g named -r -u 153 named</code></p><p><code>#在系统上创建一个GID为153 组名为named的系统组</code></p><p><code>#在系统上穿件一个UID为153 所在组为named 系统用户</code></p><p><code>[root@LookBack223 ~]``# yum groupinstall &quot;Development tools&quot; &quot;Server Platform Development&quot; -y</code></p><p><code>#安装开发库包，不然下面是编译不了的(自己安装make等程序也是可以的，这里只是为了取巧。)</code></p><p><code>[root@LookBack223 ~]``# wget -4c [http://www.05hd.com/wp-content/uploads/2014/08/bind-9.9.5.tar.gz](http://www.05hd.com/wp-content/uploads/2014/08/bind-9.9.5.tar.gz)</code></p><p><code>[root@LookBack223 ~]``# tar xf bind-9.9.5.tar.gz</code></p><p><code>[root@LookBack223 ~]``# cd bind-9.9.5</code></p><p><code>[root@LookBack223 bind-9.9.5]``# ./configure --prefix=/usr/local/bind995 --sysconfdir=/etc/named --disable-chroot --enable-threads --enable-ipv6</code></p><p><code>#指定bind安装到/usr/local/bind995目录下，指定配置文件在/etc/bind995目录下，关闭chroot功能，开启threads和ipv6功能，其他用默认，这里的编译选项请根据各自的实际需求来选择。</code></p><p><code>#如果能看到类似下面的信息且没有报错那么就可以继续往下走</code></p><p><code>========================================================================</code></p><p><code>Configuration summary:</code></p><p><code>------------------------------------------------------------------------</code></p><p><code>Optional features enabled:</code></p><p><code>Multiprocessing support (--``enable``-threads)</code></p><p><code>GSS-API (--with-gssapi)</code></p><p><code>Print backtrace on crash (--``enable``-backtrace)</code></p><p><code>Use symbol table</code> <code>for</code> <code>backtrace, named only (--``enable``-symtable)</code></p><p><code>Dynamically loadable zone (DLZ) drivers:</code></p><p><code>None</code></p><p><code>Features disabled or unavailable on this platform:</code></p><p><code>Response Rate Limiting (--``enable``-rrl)</code></p><p><code>PKCS``#11/Cryptoki support (--with-pkcs11)</code></p><p><code>New statistics (--``enable``-newstats)</code></p><p><code>Allow</code> <code>&#39;fixed&#39;</code> <code>rrset-order (--``enable``-fixed-rrset)</code></p><p><code>Automated Testing Framework (--with-atf)</code></p><p><code>GOST algorithm support (--with-gost)</code></p><p><code>Python tools (--with-python)</code></p><p><code>XML statistics (--with-libxml2)</code></p><p><code>========================================================================</code></p><p><code>#开始编译</code></p><p><code>[root@localhost bind-9.9.5]``# make -j $(awk &#39;/processor/&#123;i++&#125;&#125;END&#123;print i&#125;&#39; /proc/cpuinfo) &amp;&amp; make install</code></p><p> </p><p><code>[root@LookBack223 ~]``# dig -v</code></p><p><code>DiG 9.8.2rc1-RedHat-9.8.2-0.17.rc1.el6_4.6</code></p><p><code>[root@LookBack223 ~]``# /usr/local/bind995/bin/dig -v</code></p><p><code>DiG 9.9.5</code></p><p><code>#系统上的虽然之前没有安装bind服务端但是客户端是有装的比如bind自带的dig程序，所以这里我们需要设置系统环境变量</code></p><p><code>[root@LookBack223 ~]``# echo &quot;export PATH=/usr/local/bind/bin:/usr/local/bind/sbin:$PATH&quot; &gt; /etc/profile.d/bind.sh</code></p><p><code>[root@LookBack223 ~]``# ln -sv /usr/local/bind995 /usr/local/bind</code></p><p><code>[root@LookBack223 ~]``# . /etc/profile.d/bind.sh</code></p><p><code>[root@LookBack223 ~]``# echo $PATH</code></p><p><code>/usr/lib64/qt-3``.3``/bin``:``/usr/local/bind/bin``:``/usr/local/bind/sbin``:``/usr/local/sbin``:``/usr/local/bin``:``/sbin``:``/bin``:``/usr/sbin``:``/usr/bin``:``/root/bin</code></p><p><code>[root@LookBack223 ~]``# dig -v</code></p><p><code>DiG 9.9.5</code></p><p><code>#这时候就OK了</code></p><p><code>[root@LookBack223 ~]``# sed -i &quot;$(awk &#39;$1==&quot;MANPATH&quot;&#123;n=NR&#125;END&#123;print n&#125;&#39; /etc/man.config)a MANPATHt/usr/local/bind/share/man&quot; /etc/man.config</code></p><p><code>#导出帮助手册,是系统可以直接man named命令</code></p><p><code>如果有如下提示</code></p><p><code>awk``: 命令行:1: 致命错误: 无法以读模式打开文件“``/etc/man``.config”(没有那个文件或目录)</code></p><p><code>sed``：无法读取</code> <code>/etc/man``.config：没有那个文件或目录</code></p><p><code>那就需要安装``man</code></p><p><code>[root@LookBack223 ~]``# yum install man -y</code></p><hr><h1 id="二、开始配置基础的配置文件"><a href="#二、开始配置基础的配置文件" class="headerlink" title="二、开始配置基础的配置文件"></a><strong>二、开始配置基础的配置文件</strong></h1><p><code>[root@LookBack223 ~]``# cat &gt; /etc/named/named.conf &lt;&lt; EOF</code></p><p><code>options &#123;</code></p><p><code>directory</code> <code>&quot;/var/named&quot;``;</code></p><p><code>//``定义工作目录</code></p><p><code>recursion</code> <code>yes``;</code></p><p><code>//``允许递归</code></p><p><code>&#125;;</code></p><p><code>zone</code> <code>&quot;.&quot;</code> <code>IN  &#123;</code></p><p><code>type</code> <code>hint;</code></p><p><code>file</code> <code>&quot;named.ca&quot;``;</code></p><p><code>&#125;;</code></p><p><code>zone</code> <code>&quot;localhost&quot;</code> <code>IN  &#123;</code></p><p><code>type</code> <code>master;</code></p><p><code>//``定义为主DNS  master</code></p><p><code>file</code> <code>&quot;localhost.zone&quot;``;</code></p><p><code>allow-update &#123; none; &#125;;</code></p><p><code>//``不允许任何人更新</code></p><p><code>&#125;;</code></p><p><code>zone</code> <code>&quot;0.0.127.in-addr.arpa&quot;</code>  <code>IN  &#123;</code></p><p><code>//``把127.0.0反向解析</code></p><p><code>type</code> <code>master;</code></p><p><code>file</code> <code>&quot;127.0.0.zone&quot;``;</code></p><p><code>allow-update &#123; none; &#125;;</code></p><p><code>&#125;;</code></p><p><code>EOF</code></p><p><code>[root@LookBack223 ~]``# chown root:named /etc/named/named.conf</code></p><p><code>[root@LookBack223 ~]``# chmod 640 /etc/named/named.conf</code></p><p><code>[root@LookBack223 ~]``# mkdir -p /var/named/slaves</code></p><p><code>[root@LookBack223 ~]``# chown root:named /var/named/</code></p><p><code>[root@LookBack223 ~]``# chown named:named /var/named/slaves/</code></p><p><code>[root@LookBack223 ~]``# chmod 750 /var/named/</code></p><p><code>[root@LookBack223 ~]``# chmod 770 /var/named/slaves/</code></p><p><code>#制作相关配置文件和设置文件对应的权限</code></p><p><img src="/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A315.png" alt="自建DNS服务,实现双DNS服务器主从复制、子域授权、转发、智能解析等效果"></p><hr><h2 id="下面开始来配置实现正向解析"><a href="#下面开始来配置实现正向解析" class="headerlink" title="下面开始来配置实现正向解析"></a><strong>下面开始来配置实现正向解析</strong></h2><p><code>[root@LookBack223 named]``# for i in $(grep &#39;file&#39; /etc/named/named.conf awk -F&#39;&quot;&#39; &#39;&#123;print$2&#125;&#39;); do touch /var/named/$i;chgrp named /var/named/$i;chmod 640 /var/named/$i;done</code></p><p><code>[root@LookBack223 named]``# pwd</code></p><p><code>/var/named</code></p><p><code>[root@LookBack223 named]``# tree</code></p><p><code>.</code></p><p><code>├── 127.0.0.zone</code></p><p><code>├── localhost.zone</code></p><p><code>├── named.ca</code></p><p><code>└── slaves</code></p><p><code>1 directory, 3 files</code></p><p><code>#到这里 几个基础的文件就都创建好了，现在需要不足文件里面的配置信息</code></p><p><code>[root@LookBack223 named]``# dig -t NS . @a.root-servers.net. &gt; /var/named/named.ca</code></p><p><code>#获取13台根服务器的配置文件,我们上面已经配置了将跟解析放在/var/named/named.cd,所以我么直接用dig命令将结果重定向过去就好了</code></p><p> </p><p><code>####下面是3个文件的配置内容####</code></p><p><code>[root@LookBack223 named]``# cat named.ca</code></p><p><code>; &gt; DiG 9.9.5 &gt; -t NS . @a.root-servers.net.</code></p><p><code>;; global options: +cmd</code></p><p><code>;; Got answer:</code></p><p><code>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR,</code> <code>id``: 18948</code></p><p><code>;; flags: qr aa rd; QUERY: 1, ANSWER: 13, AUTHORITY: 0, ADDITIONAL: 25</code></p><p><code>;; WARNING: recursion requested but not available</code></p><p><code>;; OPT PSEUDOSECTION:</code></p><p><code>; EDNS: version: 0, flags:; udp: 4096</code></p><p><code>;; QUESTION SECTION:</code></p><p><code>;.              IN  NS</code></p><p><code>;; ANSWER SECTION:</code></p><p><code>.           518400  IN  NS  b.root-servers.net.</code></p><p><code>.           518400  IN  NS  h.root-servers.net.</code></p><p><code>.           518400  IN  NS  i.root-servers.net.</code></p><p><code>.           518400  IN  NS  l.root-servers.net.</code></p><p><code>.           518400  IN  NS  f.root-servers.net.</code></p><p><code>.           518400  IN  NS  g.root-servers.net.</code></p><p><code>.           518400  IN  NS  d.root-servers.net.</code></p><p><code>.           518400  IN  NS  j.root-servers.net.</code></p><p><code>.           518400  IN  NS  a.root-servers.net.</code></p><p><code>.           518400  IN  NS  k.root-servers.net.</code></p><p><code>.           518400  IN  NS  m.root-servers.net.</code></p><p><code>.           518400  IN  NS  c.root-servers.net.</code></p><p><code>.           518400  IN  NS  e.root-servers.net.</code></p><p><code>;; ADDITIONAL SECTION:</code></p><p><code>b.root-servers.net. 3600000 IN  A   192.228.79.201</code></p><p><code>b.root-servers.net. 3600000 IN  AAAA    2001:500:84::b</code></p><p><code>h.root-servers.net. 3600000 IN  A   128.63.2.53</code></p><p><code>h.root-servers.net. 3600000 IN  AAAA    2001:500:1::803f:235</code></p><p><code>i.root-servers.net. 3600000 IN  A   192.36.148.17</code></p><p><code>i.root-servers.net. 3600000 IN  AAAA    2001:7fe::53</code></p><p><code>l.root-servers.net. 3600000 IN  A   199.7.83.42</code></p><p><code>l.root-servers.net. 3600000 IN  AAAA    2001:500:3::42</code></p><p><code>f.root-servers.net. 3600000 IN  A   192.5.5.241</code></p><p><code>f.root-servers.net. 3600000 IN  AAAA    2001:500:2f::f</code></p><p><code>g.root-servers.net. 3600000 IN  A   192.112.36.4</code></p><p><code>d.root-servers.net. 3600000 IN  A   199.7.91.13</code></p><p><code>d.root-servers.net. 3600000 IN  AAAA    2001:500:2d::d</code></p><p><code>j.root-servers.net. 3600000 IN  A   192.58.128.30</code></p><p><code>j.root-servers.net. 3600000 IN  AAAA    2001:503:c27::2:30</code></p><p><code>a.root-servers.net. 3600000 IN  A   198.41.0.4</code></p><p><code>a.root-servers.net. 3600000 IN  AAAA    2001:503:ba3e::2:30</code></p><p><code>k.root-servers.net. 3600000 IN  A   193.0.14.129</code></p><p><code>k.root-servers.net. 3600000 IN  AAAA    2001:7fd::1</code></p><p><code>m.root-servers.net. 3600000 IN  A   202.12.27.33</code></p><p><code>m.root-servers.net. 3600000 IN  AAAA    2001:dc3::35</code></p><p><code>c.root-servers.net. 3600000 IN  A   192.33.4.12</code></p><p><code>c.root-servers.net. 3600000 IN  AAAA    2001:500:2::c</code></p><p><code>e.root-servers.net. 3600000 IN  A   192.203.230.10</code></p><p><code>;; Query</code> <code>time``: 65 msec</code></p><p><code>;; SERVER: 198.41.0.4``#53(198.41.0.4)</code></p><p><code>;; WHEN: Wed Aug 06 05:22:48 UTC 2014</code></p><p><code>;; MSG SIZE  rcvd: 755</code></p><p><code>[root@LookBack223 named]``# cat localhost.zone</code></p><p><code>$TTL 86400</code></p><p><code>@   IN  SOA localhost.  admin.05hd.org. (</code></p><p><code>2014080601</code></p><p><code>3H</code></p><p><code>15M</code></p><p><code>7D</code></p><p><code>1D )</code></p><p><code>IN  NS  localhost.</code></p><p><code>IN  A   172.0.0.1</code></p><p><code>[root@LookBack223 named]``# cat 127.0.0.zone</code></p><p><code>$TTL 86400</code></p><p><code>@   IN  SOA localhost.  admin.05hd.org. (</code></p><p><code>2014080601</code></p><p><code>3H</code></p><p><code>15M</code></p><p><code>7D</code></p><p><code>1D )</code></p><p><code>IN  NS  localhost.</code></p><p><code>1   IN  PTR localhost.</code></p><p> </p><p><code>[root@LookBack223 named]``# chgrp named 127.0.0.zone localhost.zone named.ca</code></p><p><code>[root@LookBack223 named]``# chmod 640 127.0.0.zone localhost.zone named.ca</code></p><p><code>[root@LookBack223 named]``# ll</code></p><p><code>total 16</code></p><p><code>-rw-r----- 1 root  named  128 Aug  6 06:24 127.0.0.zone</code></p><p><code>-rw-r----- 1 root  named  124 Aug  6 06:23 localhost.zone</code></p><p><code>-rw-r----- 1 root  named 2177 Aug  6 06:11 named.ca</code></p><p><code>drwxrwx--- 2 named named 4096 Aug  6 05:04 slaves</code></p><p><code>#修改3个文件的属主属组和权限</code></p><p> </p><p><code>[root@LookBack223 named]``# named-checkconf</code></p><p><code>[root@LookBack223 named]``# named-checkconf /etc/named/named.conf</code></p><p><code>[root@LookBack223 named]``# named-checkzone &quot;localhost&quot; /var/named/localhost.zone</code></p><p><code>zone localhost``/IN``: loaded serial 2014080601</code></p><p><code>OK</code></p><p><code>[root@LookBack223 named]``# named-checkzone &quot;0.0.127.in-addr.arpa&quot; /var/named/127.0.0.zone</code></p><p><code>zone 0.0.127.``in``-addr.arpa``/IN``: loaded serial 2014080601</code></p><p><code>OK</code></p><p><code>##检测配置文件如下图</code></p><p><img src="/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A335.png" alt="自建DNS服务,实现双DNS服务器主从复制、子域授权、转发、智能解析等效果"></p><p>到了这里我们就可以启动服务来测试了，但是这里的bind是我们编译安装的，编译安装是没有启动脚本的，下面制作启动脚本 将下面的内容保存为**&#x2F;etc&#x2F;rc.d&#x2F;init.d&#x2F;named (注意下面的高亮的两行中的bind安装目录，我这里安装在&#x2F;usr&#x2F;local&#x2F;bind995就用这，其安装在其他目录请根据情况做修改)**</p><p><code>[root@LookBack223 named]``# wget -c4 [http://www.05hd.com/named.sh](http://www.05hd.com/named.sh) -O /etc/rc.d/init.d/named</code></p><p><code>##可以用上面的命令下载启动脚本 也可以用下面的源码自建 更可以自己手写启动脚本</code></p><p><code>#!/bin/bash</code></p><p><code>#</code></p><p><code># description: named daemon</code></p><p><code># chkconfig: - 25 80</code></p><p><code>#</code></p><p><code>pidFile=``/usr/local/bind995/var/run/named``.pid</code></p><p><code>lockFile=``/var/lock/subsys/named</code></p><p><code>confFile=``/etc/named/named``.conf</code></p><p><code>[ -r</code> <code>/etc/rc``.d``/init``.d``/functions</code> <code>] &amp;&amp; .</code> <code>/etc/rc``.d``/init``.d``/functions</code></p><p><code>start() &#123;</code></p><p><code>if</code> <code>[ -e $lockFile ];</code> <code>then</code></p><p><code>echo</code> <code>&quot;named is already running...&quot;</code></p><p><code>exit</code> <code>0</code></p><p><code>fi</code></p><p><code>echo</code> <code>-n</code> <code>&quot;Starting named:&quot;</code></p><p><code>daemon --pidfile</code> <code>&quot;$pidFile&quot;</code> <code>/usr/local/bind995/sbin/named</code> <code>-u named -c</code> <code>&quot;$confFile&quot;</code></p><p><code>RETVAL=$?</code></p><p><code>echo</code></p><p><code>if</code> <code>[ $RETVAL -``eq</code> <code>0 ];</code> <code>then</code></p><p><code>touch</code> <code>$lockFile</code></p><p><code>return</code> <code>$RETVAL</code></p><p><code>else</code></p><p><code>rm</code> <code>-f $lockFile $pidFile</code></p><p><code>return</code> <code>1</code></p><p><code>fi</code></p><p><code>&#125;</code></p><p><code>stop() &#123;</code></p><p><code>if</code> <code>[ ! -e $lockFile ];</code> <code>then</code></p><p><code>echo</code> <code>&quot;named is stopped.&quot;</code></p><p><code># exit 0</code></p><p><code>fi</code></p><p><code>echo</code> <code>-n</code> <code>&quot;Stopping named:&quot;</code></p><p><code>killproc named</code></p><p><code>RETVAL=$?</code></p><p><code>echo</code></p><p><code>if</code> <code>[ $RETVAL -``eq</code> <code>0 ];``then</code></p><p><code>rm</code> <code>-f $lockFile $pidFile</code></p><p><code>return</code> <code>0</code></p><p><code>else</code></p><p><code>echo</code> <code>&quot;Cannot stop named.&quot;</code></p><p><code>failure</code></p><p><code>return</code> <code>1</code></p><p><code>fi</code></p><p><code>&#125;</code></p><p><code>restart() &#123;</code></p><p><code>stop</code></p><p><code>sleep</code> <code>2</code></p><p><code>start</code></p><p><code>&#125;</code></p><p><code>reload() &#123;</code></p><p><code>echo</code> <code>-n</code> <code>&quot;Reloading named: &quot;</code></p><p><code>killproc named -HUP</code></p><p><code>#killall -HUP named</code></p><p><code>RETVAL=$?</code></p><p><code>echo</code></p><p><code>return</code> <code>$RETVAL</code></p><p><code>&#125;</code></p><p><code>status() &#123;</code></p><p><code>if</code> <code>pidof named &amp;&gt;</code> <code>/dev/null``;</code> <code>then</code></p><p><code>echo</code> <code>-n</code> <code>&quot;named is running...&quot;</code></p><p><code>success</code></p><p><code>echo</code></p><p><code>else</code></p><p><code>echo</code> <code>-n</code> <code>&quot;named is stopped...&quot;</code></p><p><code>success</code></p><p><code>echo</code></p><p><code>fi</code></p><p><code>&#125;</code></p><p><code>usage() &#123;</code></p><p><code>echo</code> <code>&quot;Usage: named &#123;startstoprestartstatusreload&#125;&quot;</code></p><p><code>&#125;</code></p><p><code>case</code> <code>$1</code> <code>in</code></p><p><code>start)</code></p><p><code>start ;;</code></p><p><code>stop)</code></p><p><code>stop ;;</code></p><p><code>restart)</code></p><p><code>restart ;;</code></p><p><code>status)</code></p><p><code>status ;;</code></p><p><code>reload)</code></p><p><code>reload ;;</code></p><p><code>*)</code></p><p><code>usage</code></p><p><code>exit</code> <code>4</code></p><p><code>;;</code></p><p><code>esac</code></p><p><code>&lt;a href=``&quot;[http://www.dwhd.org/wp-content/uploads/2015/05/bind](http://www.dwhd.org/wp-content/uploads/2015/05/bind)使用详解45.png&quot;``&gt;&lt;img class=``&quot;attachment-medium&quot;</code> <code>src=``&quot;[http://www.dwhd.org/wp-content/uploads/2015/05/bind](http://www.dwhd.org/wp-content/uploads/2015/05/bind)使用详解45.png&quot;</code> <code>alt=``&quot;bind使用详解45&quot;</code>  <code>/&gt;&lt;``/a``&gt;</code></p><p> </p><p><code>[root@LookBack223 named]``# chmod +x /etc/rc.d/init.d/named</code></p><p><code>[root@LookBack223 named]``# chkconfig --add named</code></p><p><code>[root@LookBack223 named]``# chkconfig named on</code></p><p><code>[root@LookBack223 named]``# chkconfig --list named</code></p><p><code>named           0:off   1:off   2:on    3:on    4:on    5:on    6:off</code></p><p><strong>下面来测试启动脚本的正常与否 开始来启动named服务</strong></p><p><code>[root@LookBack223 named]``# service named start</code></p><p><code>Starting named:                                            [  OK  ]</code></p><p><code>[root@LookBack223 named]``# service named restart</code></p><p><code>Stopping named:                                            [  OK  ]</code></p><p><code>Starting named:                                            [  OK  ]</code></p><p><code>[root@LookBack223 named]``# service named stop</code></p><p><code>Stopping named:                                            [  OK  ]</code></p><p><code>[root@LookBack223 named]``# service named start</code></p><p><code>Starting named:                                            [  OK  ]</code></p><p><code>[root@LookBack223 named]``# service named status</code></p><p><code>named is running...                                        [  OK  ]</code></p><p><strong>来看下服务器启动情况和端口监听正常不</strong></p><p><img src="/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3815.png" alt="自建DNS服务,实现双DNS服务器主从复制、子域授权、转发、智能解析等效果"></p><p><strong>下面两图可以看出 服务器上的dns服务器已经OK了。</strong></p><p><img src="/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A365.png" alt="自建DNS服务,实现双DNS服务器主从复制、子域授权、转发、智能解析等效果"></p><p><img src="/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A372.png" alt="自建DNS服务,实现双DNS服务器主从复制、子域授权、转发、智能解析等效果"></p><hr><h1 id="三、现在来开始做域名正反向解析了"><a href="#三、现在来开始做域名正反向解析了" class="headerlink" title="三、现在来开始做域名正反向解析了"></a><strong>三、现在来开始做域名正反向解析了</strong></h1><p>先来看看用于测试域名的为zeaxion.com</p><h2 id="1、正向域解析配置"><a href="#1、正向域解析配置" class="headerlink" title="1、正向域解析配置"></a><strong>1、正向域解析配置</strong></h2><p>在&#x2F;etc&#x2F;named&#x2F;named.conf配置文件里面追加下面的内容</p><p><code>zone</code> <code>&quot;zeaxion.com&quot;</code>   <code>IN  &#123;</code></p><p><code>type</code> <code>master;</code></p><p><code>file</code> <code>&quot;zeaxion.com.zone&quot;``;</code></p><p><code>&#125;;</code></p><p>如下图： <img src="/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3121-283x300-1.png" alt="自建DNS服务,实现双DNS服务器主从复制、子域授权、转发、智能解析等效果"></p><p>创建&#x2F;var&#x2F;named&#x2F;zeaxion.com.zone文件并写好配置内容</p><p><code>[root@LookBack223 named]``# touch /var/named/zeaxion.com.zone</code></p><p><code>[root@LookBack223 named]``# chgrp named /var/named/zeaxion.com.zone</code></p><p><code>[root@LookBack223 named]``# chmod 640 /var/named/zeaxion.com.zone</code></p><p><code>[root@LookBack223 named]``# cat zeaxion.com.zone</code></p><p><code>$TTL 600</code></p><p><code>@   IN  SOA ns.zeaxion.com. admin.zeaxion.com. (</code></p><p><code>;\ 上面的admin.zeaxion.com.其实邮箱地址，在这里邮箱地址不能使用@所以要使用.</code></p><p><code>2014080601</code></p><p><code>1H</code></p><p><code>10M</code></p><p><code>7D</code></p><p><code>2H )</code></p><p><code>IN  NS      ns.zeaxion.com.</code></p><p><code>IN  MX  10  mxdomain.qq.com.</code></p><p><code>ns.zeaxion.com. IN  A   106.186.17.185</code></p><p><code>www.zeaxion.com.    IN  A   106.186.17.185</code></p><p><code>manage.zeaxion.com. IN  A   106.186.17.185</code></p><p>如下图 <img src="https://www.jarods.org/wp-content/uploads/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3101.png" alt="自建DNS服务,实现双DNS服务器主从复制、子域授权、转发、智能解析等效果"> 然后检测下配置文件可有写法格式错误 <img src="/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A391.png" alt="自建DNS服务,实现双DNS服务器主从复制、子域授权、转发、智能解析等效果"></p><p>到了这里我们需要去域名注册商处将域名的ns设置成ns.zeaxion.com和ns2.zeaxion.com，设置好了之后我们来看看在互联网上这个域名的DNS解析是否OK了</p><p><code>[root@LookBack226 ~]``# ifconfig awk -F&#39;[ :]+&#39; &#39;/inet addr/&#123;print$4&#125;&#39; grep -vE &quot;^127.&quot;</code></p><p><code>92.222.219.226</code></p><p><code>[root@LookBack226 ~]``# dig +trace -t A www.zeaxion.com</code></p><p><code>; &lt;&lt;&gt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.23.rc1.el6_5.1 &lt;&lt;&gt;&gt; +trace -t A www.zeaxion.com</code></p><p><code>;; global options: +cmd</code></p><p><code>.           509310  IN  NS  e.root-servers.net.</code></p><p><code>.           509310  IN  NS  a.root-servers.net.</code></p><p><code>.           509310  IN  NS  l.root-servers.net.</code></p><p><code>.           509310  IN  NS  d.root-servers.net.</code></p><p><code>.           509310  IN  NS  b.root-servers.net.</code></p><p><code>.           509310  IN  NS  m.root-servers.net.</code></p><p><code>.           509310  IN  NS  h.root-servers.net.</code></p><p><code>.           509310  IN  NS  f.root-servers.net.</code></p><p><code>.           509310  IN  NS  g.root-servers.net.</code></p><p><code>.           509310  IN  NS  j.root-servers.net.</code></p><p><code>.           509310  IN  NS  c.root-servers.net.</code></p><p><code>.           509310  IN  NS  k.root-servers.net.</code></p><p><code>.           509310  IN  NS  i.root-servers.net.</code></p><p><code>;; Received 228 bytes from 127.0.0.1``#53(127.0.0.1) in 2151 ms</code></p><p><code>com.            172800  IN  NS  a.gtld-servers.net.</code></p><p><code>com.            172800  IN  NS  b.gtld-servers.net.</code></p><p><code>com.            172800  IN  NS  c.gtld-servers.net.</code></p><p><code>com.            172800  IN  NS  d.gtld-servers.net.</code></p><p><code>com.            172800  IN  NS  e.gtld-servers.net.</code></p><p><code>com.            172800  IN  NS  f.gtld-servers.net.</code></p><p><code>com.            172800  IN  NS  g.gtld-servers.net.</code></p><p><code>com.            172800  IN  NS  h.gtld-servers.net.</code></p><p><code>com.            172800  IN  NS  i.gtld-servers.net.</code></p><p><code>com.            172800  IN  NS  j.gtld-servers.net.</code></p><p><code>com.            172800  IN  NS  k.gtld-servers.net.</code></p><p><code>com.            172800  IN  NS  l.gtld-servers.net.</code></p><p><code>com.            172800  IN  NS  m.gtld-servers.net.</code></p><p><code>;; Received 493 bytes from 198.41.0.4``#53(198.41.0.4) in 1180 ms</code></p><p><code>zeaxion.com.        172800  IN  NS  ns.zeaxion.com.</code></p><p><code>zeaxion.com.        172800  IN  NS  ns2.zeaxion.com.</code></p><p><code>;; Received 100 bytes from 2001:503:a83e::2:30``#53(2001:503:a83e::2:30) in 23 ms</code></p><p><code>www.zeaxion.com.    600 IN  A   106.186.17.185</code></p><p><code>zeaxion.com.        600 IN  NS  ns.zeaxion.com.</code></p><p><code>zeaxion.com.        600 IN  NS  ns2.zeaxion.com.</code></p><p><code>;; Received 116 bytes from 92.222.219.223``#53(92.222.219.223) in 0 ms</code></p><p>以上可以看出现在我们的基本的域名DNS解析已经搞定了。</p><h2 id="2、反向域解析配置"><a href="#2、反向域解析配置" class="headerlink" title="2、反向域解析配置"></a><strong>2、反向域解析配置</strong></h2><p>在&#x2F;etc&#x2F;named&#x2F;named.conf文件中加入</p><p><code>[root@LookBack223 named]``# zone  &quot;219.222.92.in-addr.arpa&quot;   &#123;</code></p><p><code>type</code> <code>master;</code></p><p><code>file</code> <code>&quot;92.222.219.zone&quot;``;</code></p><p><code>&#125;;</code></p><p>创建一个&#x2F;var&#x2F;named&#x2F;92.222.219.zone的文件，注意文件的属主数组权限,也可以用下面的命令自动生成&#x2F;etc&#x2F;named&#x2F;named.conf配置内容需要的文件了，</p><p><code>[root@LookBack223 named]``# for i in $(grep &#39;file&#39; /etc/named/named.conf awk -F&#39;&quot;&#39; &#39;&#123;print$2&#125;&#39;); do touch /var/named/$i;chgrp named /var/named/$i;chmod 640 /var/named/$i;done</code></p><p>来看下&#x2F;var&#x2F;named&#x2F;92.222.219.zone文件怎么做反接配置的 <img src="/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3131.png" alt="自建DNS服务,实现双DNS服务器主从复制、子域授权、转发、智能解析等效果"></p><p><code>[root@LookBack223 named]``# cat !$</code></p><p><code>cat</code> <code>92.222.219.zone</code></p><p><code>$TTL 600</code></p><p><code>@   IN  SOA ns.zeaxion.com. admin.zeaxion.com. (</code></p><p><code>2014080601</code></p><p><code>1H</code></p><p><code>10M</code></p><p><code>7D</code></p><p><code>2H )</code></p><p><code>IN  NS      ns.zeaxion.com.</code></p><p><code>IN  NS      ns2.zeaxion.com.</code></p><p><code>219 IN  PTR     ns.zeaxion.com.</code></p><p><code>226 IN  PTR     ns2.zeaxion.com.</code></p><p><code>;106.186.17.185 IN  PTR zeaxion.com.</code></p><p><code>;106.186.17.185 IN  PTR www.zeaxion.com.</code></p><p><code>;106.186.17.185 IN  PTR manage.zeaxion.com.</code></p><p><code>####最后的3行不能用。。。请注意。。</code></p><p>接着来检测下配置文件，如果没有错误就让named重新载入下配置文件 <img src="/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3141.png" alt="自建DNS服务,实现双DNS服务器主从复制、子域授权、转发、智能解析等效果"></p><p><code>[root@LookBack223 named]``# named-checkconf</code></p><p><code>[root@LookBack223 named]``# named-checkzone &quot;219.222.92.in-addr.arpa&quot; 92.222.219.zone</code></p><p><code>zone 219.222.92.``in``-addr.arpa``/IN``: loaded serial 2014080601</code></p><p><code>OK</code></p><p><code>[root@LookBack223 named]``# service named reload</code></p><p><code>Reloading named:                                           [  OK  ]</code></p><p><code>[root@LookBack223 named]``#</code></p><p><img src="/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3151.png" alt="自建DNS服务,实现双DNS服务器主从复制、子域授权、转发、智能解析等效果"></p><p><code>[root@LookBack226 ~]``# ifconfig awk -F&#39;[ :]+&#39; &#39;/inet addr/&#123;print$4&#125;&#39; grep -vE &quot;^127.&quot;</code></p><p><code>92.222.219.226</code></p><p><code>[root@LookBack226 ~]``# dig -x 92.222.219.223 @92.222.219.223</code></p><p><code>; &lt;&lt;&gt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.23.rc1.el6_5.1 &lt;&lt;&gt;&gt; -x 92.222.219.223 @92.222.219.223</code></p><p><code>;; global options: +cmd</code></p><p><code>;; Got answer:</code></p><p><code>;; -&gt;&gt;HEADER&lt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.23.rc1.el6_5.1 &lt;&lt;&gt;&gt; -t AXFR 219.222.92.``in``-addr.arpa @92.222.219.223</code></p><p><code>;; global options: +cmd</code></p><p><code>219.222.92.``in``-addr.arpa. 600    IN  SOA ns.zeaxion.com. admin.zeaxion.com. 2014080601 3600 600 604800 7200</code></p><p><code>219.222.92.``in``-addr.arpa. 600    IN  NS  ns.zeaxion.com.</code></p><p><code>219.222.92.``in``-addr.arpa. 600    IN  NS  ns2.zeaxion.com.</code></p><p><code>223.219.222.92.``in``-addr.arpa. 600 IN PTR ns.zeaxion.com.</code></p><p><code>226.219.222.92.``in``-addr.arpa. 600 IN PTR ns2.zeaxion.com.</code></p><p><code>219.222.92.``in``-addr.arpa. 600    IN  SOA ns.zeaxion.com. admin.zeaxion.com. 2014080601 3600 600 604800 7200</code></p><p><code>;; Query</code> <code>time``: 1 msec</code></p><p><code>;; SERVER: 92.222.219.223``#53(92.222.219.223)</code></p><p><code>;; WHEN: Wed Aug  6 15:26:04 2014</code></p><p><code>;; XFR size: 6 records (messages 1, bytes 201)</code></p><p>到此 反向解析也配置好了。</p><hr><h1 id="四、配置多DNS主从复制"><a href="#四、配置多DNS主从复制" class="headerlink" title="四、配置多DNS主从复制"></a><strong>四、配置多DNS主从复制</strong></h1><p>做主从复制的时候需要注意的几点的事情 (1)、从服务器的bind版本必须大于等于主服务器的bind版本。因为程序都是采取向下兼容的规则。如果从服务器版本低于主服务器那么很可能因为程序功能的改变导致失败 所以这里我们还是采取编译安装从服务器这样就可以保证主从服务器的bind都为同一版本。因为之前已经编译了一次 这里就不详说从服务器的编译安装过程了。直接使用下面的命令就可以了。 (2)、<strong>主从服务器的时间需要相对一致</strong>，所以我们这里给主从服务器都做NTP在线时间同步。<a target="_blank" rel="noopener" href="http://www.pool.ntp.org/en/">http://www.pool.ntp.org/en/</a></p><p><code>[root@LookBack226 ~]```# echo &quot;*/3 * * * *</code>which ntpdate&#96; fr.pool.ntp.org &amp;&gt; &#x2F;dev&#x2F;null” &#x2F;var&#x2F;spool&#x2F;cron&#x2F;root&#96;&#96;</p><p><code>[root@LookBack226 ~]``# ntpdate fr.pool.ntp.org</code></p><p><code>6 Aug 15:58:38 ntpdate[21702]: Can&#39;t adjust the</code> <code>time</code> <code>of day: Operation not permitted</code></p><p><code>我这里由于2台测试机都是openvz的虚拟机，被机房设置不能修改时间，因为虚拟机需要和母机做同步时间，那么我这里的时间问题就无需操心了。</code></p><p><strong>安装完毕之后还是需要重新启动下shell 或者服务器。因为系统的环境变量有改变。</strong></p><p><code>[root@LookBack226 ~]``# groupadd -g 153 -r named</code></p><p><code>[root@LookBack226 ~]``# useradd -g named -r -u 153 named</code></p><p><code>[root@LookBack226 ~]``# yum groupinstall &quot;Development tools&quot; &quot;Server Platform Development&quot; -y</code></p><p><code>[root@LookBack226 ~]``# wget -4c [http://www.05hd.com/wp-content/uploads/2014/08/bind-9.9.5.tar.gz](http://www.05hd.com/wp-content/uploads/2014/08/bind-9.9.5.tar.gz)</code></p><p><code>[root@LookBack226 ~]``# tar xf bind-9.9.5.tar.gz</code></p><p><code>[root@LookBack226 ~]``# cd bind-9.9.5</code></p><p><code>[root@LookBack226 bind-9.9.5]``# ./configure --prefix=/usr/local/bind995 --sysconfdir=/etc/named --disable-chroot --enable-threads --enable-ipv6</code></p><p><code>[root@LookBack226 bind-9.9.5]``# make &amp;&amp; make install</code></p><p><code>[root@LookBack226 ~]``# echo &quot;export PATH=/usr/local/bind995/bin:/usr/local/bind995/sbin:$PATH&quot; &gt; /etc/profile.d/bind995.sh</code></p><p><code>[root@LookBack226 ~]``# sed -i &quot;$(cat /etc/man.config grep -nE &#39;^MANPATH[[:space:]]+&#39; tail -1 awk -F: &#39;&#123;print$1&#125;&#39;)a MANPATHt/usr/local/bind995/share/man&quot; /etc/man.config</code></p><p><code>[root@LookBack226 ~]``# wget -c4 [http://www.05hd.com/named.sh](http://www.05hd.com/named.sh) -O /etc/rc.d/init.d/named</code></p><p><code>[root@LookBack226 ~]``# chmod +x /etc/rc.d/init.d/named</code></p><p><code>[root@LookBack226 ~]``# chkconfig --add named</code></p><p><code>[root@LookBack226 ~]``# chkconfig named on</code></p><p><code>[root@LookBack226 ~]``# chown root:named /etc/named/named.conf</code></p><p><code>[root@LookBack226 ~]``# chmod 640 /etc/named/named.conf</code></p><p><code>[root@LookBack226 ~]``# mkdir -p /var/named/slaves</code></p><p><code>[root@LookBack226 ~]``# chown root:named /var/named/</code></p><p><code>[root@LookBack226 ~]``# chown named:named /var/named/slaves/</code></p><p><code>[root@LookBack226 ~]``# chmod 750 /var/named/</code></p><p><code>[root@LookBack226 ~]``# chmod 770 /var/named/slaves/</code></p><p><code>#上面的步骤做好了 新建个shell进程进服务器或者直接重启下服务器</code></p><p><img src="/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A316.png" alt="自建DNS服务,实现双DNS服务器主从复制、子域授权、转发、智能解析等效果"> 上图可以看出 bind已经编译安装好了 系统环境变量也做OK了</p><p>首先来配置从服务器</p><p><code>[root@LookBack226 ~]``# cat /etc/named/named.conf</code></p><p><code>options &#123;</code></p><p><code>listen-on port 53 &#123; 127.0.0.1; 92.222.219.226; &#125;;``//``这里记得要换成从服务器的IPV4地址哦</code></p><p><code>listen-on-v6 port 53 &#123; 2001:41d0:52:300::10f8; &#125;;``//``这里记得要换成从服务器的IPV6地址哦</code></p><p><code>directory</code> <code>&quot;/var/named&quot;``;</code></p><p><code>//``定义工作目录</code></p><p><code>recursion</code> <code>yes``;</code></p><p><code>//``允许递归</code></p><p><code>&#125;;</code></p><p><code>zone</code> <code>&quot;.&quot;</code> <code>IN &#123;</code></p><p><code>type</code> <code>hint;</code></p><p><code>file</code> <code>&quot;named.ca&quot;``;</code></p><p><code>&#125;;</code></p><p><code>zone</code> <code>&quot;localhost&quot;</code> <code>IN &#123;</code></p><p><code>type</code> <code>master;</code></p><p><code>//``设施为主 master</code></p><p><code>file</code> <code>&quot;localhost.zone&quot;``;</code></p><p><code>allow-update &#123; none; &#125;;</code></p><p><code>//``不允许任何人更新</code></p><p><code>&#125;;</code></p><p><code>zone</code> <code>&quot;0.0.127.in-addr.arpa&quot;</code> <code>IN &#123;</code></p><p><code>//``把127.0.0反向解析</code></p><p><code>type</code> <code>master;</code></p><p><code>file</code> <code>&quot;127.0.0.zone&quot;``;</code></p><p><code>allow-update &#123; none; &#125;;</code></p><p><code>&#125;;</code></p><p><code>zone</code> <code>&quot;zeaxion.com&quot;</code> <code>IN &#123;</code></p><p><code>type</code> <code>slave;</code> <code>//``设置为从服务器</code></p><p><code>file</code> <code>&quot;slaves/zeaxion.com.zone&quot;``;</code> <code>//``设置从服务器配置文件存放路径</code></p><p><code>masters &#123; 92.222.219.223; &#125;;</code> <code>//``配置主DNS服务器的IP地址</code></p><p><code>&#125;;</code></p><p><code>zone</code> <code>&quot;219.222.92.in-addr.arpa&quot;</code> <code>&#123;</code></p><p><code>type</code> <code>slave;</code></p><p><code>file</code> <code>&quot;slaves/92.222.219.zone&quot;``;</code></p><p><code>masters &#123; 92.222.219.223; &#125;;</code></p><p><code>&#125;;</code></p><p><code>配置好了主配置文件后 ，和上面一样创建一个bind的启动脚本，然后启动服务。</code></p><p><code>来看看从服务器上的端口监听状态</code></p><p><code>&lt;a href=``&quot;[http://www.dwhd.org/wp-content/uploads/2015/05/bind](http://www.dwhd.org/wp-content/uploads/2015/05/bind)使用详解17.png&quot;``&gt;&lt;img class=``&quot;attachment-medium&quot;</code> <code>src=``&quot;[http://www.dwhd.org/wp-content/uploads/2015/05/bind](http://www.dwhd.org/wp-content/uploads/2015/05/bind)使用详解17.png&quot;</code> <code>alt=``&quot;bind使用详解17&quot;</code>  <code>/&gt;&lt;``/a``&gt;</code></p><p><code>然后来看看从服务器上的文件是否同步成功。。</code></p><p><code>&lt;a href=``&quot;[http://www.dwhd.org/wp-content/uploads/2015/05/bind](http://www.dwhd.org/wp-content/uploads/2015/05/bind)使用详解18.png&quot;``&gt;&lt;img class=``&quot;attachment-medium&quot;</code> <code>src=``&quot;[http://www.dwhd.org/wp-content/uploads/2015/05/bind](http://www.dwhd.org/wp-content/uploads/2015/05/bind)使用详解18.png&quot;</code> <code>alt=``&quot;bind使用详解18&quot;</code>  <code>/&gt;&lt;``/a``&gt;</code></p><p><code>来做下测试</code></p><p> </p><p><code>[root@LookBack226 ~]``# ifconfig awk -F&#39;[ :]+&#39; &#39;/inet addr/&#123;print$4&#125;&#39; grep -vE &quot;^127.&quot;</code></p><p><code>92.222.219.226</code></p><p><code>[root@LookBack226 ~]``# dig -x 92.222.219.223 @92.222.219.226</code></p><p><code>; &lt;&lt;&gt;&gt; DiG 9.9.5 &lt;&lt;&gt;&gt; -x 92.222.219.223 @92.222.219.226</code></p><p><code>;; global options: +cmd</code></p><p><code>;; Got answer:</code></p><p><code>;; -&gt;&gt;HEADER&lt;&gt; DiG 9.9.5 &lt;&lt;&gt;&gt; -x 92.222.219.226 @92.222.219.223</code></p><p><code>;; global options: +cmd</code></p><p><code>;; Got answer:</code></p><p><code>;; -&gt;&gt;HEADER&lt;&gt; DiG 9.9.5 &lt;&lt;&gt;&gt; -t AXFR 219.222.92.``in``-addr.arpa @92.222.219.226</code></p><p><code>;; global options: +cmd</code></p><p><code>219.222.92.``in``-addr.arpa. 600    IN  SOA ns.zeaxion.com. admin.zeaxion.com. 2014080601 3600 600 604800 7200</code></p><p><code>219.222.92.``in``-addr.arpa. 600    IN  NS  ns.zeaxion.com.</code></p><p><code>219.222.92.``in``-addr.arpa. 600    IN  NS  ns2.zeaxion.com.</code></p><p><code>223.219.222.92.``in``-addr.arpa. 600 IN PTR ns.zeaxion.com.</code></p><p><code>226.219.222.92.``in``-addr.arpa. 600 IN PTR ns2.zeaxion.com.</code></p><p><code>219.222.92.``in``-addr.arpa. 600    IN  SOA ns.zeaxion.com. admin.zeaxion.com. 2014080601 3600 600 604800 7200</code></p><p><code>;; Query</code> <code>time``: 0 msec</code></p><p><code>;; SERVER: 92.222.219.226``#53(92.222.219.226)</code></p><p><code>;; WHEN: Sat Aug 09 06:30:19 CEST 2014</code></p><p><code>;; XFR size: 6 records (messages 1, bytes 201)</code></p><p><code>[root@LookBack226 ~]``# dig -t A www.zeaxion.com @92.222.219.223</code></p><p><code>; &lt;&lt;&gt;&gt; DiG 9.9.5 &lt;&lt;&gt;&gt; -t A www.zeaxion.com @92.222.219.223</code></p><p><code>;; global options: +cmd</code></p><p><code>;; Got answer:</code></p><p><code>;; -&gt;&gt;HEADER&lt;&gt; DiG 9.9.5 &lt;&lt;&gt;&gt; -t A www.zeaxion.com @92.222.219.226</code></p><p><code>;; global options: +cmd</code></p><p><code>;; Got answer:</code></p><p><code>;; -&gt;&gt;HEADER&lt;</code></p><p><img src="/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A320.png" alt="自建DNS服务,实现双DNS服务器主从复制、子域授权、转发、智能解析等效果"></p><p><img src="/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A319.png" alt="自建DNS服务,实现双DNS服务器主从复制、子域授权、转发、智能解析等效果"></p><p><img src="/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A321.png" alt="自建DNS服务,实现双DNS服务器主从复制、子域授权、转发、智能解析等效果"></p><p><img src="/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A322.png" alt="自建DNS服务,实现双DNS服务器主从复制、子域授权、转发、智能解析等效果"> 可以看出从服务器已经同步OK了。好了 到了这里 主从同步就做好了</p><hr><h1 id="五、DNS正向子域授权的配置"><a href="#五、DNS正向子域授权的配置" class="headerlink" title="五、DNS正向子域授权的配置"></a><strong>五、DNS正向子域授权的配置</strong></h1><p><img src="/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A323.png" alt="自建DNS服务,实现双DNS服务器主从复制、子域授权、转发、智能解析等效果"></p><p>其实DNS的子域授权只需要在父域的区域解析库中添加“胶水记录”就OK</p><p>下面来说说怎么配置子域授权DNS吧</p><p><img src="/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A324.png" alt="自建DNS服务,实现双DNS服务器主从复制、子域授权、转发、智能解析等效果"></p><p>这里就不说子域授权的DNS服务器编译安装BIND和基础配置文件生成的过程了</p><p><code>[root@LookBack37 ~]``# groupadd -g 153 -r named</code></p><p><code>[root@LookBack37 ~]``# useradd -g named -r -u 153 named</code></p><p><code>[root@LookBack37 ~]``# yum groupinstall &quot;Development tools&quot; &quot;Server Platform Development&quot; -y</code></p><p><code>[root@LookBack37 ~]``# wget -4c [http://www.05hd.com/wp-content/uploads/2014/08/bind-9.9.5.tar.gz](http://www.05hd.com/wp-content/uploads/2014/08/bind-9.9.5.tar.gz)</code></p><p><code>[root@LookBack37 ~]``# tar xf bind-9.9.5.tar.gz</code></p><p><code>[root@LookBack37 ~]``# cd bind-9.9.5</code></p><p><code>[root@LookBack37 bind-9.9.5]``# ./configure --prefix=/usr/local/bind995 --sysconfdir=/etc/named --disable-chroot --enable-threads --enable-ipv6</code></p><p><code>[root@LookBack37 bind-9.9.5]``# make &amp;&amp; make install</code></p><p><code>[root@LookBack37 ~]``# echo &quot;export PATH=/usr/local/bind995/bin:/usr/local/bind995/sbin:$PATH&quot; &gt; /etc/profile.d/bind995.sh</code></p><p><code>[root@LookBack37 ~]``# sed -i &quot;$(cat /etc/man.config grep -nE &#39;^MANPATH[[:space:]]+&#39; tail -1 awk -F: &#39;&#123;print$1&#125;&#39;)a MANPATHt/usr/local/bind995/share/man&quot; /etc/man.config</code></p><p><code>[root@LookBack37 ~]``# wget -c4 [http://www.05hd.com/named.sh](http://www.05hd.com/named.sh) -O /etc/rc.d/init.d/named</code></p><p><code>[root@LookBack37 ~]``# chmod +x /etc/rc.d/init.d/named</code></p><p><code>[root@LookBack37 ~]``# chkconfig --add named</code></p><p><code>[root@LookBack37 ~]``# chkconfig named on</code></p><p><code>[root@LookBack37 ~]``# chown root:named /etc/named/named.conf</code></p><p><code>[root@LookBack37 ~]``# chmod 640 /etc/named/named.conf</code></p><p><code>[root@LookBack37 ~]``# mkdir -p /var/named/slaves</code></p><p><code>[root@LookBack37 ~]``# chown root:named /var/named/</code></p><p><code>[root@LookBack37 ~]``# chown named:named /var/named/slaves/</code></p><p><code>[root@LookBack37 ~]``# chmod 750 /var/named/</code></p><p><code>[root@LookBack37 ~]``# chmod 770 /var/named/slaves/</code></p><p><code>#上面的步骤做好了 新建个shell进程进服务器或者直接重启下服务器</code></p><p>下面来配置主DNS服务器上的&#x2F;var&#x2F;named&#x2F;zeaxion.com.zone文件</p><p><code>[root@LookBack1 named]``# pwd</code></p><p><code>/var/named</code></p><p><code>[root@LookBack1 named]``# cat zeaxion.com.zone</code></p><p><code>$TTL 600</code></p><p><code>@   IN  SOA ns.zeaxion.com. admin.zeaxion.com. (</code></p><p><code>;;上面的admin.zeaxion.com.其实邮箱地址，在这里邮箱地址不能使用@所以要使用.</code></p><p><code>2014080711</code></p><p><code>1H</code></p><p><code>10M</code></p><p><code>7D</code></p><p><code>2H )</code></p><p><code>IN  NS      ns.zeaxion.com.</code></p><p><code>IN  NS      ns2.zeaxion.com.</code></p><p><code>IN  MX  10  mxdomain.qq.com.</code></p><p><code>ns.zeaxion.com. IN  A           92.222.219.223</code></p><p><code>ns2.zeaxion.com. IN  A          92.222.219.226</code></p><p><code>www.zeaxion.com.    IN  A   106.186.17.185</code></p><p><code>web.zeaxion.com.    IN  A   106.186.17.185</code></p><p><code>manage.zeaxion.com. IN  A   106.186.17.185</code></p><p><code>ops.zeaxion.com.        IN      NS      ns.ops.zeaxion.com</code></p><p><code>nsops.zeaxion.com.    IN        A       37.59.108.37</code></p><p>配置好了来重启下服务</p><p><code>[root@LookBack1 named]``# /etc/init.d/named restart</code></p><p><code>Stopping named:                                            [  OK  ]</code></p><p><code>Starting named:                                            [  OK  ]</code></p><p>然后来看看效果</p><p><code>[root@LookBack1 named]``# dig -t NS ops.zeaxion.com @92.222.219.223</code></p><p><code>; &lt;&lt;&gt;&gt; DiG 9.9.5 &lt;&lt;&gt;&gt; -t NS ops.zeaxion.com @92.222.219.223</code></p><p><code>;; global options: +cmd</code></p><p><code>;; Got answer:</code></p><p><code>;; -&gt;&gt;HEADER&lt;</code></p><p>是不是这时候主DNS服务器就不能解析ops.zeaxion.com的域了 但是看看下面会发现我们的FQDN是有信息的</p><p><code>[root@LookBack1 named]``# dig -t AXFR zeaxion.com @92.222.219.226</code></p><p><code>; &lt;&lt;&gt;&gt; DiG 9.9.5 &lt;&lt;&gt;&gt; -t AXFR zeaxion.com @92.222.219.226</code></p><p><code>;; global options: +cmd</code></p><p><code>zeaxion.com.            600     IN      SOA     ns.zeaxion.com. admin.zeaxion.com. 2014080713 3600 600 604800 7200</code></p><p><code>zeaxion.com.            600     IN      MX      10 mxdomain.qq.com.</code></p><p><code>zeaxion.com.            600     IN      NS      ns.zeaxion.com.</code></p><p><code>zeaxion.com.            600     IN      NS      ns2.zeaxion.com.</code></p><p><code>manage.zeaxion.com.     600     IN      A       106.186.17.185</code></p><p><code>ns.zeaxion.com.         600     IN      A       92.222.219.223</code></p><p><code>ns2.zeaxion.com.        600     IN      A       92.222.219.226</code></p><p><code>ops.zeaxion.com.        600     IN      NS      ns.ops.zeaxion.com.</code></p><p><code>ns.ops.zeaxion.com.     600     IN      A       37.59.108.37</code></p><p><code>web.zeaxion.com.        600     IN      A       106.186.17.185</code></p><p><code>www.zeaxion.com.        600     IN      A       106.186.17.185</code></p><p><code>zeaxion.com.            600     IN      SOA     ns.zeaxion.com. admin.zeaxion.com. 2014080713 3600 600 604800 7200</code></p><p><code>;; Query</code> <code>time``: 0 msec</code></p><p><code>;; SERVER: 92.222.219.226``#53(92.222.219.226)</code></p><p><code>;; WHEN: Sat Aug 09 11:26:22 CEST 2014</code></p><p><code>;; XFR size: 12 records (messages 1, bytes 302)</code></p><p>这时候我们就可以得出 虽然我们在主DNS服务器上都建立了解析 但是这时候的ops.zeaxion.com的子域主DNS服务器是不负责解析了</p><p><strong>下面来配置子域的&#x2F;etc&#x2F;named&#x2F;named.conf文件</strong></p><p><code>[root@LookBack37 ~]``# vi /etc/named/named.conf</code></p><p><code>[root@LookBack37 ~]``# cat !$</code></p><p><code>cat</code> <code>/etc/named/named``.conf</code></p><p><code>options &#123;</code></p><p><code>listen-on port 53 &#123; 127.0.0.1; 37.59.108.37; &#125;;</code></p><p><code>listen-on-v6 port 53 &#123; 2001:41d0:51:1::d1c; &#125;;</code></p><p><code>directory</code> <code>&quot;/var/named&quot;``;</code></p><p><code>//``定义工作目录</code></p><p><code>recursion</code> <code>yes``;</code></p><p><code>//``允许递归</code></p><p><code>&#125;;</code></p><p><code>zone</code> <code>&quot;.&quot;</code>     <code>IN      &#123;</code></p><p><code>type</code> <code>hint;</code></p><p><code>file</code> <code>&quot;named.ca&quot;``;</code></p><p><code>&#125;;</code></p><p><code>zone</code> <code>&quot;localhost&quot;</code>     <code>IN      &#123;</code></p><p><code>type</code> <code>master;</code></p><p><code>//``设施为主  master</code></p><p><code>file</code> <code>&quot;localhost.zone&quot;``;</code></p><p><code>allow-update &#123; none; &#125;;</code></p><p><code>//``不允许任何人更新</code></p><p><code>&#125;;</code></p><p><code>zone</code> <code>&quot;0.0.127.in-addr.arpa&quot;</code>  <code>IN      &#123;</code></p><p><code>//``把127.0.0反向解析</code></p><p><code>type</code> <code>master;</code></p><p><code>file</code> <code>&quot;127.0.0.zone&quot;``;</code></p><p><code>allow-update &#123; none; &#125;;</code></p><p><code>&#125;;</code></p><p><code>zone</code> <code>&quot;ops.zeaxion.com&quot;</code>   <code>IN      &#123;</code></p><p><code>type</code> <code>master;</code></p><p><code>file</code> <code>&quot;ops.zeaxion.com.zone&quot;``;</code></p><p><code>//allow-update</code> <code>&#123; 127.0.0.1; &#125;;</code></p><p><code>&#125;;</code></p><p>再去&#x2F;var&#x2F;named&#x2F;下创建需要的文件</p><p><code>[root@LookBack37 ~]``# for i in $(grep &#39;file&#39; /etc/named/named.conf awk -F&#39;&quot;&#39; &#39;&#123;print$2&#125;&#39;); do touch /var/named/$i;chgrp named /var/named/$i;chmod 640 /var/named/$i;done</code></p><p><code>[root@LookBack37 ~]``# cd /var/named/</code></p><p><code>[root@LookBack37 named]``# ls -l</code></p><p><code>total 8</code></p><p><code>-rw-r----- 1 root  named    0 Aug  9 11:43 127.0.0.zone</code></p><p><code>drwxrwx--- 2 named named 4096 Jan 20  2014 data</code></p><p><code>drwxrwx--- 2 named named 4096 Aug  9 09:02 dynamic</code></p><p><code>-rw-r----- 1 root  named    0 Aug  9 11:43 localhost.zone</code></p><p><code>-rw-r----- 1 root  named    0 Aug  9 11:43 named.ca</code></p><p><code>-rw-r----- 1 root  named    0 Aug  9 11:43 ops.zeaxion.com.zone</code></p><p><code>##我这里就直接用命令批量创建好了文件  等下去补充文件内容</code></p><p><code>##127.0.0.zone  localhost.zone  named.ca  这3个文件和主从DNS服务器上文件内容是一样的</code></p><p><strong>下面是 127.0.0.zone localhost.zone named.ca 3个文件的内容</strong></p><p><code>[root@LookBack223 named]``# cat 127.0.0.zone</code></p><p><code>$TTL 86400</code></p><p><code>@       IN      SOA     localhost.      admin.05hd.org. (</code></p><p><code>2014080601</code></p><p><code>3H</code></p><p><code>15M</code></p><p><code>7D</code></p><p><code>1D )</code></p><p><code>IN      NS      localhost.</code></p><p><code>1       IN      PTR     localhost.</code></p><p><code>[root@LookBack223 named]``# cat localhost.zone</code></p><p><code>$TTL 86400</code></p><p><code>@       IN      SOA     localhost.      admin.05hd.org. (</code></p><p><code>2014080601</code></p><p><code>3H</code></p><p><code>15M</code></p><p><code>7D</code></p><p><code>1D )</code></p><p><code>IN      NS      localhost.</code></p><p><code>IN      A       127.0.0.1</code></p><p><code>[root@LookBack223 named]``# cat named.ca</code></p><p><code>; &lt;&lt;&gt;&gt; DiG 9.9.5 &lt;&lt;&gt;&gt; -t NS . @a.root-servers.net.</code></p><p><code>;; global options: +cmd</code></p><p><code>;; Got answer:</code></p><p><code>;; -&gt;&gt;HEADER&lt;</code></p><p><strong>下面来开始配置&#x2F;var&#x2F;named&#x2F;ops.zeaxion.com.zone的配置文件</strong></p><p><code>[root@LookBack37 named]``# cat ops.zeaxion.com.zone</code></p><p><code>$TTL 600</code></p><p><code>$ORIGIN ops.zeaxion.com.</code></p><p><code>@   IN  SOA ns.ops.zeaxion.com. admin.ops.zeaxion.com. (</code></p><p><code>2014080701 ;版本号</code></p><p><code>1H ;刷新时长</code></p><p><code>5M ;每5分钟做一次重试</code></p><p><code>3D ;过期时间</code></p><p><code>3H );否定回答时间)</code></p><p><code>IN NS ns ;这里ns后面不用写全了  因为第二行做了ORIGIN</code></p><p><code>IN  MX  10  mail</code></p><p><code>ns  IN  A   37.59.108.37</code></p><p><code>mail    IN  A   106.186.17.185</code></p><p><code>www IN  A   106.186.17.185</code></p><p><code>ftp</code> <code>IN  A   106.186.17.185</code></p><p><img src="/2020/04/bind%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A325.png" alt="自建DNS服务,实现双DNS服务器主从复制、子域授权、转发、智能解析等效果"></p><p><strong>下面来启动子域服务器上DNS服务</strong></p><p><code>[root@LookBack37 named]``# service named start</code></p><p><code>Starting named:                                            [  OK  ]</code></p><p><strong>来测试下子域配置</strong></p><p><code>[root@LookBack37 named]``# dig -t A www.ops.zeaxion.com @37.59.108.37</code></p><p><code>; &lt;&lt;&gt;&gt; DiG 9.9.5 &lt;&lt;&gt;&gt; -t A www.ops.zeaxion.com @37.59.108.37</code></p><p><code>;; global options: +cmd</code></p><p><code>;; Got answer:</code></p><p><code>;; -&gt;&gt;HEADER&lt;&gt; DiG 9.9.5 &lt;&lt;&gt;&gt; -t A www.ops.zeaxion.com @92.222.219.223</code></p><p><code>;; global options: +cmd</code></p><p><code>;; Got answer:</code></p><p><code>;; -&gt;&gt;HEADER&lt;</code></p><p> </p><p><code>[root@LookBack223 named]``# dig -t A www.ops.zeaxion.com</code></p><p><code>; &lt;&lt;&gt;&gt; DiG 9.9.5 &lt;&lt;&gt;&gt; -t A www.ops.zeaxion.com</code></p><p><code>;; global options: +cmd</code></p><p><code>;; Got answer:</code></p><p><code>;; -&gt;&gt;HEADER&lt;</code></p><p><strong>通过上面可以看出 不论是通过子域服务器查询还是通过父域查询 都可以了，也就是说到了这里 我们的子域服务器也OK了</strong></p><hr><h1 id="六、配置转发"><a href="#六、配置转发" class="headerlink" title="六、配置转发"></a><strong>六、配置转发</strong></h1><p>转发器顾名思义就是转发不是本机DNS所解析的服务至指定的服务器，这时候本机就是一个转发器了。 <strong>下面来看看第一种配置,转发器</strong></p><p><code>[root@LookBack37 named]``# pwd</code></p><p><code>/etc/named</code></p><p><code>[root@LookBack37 named]``# cat named.conf</code></p><p><code>options &#123;</code></p><p><code>listen-on port 53 &#123; 127.0.0.1; 37.59.108.37; &#125;;</code></p><p><code>listen-on-v6 port 53 &#123; 2001:41d0:51:1::d1c; &#125;;</code></p><p><code>directory</code> <code>&quot;/var/named&quot;``;</code></p><p><code>//``定义工作目录</code></p><p><code>recursion</code> <code>yes``;</code></p><p><code>//``允许递归</code></p><p><code>//forward</code> <code>only;</code></p><p><code>forward first;``//only</code> <code>是先递归给指定服务器，如果没有答案那么结果就是没答案，first 是先递归查询 要是没答案就自己再找一圈</code></p><p><code>forwarders &#123; 8.8.8.8; &#125;;``//``转发到哪个服务器上</code></p><p><code>&#125;;</code></p><p><strong>下面来看看第二种配置,转发区域(只对指定的区域做转发，其他的任然是去根上查询)</strong></p><p><code>#看zone  &quot;zeaxion.com&quot;   IN段中的配置，这里做了只转发zeaxion.com域的配置</code></p><p><code>[root@LookBack37 named]``# pwd</code></p><p><code>/etc/named</code></p><p><code>[root@LookBack37 named]``# cat named.conf</code></p><p><code>options &#123;</code></p><p><code>listen-on port 53 &#123; 127.0.0.1; 37.59.108.37; &#125;;</code></p><p><code>listen-on-v6 port 53 &#123; 2001:41d0:51:1::d1c; &#125;;</code></p><p><code>directory</code> <code>&quot;/var/named&quot;``;</code></p><p><code>//``定义工作目录</code></p><p><code>recursion</code> <code>yes``;</code></p><p><code>//``允许递归</code></p><p><code>//forward</code> <code>only;</code></p><p><code>forward first;</code></p><p><code>forwarders &#123; 8.8.8.8; &#125;;</code></p><p><code>&#125;;</code></p><p><code>zone</code> <code>&quot;.&quot;</code>     <code>IN      &#123;</code></p><p><code>type</code> <code>hint;</code></p><p><code>file</code> <code>&quot;named.ca&quot;``;</code></p><p><code>&#125;;</code></p><p><code>zone</code> <code>&quot;localhost&quot;</code>     <code>IN      &#123;</code></p><p><code>type</code> <code>master;</code></p><p><code>//``设施为主  master</code></p><p><code>file</code> <code>&quot;localhost.zone&quot;``;</code></p><p><code>allow-update &#123; none; &#125;;</code></p><p><code>//``不允许任何人更新</code></p><p><code>&#125;;</code></p><p><code>zone</code> <code>&quot;0.0.127.in-addr.arpa&quot;</code>  <code>IN      &#123;</code></p><p><code>//``把127.0.0反向解析</code></p><p><code>type</code> <code>master;</code></p><p><code>file</code> <code>&quot;127.0.0.zone&quot;``;</code></p><p><code>allow-update &#123; none; &#125;;</code></p><p><code>&#125;;</code></p><p><code>zone</code> <code>&quot;ops.zeaxion.com&quot;</code>   <code>IN      &#123;</code></p><p><code>type</code> <code>master;</code></p><p><code>file</code> <code>&quot;ops.zeaxion.com.zone&quot;``;</code></p><p><code>//allow-update</code> <code>&#123; 127.0.0.1; &#125;;</code></p><p><code>&#125;;</code></p><p><code>zone</code> <code>&quot;zeaxion.com&quot;</code>   <code>IN      &#123;</code></p><p><code>type</code> <code>forward;</code></p><p><code>forward only;</code></p><p><code>forwarders &#123; 92.222.219.223; 92.222.219.226; &#125;;</code></p><p><code>&#125;;</code></p><p>下面来看看效果</p><p><code>[root@LookBack37 named]``# dig -t A www.zeaxion.com @37.59.108.37</code></p><p><code>; &lt;&lt;&gt;&gt; DiG 9.9.5 &lt;&lt;&gt;&gt; -t A www.zeaxion.com @37.59.108.37</code></p><p><code>;; global options: +cmd</code></p><p><code>;; Got answer:</code></p><p><code>;; -&gt;&gt;HEADER&lt;</code></p></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者： </strong>Jarod</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://jarod.vip/2020/04/30/%E8%87%AA%E5%BB%BAdns%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E5%8F%8Cdns%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E3%80%81%E5%AD%90%E5%9F%9F%E6%8E%88%E6%9D%83%E3%80%81%E8%BD%AC/" title="自建DNS服务,实现双DNS服务器主从复制、子域授权、转发、智能解析等效果">https://jarod.vip/2020/04/30/自建dns服务实现双dns服务器主从复制、子域授权、转/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/DNS/" rel="tag"># DNS</a> <a href="/tags/BIND/" rel="tag"># BIND</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2020/04/22/%E8%80%81%E7%89%8C%E4%BA%91%E8%AE%A1%E7%AE%97%E6%89%98%E7%AE%A1%E6%9C%8D%E5%8A%A1%E5%95%86-ovzh-com-%E7%BE%8E%E5%9B%BDcn2-gia-vps/" rel="prev" title="老牌云计算托管服务商 OVZH.COM 美国CN2 GIA VPS"><i class="fa fa-chevron-left"></i> 老牌云计算托管服务商 OVZH.COM 美国CN2 GIA VPS</a></div><div class="post-nav-item"><a href="/2020/04/30/oneinstack%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A-oneinstack%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B%E6%94%B6%E9%9B%86%E6%95%B4%E7%90%86/" rel="next" title="Oneinstack从入门到精通-Oneinstack安装与使用教程收集整理">Oneinstack从入门到精通-Oneinstack安装与使用教程收集整理 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><script>window.addEventListener("tabs:register",()=>{let t=CONFIG.comments["activeClass"];var e;(t=CONFIG.comments.storage?localStorage.getItem("comments_active")||t:t)&&(e=document.querySelector(`a[href="#comment-${t}"]`))&&e.click()}),CONFIG.comments.storage&&window.addEventListener("tabs:click",t=>{t.target.matches(".tabs-comment .tab-content .tab-pane")&&(t=t.target.classList[1],localStorage.setItem("comments_active",t))})</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E5%AE%89%E8%A3%85bind-%E7%94%B1%E4%BA%8E%E7%8E%B0%E5%9C%A8%E7%9A%84bind%E5%A4%A7%E7%89%88%E6%9C%AC%E6%9C%899%E5%92%8C10%EF%BC%8C%E8%BF%99%E9%87%8C%E7%94%A89%E7%89%88%E6%9C%AC%E6%9D%A5%E6%B5%8B%E8%AF%95%E3%80%82"><span class="nav-number">1.</span> <span class="nav-text">一、安装bind(由于现在的bind大版本有9和10，这里用9版本来测试。)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%BC%80%E5%A7%8B%E9%85%8D%E7%BD%AE%E5%9F%BA%E7%A1%80%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">2.</span> <span class="nav-text">二、开始配置基础的配置文件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8B%E9%9D%A2%E5%BC%80%E5%A7%8B%E6%9D%A5%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0%E6%AD%A3%E5%90%91%E8%A7%A3%E6%9E%90"><span class="nav-number">2.1.</span> <span class="nav-text">下面开始来配置实现正向解析</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E7%8E%B0%E5%9C%A8%E6%9D%A5%E5%BC%80%E5%A7%8B%E5%81%9A%E5%9F%9F%E5%90%8D%E6%AD%A3%E5%8F%8D%E5%90%91%E8%A7%A3%E6%9E%90%E4%BA%86"><span class="nav-number">3.</span> <span class="nav-text">三、现在来开始做域名正反向解析了</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1%E3%80%81%E6%AD%A3%E5%90%91%E5%9F%9F%E8%A7%A3%E6%9E%90%E9%85%8D%E7%BD%AE"><span class="nav-number">3.1.</span> <span class="nav-text">1、正向域解析配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2%E3%80%81%E5%8F%8D%E5%90%91%E5%9F%9F%E8%A7%A3%E6%9E%90%E9%85%8D%E7%BD%AE"><span class="nav-number">3.2.</span> <span class="nav-text">2、反向域解析配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E9%85%8D%E7%BD%AE%E5%A4%9ADNS%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="nav-number">4.</span> <span class="nav-text">四、配置多DNS主从复制</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%94%E3%80%81DNS%E6%AD%A3%E5%90%91%E5%AD%90%E5%9F%9F%E6%8E%88%E6%9D%83%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="nav-number">5.</span> <span class="nav-text">五、DNS正向子域授权的配置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%AD%E3%80%81%E9%85%8D%E7%BD%AE%E8%BD%AC%E5%8F%91"><span class="nav-number">6.</span> <span class="nav-text">六、配置转发</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><p class="site-author-name" itemprop="name">Jarod</p><div class="site-description" itemprop="description">记录生活中的点点滴滴</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">262</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">6</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">306</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/jarodvip" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jarodvip" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Jarod</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-chart-area"></i> </span><span title="站点总字数">658k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="站点阅读时长">9:58</span></div><div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动</div></div></footer></div><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script></body></html>